<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AREA SCOUTS | APEX - Athlete Performance Evaluation Index</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK - using defer to ensure proper loading -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBwi5ubmI0JcIyff-vEclCgj2Dr6Xq4R9I",
            authDomain: "apex-e1a27.firebaseapp.com",
            projectId: "apex-e1a27",
            storageBucket: "apex-e1a27.firebasestorage.app",
            messagingSenderId: "1094793350968",
            appId: "1:1094793350968:web:6740f69514b7d70932bbcd",
            measurementId: "G-7F2FTENHSY"
        };
        
        // Initialize Firebase - with check if SDK loaded
        function initializeFirebase() {
            if (typeof firebase === 'undefined') {
                console.warn('‚ö†Ô∏è Firebase SDK not loaded - using localStorage only');
                window.db = null;
                window.auth = null;
                window.storage = null;
                window.ORG_ID = 'area_scouts';
                window.firebaseReady = false;
                return false;
            }
            
            try {
                firebase.initializeApp(firebaseConfig);
                window.db = firebase.firestore();
                window.auth = firebase.auth();
                window.storage = firebase.storage();
                window.ORG_ID = 'area_scouts';
                window.firebaseReady = true;
                console.log('üî• Firebase initialized successfully!');
                return true;
            } catch (e) {
                console.warn('‚ö†Ô∏è Firebase initialization failed:', e.message);
                window.db = null;
                window.auth = null;
                window.storage = null;
                window.ORG_ID = 'area_scouts';
                window.firebaseReady = false;
                return false;
            }
        }
        
        // Try to initialize immediately
        var firebaseLoaded = initializeFirebase();
        
        // ============================================
        // FIREBASE DATA LAYER
        // Syncs data between Firestore and localStorage
        // ============================================
        
        // Get the organization document ID (we'll fetch this once)
        window.orgDocId = null;
        
        // Initialize Firebase data layer
        async function initFirebaseData() {
            if (!window.db) {
                console.log('üì¶ Using localStorage only (Firebase not available)');
                return;
            }
            
            try {
                // Find the Area Scouts organization
                const orgsSnapshot = await window.db.collection('organizations')
                    .where('name', '==', 'Area Scouts')
                    .limit(1)
                    .get();
                
                if (!orgsSnapshot.empty) {
                    window.orgDocId = orgsSnapshot.docs[0].id;
                    console.log('‚úÖ Connected to organization:', window.orgDocId);
                    
                    // Load data from Firestore
                    await loadFromFirestore();
                } else {
                    console.log('‚ö†Ô∏è Organization not found, using localStorage');
                }
            } catch (e) {
                console.warn('Firebase data init failed:', e.message);
            }
        }
        
        // Load all data from Firestore
        async function loadFromFirestore() {
            if (!window.db || !window.orgDocId) return;
            
            const orgRef = window.db.collection('organizations').doc(window.orgDocId);
            
            try {
                // Load directors
                const directorsSnap = await orgRef.collection('directors').get();
                if (!directorsSnap.empty) {
                    const directors = directorsSnap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    localStorage.setItem('apex_directors', JSON.stringify(directors));
                    console.log('üì• Loaded', directors.length, 'directors from Firestore');
                }
                
                // Load leads
                const leadsSnap = await orgRef.collection('leads').get();
                if (!leadsSnap.empty) {
                    const leads = leadsSnap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    localStorage.setItem('apex_leads', JSON.stringify(leads));
                    console.log('üì• Loaded', leads.length, 'leads from Firestore');
                }
                
                // Load reservations
                const reservationsSnap = await orgRef.collection('reservations').get();
                if (!reservationsSnap.empty) {
                    const reservations = reservationsSnap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    localStorage.setItem('apex_reservations', JSON.stringify(reservations));
                    console.log('üì• Loaded', reservations.length, 'reservations from Firestore');
                }
                
                // Load settings
                const settingsSnap = await orgRef.collection('settings').doc('general').get();
                if (settingsSnap.exists) {
                    const settings = settingsSnap.data();
                    localStorage.setItem('apex_settings', JSON.stringify(settings));
                    if (settings.adminPassword) localStorage.setItem('apex_adminPassword', settings.adminPassword);
                    if (settings.stripeLink) localStorage.setItem('apex_stripeLink', settings.stripeLink);
                    console.log('üì• Loaded settings from Firestore');
                }
                
                // Load activity
                const activitySnap = await orgRef.collection('activity').orderBy('timestamp', 'desc').limit(100).get();
                if (!activitySnap.empty) {
                    const activity = activitySnap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    localStorage.setItem('apex_activity', JSON.stringify(activity));
                    console.log('üì• Loaded', activity.length, 'activity logs from Firestore');
                }
                
            } catch (e) {
                console.warn('Error loading from Firestore:', e.message);
            }
        }
        
        // Save to Firestore (called when data changes)
        window.saveToFirestore = async function(collection, data, docId = null) {
            if (!window.db || !window.orgDocId) {
                console.log('üì¶ Firestore not available, saved to localStorage only');
                return null;
            }
            
            const orgRef = window.db.collection('organizations').doc(window.orgDocId);
            
            try {
                if (docId) {
                    // Update existing document
                    await orgRef.collection(collection).doc(docId).set(data, { merge: true });
                    console.log('üì§ Updated', collection, docId);
                    return docId;
                } else {
                    // Add new document
                    const docRef = await orgRef.collection(collection).add({
                        ...data,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    console.log('üì§ Added to', collection, docRef.id);
                    return docRef.id;
                }
            } catch (e) {
                console.warn('Error saving to Firestore:', e.message);
                return null;
            }
        };
        
        // Delete from Firestore
        window.deleteFromFirestore = async function(collection, docId) {
            if (!window.db || !window.orgDocId) return false;
            
            const orgRef = window.db.collection('organizations').doc(window.orgDocId);
            
            try {
                await orgRef.collection(collection).doc(docId).delete();
                console.log('üóëÔ∏è Deleted from', collection, docId);
                return true;
            } catch (e) {
                console.warn('Error deleting from Firestore:', e.message);
                return false;
            }
        };
        
        // Log activity to Firestore
        window.logActivityToFirestore = async function(action, details) {
            await window.saveToFirestore('activity', {
                action: action,
                details: details,
                timestamp: new Date().toISOString()
            });
        };
        
        // Initialize Firebase data when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            initFirebaseData();
        });
        
        // ============================================
        // EARLY GLOBAL FUNCTION DECLARATIONS
        // These must be available before DOM elements that use them
        // ============================================
        
        // Prize wheel functions - placeholders that will be overwritten later
        window.closePrizeWheel = function() {
            var modal = document.getElementById('prizeWheelModal');
            if (modal) modal.classList.remove('active');
        };
        
        window.submitEmailAndShowWheel = function() {
            var emailInput = document.getElementById('prizeWheelEmail');
            var email = emailInput ? emailInput.value.trim() : '';
            
            if (!email || !email.includes('@') || !email.includes('.')) {
                if (emailInput) {
                    emailInput.style.borderColor = '#dc3545';
                    emailInput.style.animation = 'shake 0.5s ease';
                    setTimeout(function() {
                        emailInput.style.animation = '';
                        emailInput.style.borderColor = 'rgba(255,255,255,0.3)';
                    }, 500);
                }
                return;
            }
            
            // Store email globally
            window.currentUserPrizeEmail = email;
            
            // Hide email section, show wheel
            var emailSection = document.getElementById('emailEntrySection');
            var wheelSection = document.getElementById('wheelRevealSection');
            if (emailSection) emailSection.style.display = 'none';
            if (wheelSection) wheelSection.style.display = 'block';
            
            // Try to initialize wheel if function exists
            if (typeof window.initPrizeWheel === 'function') {
                window.initPrizeWheel();
            }
            
            console.log('‚úÖ Email submitted:', email);
        };
        
        window.openPrizeWheel = function(mode) {
            console.log('üé∞ Opening prize wheel for mode:', mode);
            window.pendingMode = mode;
            var modal = document.getElementById('prizeWheelModal');
            if (modal) {
                modal.classList.add('active');
                modal.style.display = 'flex';
                modal.style.pointerEvents = 'auto';
            }
        };
        
        window.spinPrizeWheel = function() {
            console.log('Spin requested - full function loads later');
        };
        
        // Critical button functions - must exist before DOM loads
        // Load email from localStorage if available
        window.currentUserEmail = localStorage.getItem('apex_userEmail') || null;
        window.pendingAction = null;
        window.pendingActionType = null;
        window.pendingMode = null;
        
        // Load AI Knowledge globally so it's available everywhere
        window.aiKnowledge = JSON.parse(localStorage.getItem('apex_aiKnowledge') || '[]');
        console.log('AI Knowledge loaded:', window.window.aiKnowledge.length, 'items');
        
        console.log('Email loaded from storage:', window.currentUserEmail ? 'YES' : 'NO');
        
        window.openModal = function(modalId) {
            console.log('Opening modal:', modalId);
            var modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('active');
                modal.style.display = 'flex';
            }
        };
        
        window.closeModal = function(modalId) {
            var modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
                modal.style.display = 'none';
            }
        };
        
        window.requireEmailThen = function(modalId) {
            console.log('requireEmailThen called for:', modalId);
            // Check all possible email sources
            var storedEmail = localStorage.getItem('apex_userEmail');
            if (storedEmail) {
                window.currentUserEmail = storedEmail;
            }
            
            if (window.currentUserEmail) {
                window.openModal(modalId);
            } else {
                window.pendingAction = modalId;
                window.pendingActionType = 'modal';
                window.openPrizeWheel('action');
            }
        };
        
        window.promptForEmail = function(mode) {
            console.log('promptForEmail called for:', mode);
            // Check all possible email sources
            var storedEmail = localStorage.getItem('apex_userEmail');
            if (storedEmail) {
                window.currentUserEmail = storedEmail;
                // Email already captured, just set mode
                if (typeof window.setMode === 'function') {
                    window.setMode(mode);
                }
                return;
            }
            
            window.pendingAction = mode;
            window.pendingActionType = 'mode';
            window.openPrizeWheel(mode);
        };
    </script>
    
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        :root {
            --orange: #ed7023;
            --navy: #16345f;
            --green: #37c938;
            --yellow: #ffde59;
            --purple: #8b5cf6;
            --dark-bg: #0f172a;
            --card-bg: rgba(255,255,255,0.03);
            --border: rgba(255,255,255,0.08);
            --text: #f8fafc;
            --text-muted: #94a3b8;
        }
        
        /* Toggle Switch */
        .toggle-switch { position: relative; display: inline-block; width: 50px; height: 26px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .toggle-slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #4b5563; transition: 0.3s; border-radius: 26px; }
        .toggle-slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px; background-color: white; transition: 0.3s; border-radius: 50%; }
        input:checked + .toggle-slider { background-color: var(--green); }
        input:checked + .toggle-slider:before { transform: translateX(24px); }
        
        /* Window Manager - Floating Buttons */
        .window-manager {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 99999;
        }
        .window-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            font-family: 'Outfit', sans-serif;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: all 0.2s;
            white-space: nowrap;
        }
        .window-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }
        .window-btn.active {
            outline: 3px solid white;
        }
        .window-btn-main { background: var(--green); color: white; }
        .window-btn-admin { background: var(--orange); color: white; }
        .window-btn-edit { background: var(--purple); color: white; }
        .window-btn-close {
            background: #dc3545;
            color: white;
            padding: 8px 12px;
            font-size: 12px;
            margin-left: 8px;
        }
        .window-btn-group {
            display: flex;
            align-items: center;
        }
        
        /* Full screen panels */
        .screen-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--dark-bg);
            z-index: 50000;
            overflow-y: auto;
            display: none;
            pointer-events: none;
        }
        .screen-panel.active {
            display: block;
            pointer-events: auto;
        }
        .screen-panel-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .screen-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: rgba(0,0,0,0.3);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .screen-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--orange);
        }
        .screen-close-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-family: 'Outfit', sans-serif;
        }
        
        body {
            min-height: 100vh;
            background: linear-gradient(135deg, var(--dark-bg) 0%, #1e293b 50%, var(--dark-bg) 100%);
            font-family: 'Outfit', sans-serif;
            color: var(--text);
            line-height: 1.6;
        }
        .container { max-width: 1100px; margin: 0 auto; padding: 0 20px; }
        header { padding: 30px 0; border-bottom: 1px solid var(--border); }
        .header-content { display: flex; align-items: center; justify-content: center; gap: 30px; flex-wrap: wrap; padding: 0 20px; }
        .header-left { display: flex; align-items: center; gap: 30px; }
        .logo-image { height: 100px; width: auto; border-radius: 16px; background: white; padding: 10px; flex-shrink: 0; }
        .header-title { font-size: 26px; font-weight: 700; line-height: 1.5; text-align: left; }
        .header-title .line1 { display: block; margin-bottom: 8px; }
        .header-title .line2 { display: block; }
        .header-title .green { color: var(--green); }
        .header-title .team { color: white; font-weight: 700; }
        
        /* Hero Section */
        .hero-section { padding: 40px 0; text-align: center; }
        
        /* Glowing Green Availability Button - 25% larger */
        .btn-availability {
            background: var(--green);
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 12px;
            font-size: 20px;
            font-weight: 700;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
            animation: greenGlow 2s infinite;
        }
        @keyframes greenGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(55,201,56,0.5), 0 0 40px rgba(55,201,56,0.3); }
            50% { box-shadow: 0 0 30px rgba(55,201,56,0.8), 0 0 60px rgba(55,201,56,0.5); }
        }
        .btn-availability:hover { transform: translateY(-2px); }
        
        .what-is-link { color: var(--text-muted); text-decoration: underline; font-size: 13px; cursor: pointer; background: none; border: none; display: block; margin: 0 auto 30px; }
        .what-is-link:hover { color: var(--orange); }
        
        /* Join heading - 20% larger */
        .join-heading { font-size: 31px; font-weight: 700; margin-bottom: 20px; }
        .join-heading span { color: var(--green); }
        
        .hero-description { font-size: 18px; color: var(--text-muted); max-width: 900px; margin: 0 auto 24px; line-height: 1.7; }
        .hero-quote { font-style: italic; font-size: 17px; margin-bottom: 24px; }
        
        /* Choose Your Path - one line navy blue */
        .choose-path { font-size: 24px; font-weight: 700; color: var(--text); margin-bottom: 20px; }
        
        /* CTA Buttons - side by side */
        .cta-row { display: flex; gap: 30px; justify-content: center; align-items: flex-start; margin-bottom: 30px; flex-wrap: wrap; }
        .cta-wrapper { display: flex; flex-direction: column; align-items: center; gap: 8px; }
        .btn-cta { width: 420px; height: 60px; border: none; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; transition: all 0.2s; padding: 0 20px; }
        .btn-cta.navy { background: var(--navy); color: white; }
        .btn-cta.orange { background: var(--orange); color: white; }
        .btn-cta:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.3); }
        
        /* Trust Section - 3 boxes */
        .trust-section { margin: 30px 0; }
        .trust-header { font-size: 15px; color: var(--text-muted); margin-bottom: 16px; text-align: center; }
        .trust-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
        .trust-box { background: var(--card-bg); border: 1px solid var(--border); border-radius: 12px; padding: 28px; min-height: 140px; display: flex; flex-direction: column; gap: 12px; font-size: 15px; line-height: 1.5; }
        .trust-box .bullet { color: var(--text); }
        .trust-box .bullet::before { content: "‚Ä¢ "; color: var(--orange); }
        
        .built-by { text-align: center; font-size: 22px; color: white; margin-bottom: 20px; line-height: 1.5; font-weight: 600; }
        .built-by strong { color: white; }
        
        .league-logos { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin-bottom: 30px; font-size: 18px; color: white; font-weight: 500; }
        
        /* Stats Banner - 3 boxes */
        .stats-banner { display: flex; justify-content: center; gap: 30px; padding: 30px 0; border-top: 1px solid var(--border); border-bottom: 1px solid var(--border); }
        .stat-item { text-align: center; min-width: 150px; }
        .stat-value { font-size: 36px; font-weight: 700; color: var(--green); }
        .stat-label { font-size: 14px; color: var(--text-muted); margin-top: 4px; }
        
        /* Resource & Waitlist Buttons */
        .buttons-section { padding: 30px 0; text-align: center; }
        .resource-buttons { display: flex; justify-content: center; gap: 12px; flex-wrap: wrap; margin-bottom: 20px; }
        .resource-btn { width: 160px; height: 50px; background: var(--card-bg); border: 1px solid var(--border); border-radius: 10px; color: var(--text); font-size: 14px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .resource-btn:hover { background: rgba(255,255,255,0.08); border-color: var(--orange); }
        
        .waitlist-buttons { display: flex; justify-content: center; gap: 15px; margin-top: 20px; flex-wrap: wrap; }
        .btn-waitlist { padding: 14px 28px; border-radius: 10px; font-size: 15px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; }
        .btn-waitlist.white { background: white; color: black; border: 2px solid black; }
        .btn-waitlist.gold { background: var(--yellow); color: black; border: none; animation: goldGlow 2s infinite; }
        @keyframes goldGlow { 0%, 100% { box-shadow: 0 0 15px rgba(255,222,89,0.5); } 50% { box-shadow: 0 0 25px rgba(255,222,89,0.8); } }
        
        /* Directors Section */
        .directors-section { padding: 40px 0; }
        .directors-header { text-align: center; margin-bottom: 20px; }
        .directors-title { font-size: 22px; line-height: 1.5; color: white; font-weight: 600; text-align: center; max-width: 100%; }
        .directors-title span { color: white; }
        .directors-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px; }
        .director-card { background: var(--card-bg); border: 1px solid var(--border); border-radius: 10px; padding: 16px; text-align: center; min-height: 140px; }
        .director-photo { width: 70px; height: 70px; border-radius: 50%; margin: 0 auto 10px; object-fit: cover; background: var(--navy); }
        .director-name { font-weight: 600; font-size: 14px; color: var(--text); }
        .director-title { font-size: 12px; color: var(--text-muted); }
        
        /* Chat/Quiz Agent */
        .agent-section { padding: 40px 0; border-top: 1px solid var(--border); }
        .agent-header { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .mode-btn { padding: 10px 18px; border-radius: 12px; border: 1px solid var(--border); background: var(--card-bg); color: var(--text-muted); font-weight: 500; font-size: 14px; cursor: pointer; }
        .mode-btn:hover { background: rgba(255,255,255,0.05); color: var(--text); }
        .mode-btn.active { background: rgba(237,112,35,0.2); border-color: var(--orange); color: var(--orange); }
        
        .chat-container { background: var(--card-bg); border: 1px solid var(--border); border-radius: 20px; overflow: hidden; max-width: 900px; margin: 0 auto; }
        .messages-area { padding: 20px; min-height: 300px; max-height: 450px; overflow-y: auto; display: flex; flex-direction: column; gap: 16px; }
        .message { max-width: 85%; padding: 16px 20px; font-size: 15px; line-height: 1.7; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .message-user { background: linear-gradient(135deg, var(--orange) 0%, #c45a1c 100%); color: white; margin-left: auto; border-radius: 20px 20px 4px 20px; }
        .message-assistant { background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 20px 20px 20px 4px; }
        .message-assistant strong { color: var(--orange); }
        
        .feedback-container { margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border); text-align: center; }
        .feedback-question { font-size: 13px; color: var(--text-muted); margin-bottom: 8px; }
        .feedback-btn { padding: 6px 16px; margin: 0 5px; border-radius: 6px; border: 1px solid var(--border); background: var(--card-bg); color: var(--text); cursor: pointer; font-size: 13px; }
        .feedback-btn.yes:hover { background: rgba(55,201,56,0.2); border-color: var(--green); }
        .feedback-btn.no:hover { background: rgba(239,68,68,0.2); border-color: #ef4444; }
        
        .quick-prompts { padding: 12px 20px; border-top: 1px solid var(--border); display: flex; gap: 8px; flex-wrap: wrap; background: rgba(0,0,0,0.2); }
        .quick-btn { padding: 8px 14px; border-radius: 20px; border: 1px solid rgba(237,112,35,0.5); background: rgba(237,112,35,0.1); color: #fff; font-size: 13px; cursor: pointer; transition: all 0.2s ease; }
        .quick-btn:hover { background: rgba(237,112,35,0.3); border-color: var(--orange); color: #fff; transform: translateY(-1px); }
        
        .input-area { padding: 16px 20px; border-top: 1px solid var(--border); display: flex; gap: 12px; background: rgba(0,0,0,0.3); }
        .input-field { flex: 1; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 12px; padding: 14px 18px; color: var(--text); font-size: 15px; resize: none; outline: none; }
        .input-field:focus { border-color: var(--orange); }
        .send-btn { background: linear-gradient(135deg, var(--green) 0%, #2da82e 100%); border: none; border-radius: 12px; padding: 14px 28px; color: white; font-weight: 600; cursor: pointer; }
        
        .quiz-container { background: var(--card-bg); border: 1px solid var(--border); border-radius: 16px; padding: 24px; max-width: 900px; margin: 0 auto; display: none; }
        .quiz-container.active { display: block; }
        .quiz-progress { display: flex; justify-content: space-between; margin-bottom: 16px; padding-bottom: 16px; border-bottom: 1px solid var(--border); }
        .quiz-score { color: var(--orange); }
        .quiz-question { font-size: 18px; font-weight: 600; margin-bottom: 20px; }
        .quiz-options { display: flex; flex-direction: column; gap: 12px; }
        .quiz-option { padding: 16px 20px; background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 12px; cursor: pointer; }
        .quiz-option:hover { background: rgba(255,255,255,0.06); }
        .quiz-option.correct { background: rgba(55,201,56,0.2); border-color: var(--green); }
        .quiz-option.incorrect { background: rgba(239,68,68,0.2); border-color: #ef4444; }
        .quiz-feedback { margin-top: 20px; padding: 16px; border-radius: 12px; display: none; }
        .next-btn { background: var(--orange); border: none; border-radius: 10px; padding: 12px 24px; color: white; font-weight: 600; cursor: pointer; margin-top: 16px; display: none; }
        
        /* Modals */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.85); display: none; align-items: center; justify-content: center; z-index: 90000; padding: 20px; overflow-y: auto; pointer-events: none; }
        .modal-overlay.active { display: flex !important; pointer-events: auto; }
        .modal { background: linear-gradient(135deg, #1a2d4a 0%, var(--dark-bg) 100%); border: 1px solid var(--border); border-radius: 20px; max-width: 650px; width: 100%; max-height: 90vh; overflow-y: auto; padding: 32px; }
        .modal.large { max-width: 1000px; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .modal-header h2 { font-size: 22px; font-weight: 700; }
        .modal-close { background: none; border: none; color: var(--text-muted); font-size: 28px; cursor: pointer; }
        
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 14px 16px; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 10px; color: var(--text); font-size: 16px; box-sizing: border-box; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: var(--orange); }
        
        /* Global input styling for all text inputs */
        input[type="text"], input[type="email"], input[type="number"], input[type="date"], input[type="tel"], input[type="password"], textarea, select {
            padding: 12px 16px !important;
            box-sizing: border-box;
        }
        input::placeholder, textarea::placeholder {
            color: var(--text-muted);
            opacity: 0.7;
        }
        
        .result-box { padding: 20px; border-radius: 12px; margin-top: 20px; text-align: center; display: none; }
        .result-box.active { display: block; }
        .result-box.available { background: rgba(55,201,56,0.2); border: 1px solid var(--green); }
        .result-box.unavailable { background: rgba(239,68,68,0.2); border: 1px solid #ef4444; }
        
        .payment-breakdown { background: rgba(0,0,0,0.2); border-radius: 8px; padding: 16px; margin: 16px 0; }
        .payment-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border); }
        .payment-item:last-child { border-bottom: none; }
        .payment-total { font-weight: 700; color: var(--green); font-size: 18px; }
        
        .bg-form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .bg-form-grid .full-width { grid-column: 1 / -1; }
        
        .admin-tabs { display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; }
        .admin-tab { padding: 10px 16px; background: var(--card-bg); border: 1px solid var(--border); border-radius: 8px; color: var(--text-muted); cursor: pointer; font-size: 13px; }
        .admin-tab.active { background: var(--orange); color: white; border-color: var(--orange); }
        .admin-section { display: none; background: var(--card-bg); border: 1px solid var(--border); border-radius: 12px; padding: 20px; }
        .admin-section.active { display: block; }
        .admin-table { width: 100%; border-collapse: collapse; font-size: 12px; }
        .admin-table th, .admin-table td { padding: 10px 8px; text-align: left; border-bottom: 1px solid var(--border); }
        .admin-table th { background: rgba(0,0,0,0.2); color: var(--orange); }
        .admin-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 12px; margin-bottom: 20px; }
        .stat-card { background: rgba(0,0,0,0.2); border-radius: 8px; padding: 16px; text-align: center; }
        .stat-card .number { font-size: 32px; font-weight: 700; color: var(--orange); }
        .stat-card .label { font-size: 11px; color: var(--text-muted); }
        
        .toggle-switch { position: relative; width: 50px; height: 26px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .toggle-slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background: #ccc; border-radius: 26px; transition: 0.3s; }
        .toggle-slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px; background: white; border-radius: 50%; transition: 0.3s; }
        input:checked + .toggle-slider { background: var(--green); }
        input:checked + .toggle-slider:before { transform: translateX(24px); }
        
        .export-btn { background: var(--green); color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 13px; margin-right: 8px; }
        .clear-btn { background: #ef4444; color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 13px; }
        
        footer { padding: 30px 15px; text-align: center; color: var(--text-muted); font-size: 13px; border-top: 1px solid var(--border); margin-top: 40px; cursor: default; word-wrap: break-word; }
        footer a { color: var(--orange); }
        @media (max-width: 480px) { footer { font-size: 11px; line-height: 1.8; } footer br { display: none; } }
        
        @media (max-width: 768px) {
            .header-content { flex-direction: column; text-align: center; }
            .cta-row { flex-direction: column; align-items: center; }
            .btn-cta { width: 100%; max-width: 420px; }
            .trust-grid { grid-template-columns: 1fr; }
            .stats-banner { flex-direction: column; gap: 20px; }
            .directors-grid { grid-template-columns: 1fr 1fr; }
            .bg-form-grid { grid-template-columns: 1fr; }
        }
        /* NOT AVAILABLE Fallback */
        .not-available {
            text-align: center;
            padding: 60px 20px;
            background: linear-gradient(135deg, rgba(22, 52, 95, 0.3) 0%, rgba(15, 23, 42, 0.5) 100%);
            border-radius: 12px;
            border: 2px dashed var(--border);
        }
        .not-available-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }
        .not-available-text {
            font-size: 24px;
            font-weight: 700;
            color: var(--orange);
            margin-bottom: 12px;
        }
        .not-available p {
            color: var(--text-muted);
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="main-content-wrapper">
    <header>
        <div class="container header-content">
            <div class="header-left">
                <img src="data:image/png;base64,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" alt="A.P.E.X. Assessment - AREA SCOUTS - B.A.S.E." class="logo-image">
                                <div class="header-title">
                    <span class="line1">Become an <span class="green">A.P.E.X. Evaluator</span>, or Apply to</span>
                    <span class="line2">Join Our Worldwide Operations Team</span>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Hero Section -->
        <section class="hero-section">
            <button class="btn-availability" onclick="requireEmailThen('availabilityModal')">
                üîç Is Your Area & Sport Available?
            </button>
            <button class="what-is-link" onclick="openModal('whatIsAvailabilityModal')">What is this?</button>
            
            <h2 class="join-heading">Join the <span>#1 Athlete Health Initiative</span> in the World</h2>
            
            <p class="hero-description">
                <strong>AREA SCOUTS‚Ñ¢</strong> has partnered with <strong>The APEX Group</strong> to deliver the most advanced athlete development platform ever created. We are actively recruiting <strong>A.P.E.X. Evaluators</strong> and <strong>Operations Team Members</strong> nationwide to help combat the youth sports injury epidemic affecting 33 million young athletes annually.
            </p>
            
            <p class="hero-quote">"Real development. Real foundations. Real results. This is what separates us."</p>
            
            <p class="choose-path">üëâ Choose Your Path & SECURE YOUR PLACEMENT</p>
            
            <div class="cta-row">
                <div class="cta-wrapper">
                    <button class="btn-cta navy" onclick="requireEmailThen('evaluatorModal')">
                        üöÄ APPLY NOW - Become an A.P.E.X. Evaluator
                    </button>
                    <button class="what-is-link" onclick="openModal('whatIsEvaluatorModal')">What is this?</button>
                </div>
                <div class="cta-wrapper">
                    <button class="btn-cta orange" onclick="requireEmailThen('operationsModal')">
                        üíº APPLY NOW - For a Full-Time Operations Role
                    </button>
                    <button class="what-is-link" onclick="openModal('whatIsOperationsModal')">What is this?</button>
                </div>
            </div>
            
            <!-- Trust Section - 3 boxes reordered -->
            <section class="trust-section">
                <p class="trust-header" style="font-size: 28px; font-weight: 700; color: white; text-align: center; width: 100%; margin: 20px 0;">Trusted by over 3,000 Coaches Worldwide</p>
                
                <!-- LATEST EVENT SHOWCASE -->
                <div id="eventShowcase" style="margin: 30px auto; max-width: 600px; background: linear-gradient(135deg, rgba(237,112,35,0.15) 0%, rgba(22,52,95,0.3) 100%); border: 2px solid var(--orange); border-radius: 16px; overflow: hidden; position: relative;">
                    <div style="background: var(--orange); padding: 10px 20px; display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-weight: 700; font-size: 14px; color: white;">üì¢ LATEST: Area Scouts | A.P.E.X. Event</span>
                        <span id="eventDate" style="font-size: 12px; color: rgba(255,255,255,0.8);"></span>
                    </div>
                    <div style="position: relative;">
                        <img id="eventImage" src="" alt="Area Scouts Event" style="width: 100%; height: 300px; object-fit: cover; display: block; pointer-events: none; user-select: none;" oncontextmenu="trackDownloadAttempt(); return false;" ondragstart="return false;">
                        <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: transparent;" oncontextmenu="trackDownloadAttempt(); return false;"></div>
                    </div>
                    <div style="padding: 16px 20px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                        <div>
                            <div id="eventCoach" style="font-weight: 600; color: var(--text); font-size: 15px;"></div>
                            <div style="color: var(--text-muted); font-size: 13px;">Area Scouts Certified Evaluator</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 12px; color: var(--text-muted);"><span id="eventKids">0</span> Athletes Evaluated</div>
                            <div id="eventRevenue" style="font-size: 24px; font-weight: 700; color: var(--green);"></div>
                        </div>
                    </div>
                </div>
                
                <div class="trust-grid">
                    <div class="trust-box">
                        <div class="bullet">Collaborating with Top Athletes<br>across the World</div>
                        <div class="bullet">Pro Athletes from the NFL, NBA,<br>MLB, NHL and more</div>
                    </div>
                    <div class="trust-box">
                        <div class="bullet">Backed by Sports Medicine<br>Experts</div>
                        <div class="bullet">Teamed up with top Developers<br>and A.I. Engineers</div>
                    </div>
                    <div class="trust-box">
                        <div class="bullet">Partnered with The APEX Group,<br>National Program</div>
                        <div class="bullet">Launching into 30,000+<br>U.S. High Schools</div>
                    </div>
                </div>
            </section>
            
            <div class="built-by">
                <strong>AREA SCOUTS</strong> - BUILT BY PROFESSIONAL SPORTS INDUSTRY LEADERS, SPORTS MEDICINE DOCTORS,<br>
                PROFESSIONAL ATHLETES, SCOUTS AND RECRUITERS
            </div>
            
            <div class="league-logos">
                MLB  ‚Ä¢  NFL  ‚Ä¢  NBA  ‚Ä¢  WNBA  ‚Ä¢  NHL  ‚Ä¢  MLS  ‚Ä¢  PLL  ‚Ä¢  MLR  ‚Ä¢  PGA  ‚Ä¢  AND MORE
            </div>
        </section>
        
        <!-- Stats Banner - 3 boxes -->
        <section class="stats-banner">
            <div class="stat-item">
                <div class="stat-value">33M</div>
                <div class="stat-label">Youth Injuries/Year</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">75M</div>
                <div class="stat-label">Kids in Youth Sports</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">52%</div>
                <div class="stat-label">Quit Before High School</div>
            </div>
        </section>
        
        <!-- Resource & Waitlist Buttons -->
        <section class="buttons-section">
            <div class="resource-buttons">
                <button class="resource-btn" onclick="openVideoModal('testimonials')">üé• TESTIMONIALS</button>
                <button class="resource-btn" onclick="openVideoModal('presentations')">üìä PRESENTATIONS</button>
                <button class="resource-btn" onclick="openVideoModal('meetings')">üìÖ MEETINGS</button>
                <button class="resource-btn" onclick="openVideoModal('resources')">üìö RESOURCES</button>
                <button class="resource-btn" onclick="openVideoModal('qna')">‚ùì Q&A</button>
            </div>
            
            <div class="waitlist-buttons">
                <button class="btn-waitlist white" onclick="openModal('waitlistApexModal')">üìã APEX Evaluator Waiting List</button>
                <button class="btn-waitlist gold" onclick="openModal('waitlistAlertModal')">üì± Alert Reply Waiting List</button>
            </div>
        </section>
        
        <!-- Chat/Quiz Agent Section -->
        <section class="agent-section">
            <div class="agent-header">
                <button class="mode-btn active" data-mode="chat">üí¨ Chat</button>
                <button class="mode-btn" data-mode="coach">üéØ Coach</button>
                <button class="mode-btn" data-mode="quiz">üìù Quiz</button>
                <button class="mode-btn" data-mode="learn">üìö Learn</button>
            </div>
            
            <div class="chat-container" id="chatContainer">
                <div class="messages-area" id="messagesArea"></div>
                <div class="quick-prompts" id="quickPrompts"></div>
                <div class="input-area">
                    <textarea class="input-field" id="inputField" placeholder="Ask me anything about APEX..." rows="1"></textarea>
                    <button class="send-btn" id="sendBtn">Send</button>
                </div>
            </div>
            
            <div class="quiz-container" id="quizContainer">
                <div class="quiz-progress">
                    <span>Question <span id="questionNum">1</span> of <span id="totalQuestions">10</span></span>
                    <span class="quiz-score">Score: <span id="score">0</span></span>
                </div>
                <div class="quiz-question" id="quizQuestion"></div>
                <div class="quiz-options" id="quizOptions"></div>
                <div class="quiz-feedback" id="quizFeedback"></div>
                <button class="next-btn" id="nextBtn">Next Question ‚Üí</button>
            </div>
        </section>
    
        <!-- Directors Section -->
        <section class="directors-section" id="directorsSection">
            <div class="directors-header">
                <p class="directors-title">
                    üéØ Current And Former Directors, As Well As Those Who Have Played A Role Or Collaborated To Help Build Area Scouts, To Be The Top Athlete Development Platform In The World.
                </p>
                <button class="what-is-link" onclick="openModal('whatIsDirectorModal')">What is a Director?</button>
            </div>
            <div class="directors-grid" id="directorsGrid"></div>
        </section>
        </div>
    
    <footer id="mainFooter">
        Built from the official APEX Presentation ‚Ä¢ <a href="https://athletedevelopment.ai" target="_blank">athletedevelopment.ai</a> ‚Ä¢ Area Scouts since 2011<br>
        <span style="margin-top: 8px; display: inline-block;">üèÜ Mission: Combat the 33 million youth sports injuries per year</span><br>
        <span id="firebaseStatus" style="margin-top: 8px; display: inline-block; font-size: 11px; color: #666;">üîÑ Connecting to database...</span>
    </footer>
    </div><!-- End main-content-wrapper -->

    <!-- Modals -->
    
    <!-- Edit Director Modal -->
    <div class="modal-overlay" id="editDirectorModal">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <h2>‚úèÔ∏è Edit Director</h2>
                <button class="modal-close" onclick="closeModal('editDirectorModal')">&times;</button>
            </div>
            
            <div style="display: grid; grid-template-columns: 150px 1fr; gap: 24px; align-items: start;">
                <!-- Photo Section -->
                <div style="text-align: center;">
                    <img id="editDirectorPhoto" src="" style="width: 150px; height: 150px; border-radius: 12px; object-fit: cover; border: 3px solid var(--orange); margin-bottom: 12px;">
                    <input type="file" id="editDirectorPhotoInput" accept="image/*" style="display: none;" onchange="handleDirectorPhotoUpload(event)">
                    <button class="export-btn" onclick="document.getElementById('editDirectorPhotoInput').click()" style="width: 100%; margin-bottom: 8px;">üì§ Upload Photo</button>
                    <button class="export-btn" onclick="searchDirectorPhoto()" style="width: 100%; background: var(--purple);">üîç Google Search</button>
                    <p style="font-size: 10px; color: var(--text-muted); margin-top: 8px;">Find photo on Google, download it, then upload here</p>
                </div>
                
                <!-- Info Section -->
                <div>
                    <div class="form-group">
                        <label>Full Name *</label>
                        <input type="text" id="editDirectorName" placeholder="Dr. John Smith">
                    </div>
                    
                    <div class="form-group">
                        <label>Title / Bio *</label>
                        <textarea id="editDirectorTitle" rows="3" placeholder="Former MLB Pitcher, 12-Year Veteran" style="width: 100%; padding: 12px; border-radius: 8px; background: var(--card-bg); color: var(--text); border: 1px solid var(--border); resize: vertical;"></textarea>
                    </div>
                    
                    <div style="display: flex; gap: 8px; margin-bottom: 16px;">
                        <button class="export-btn" onclick="searchDirectorBio()" style="flex: 1; background: var(--green);">üîç Search Google for Bio</button>
                        <button class="export-btn" onclick="generateDirectorTitleAI()" style="flex: 1; background: var(--purple);">ü§ñ AI Generate Title</button>
                    </div>
                    
                    <input type="hidden" id="editDirectorIndex">
                    
                    <div style="display: flex; gap: 12px; margin-top: 20px; padding-top: 16px; border-top: 1px solid var(--border);">
                        <button class="export-btn" onclick="saveDirectorEdit()" style="flex: 1; padding: 14px; font-size: 16px; background: var(--green);">üíæ Save Changes</button>
                        <button class="clear-btn" onclick="closeModal('editDirectorModal')" style="padding: 14px 24px;">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Availability Modal -->
    <div class="modal-overlay" id="availabilityModal">
        <div class="modal">
            <div class="modal-header">
                <h2>üîç Check Your Area & Sport Availability</h2>
                <button class="modal-close" onclick="closeModal('availabilityModal')">&times;</button>
            </div>
            <p style="color: var(--green); font-weight: 600; margin-bottom: 20px; text-align: center;">‚ö° Areas & Sports are First-Come, First-Served Basis!</p>
            
            <div id="availabilityForm">
                <div class="form-group">
                    <label>State *</label>
                    <select id="avail_state" required>
                        <option value="">Select State...</option>
                        <option value="AL">Alabama</option><option value="AK">Alaska</option><option value="AZ">Arizona</option><option value="AR">Arkansas</option><option value="CA">California</option><option value="CO">Colorado</option><option value="CT">Connecticut</option><option value="DE">Delaware</option><option value="FL">Florida</option><option value="GA">Georgia</option><option value="HI">Hawaii</option><option value="ID">Idaho</option><option value="IL">Illinois</option><option value="IN">Indiana</option><option value="IA">Iowa</option><option value="KS">Kansas</option><option value="KY">Kentucky</option><option value="LA">Louisiana</option><option value="ME">Maine</option><option value="MD">Maryland</option><option value="MA">Massachusetts</option><option value="MI">Michigan</option><option value="MN">Minnesota</option><option value="MS">Mississippi</option><option value="MO">Missouri</option><option value="MT">Montana</option><option value="NE">Nebraska</option><option value="NV">Nevada</option><option value="NH">New Hampshire</option><option value="NJ">New Jersey</option><option value="NM">New Mexico</option><option value="NY">New York</option><option value="NC">North Carolina</option><option value="ND">North Dakota</option><option value="OH">Ohio</option><option value="OK">Oklahoma</option><option value="OR">Oregon</option><option value="PA">Pennsylvania</option><option value="RI">Rhode Island</option><option value="SC">South Carolina</option><option value="SD">South Dakota</option><option value="TN">Tennessee</option><option value="TX">Texas</option><option value="UT">Utah</option><option value="VT">Vermont</option><option value="VA">Virginia</option><option value="WA">Washington</option><option value="WV">West Virginia</option><option value="WI">Wisconsin</option><option value="WY">Wyoming</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Postal Code (5 digits) *</label>
                    <input type="text" id="avail_zip" placeholder="33066" maxlength="5">
                </div>
                <div class="form-group">
                    <label>Primary Sport *</label>
                    <select id="avail_sport" required>
                        <option value="">Select Sport...</option>
                        <option value="BASEBALL">Baseball</option>
                        <option value="BASKETBALL_MENS">Basketball (Men's)</option>
                        <option value="BASKETBALL_WOMENS">Basketball (Women's)</option>
                        <option value="BOWLING">Bowling</option>
                        <option value="CHEERLEADING">Cheerleading</option>
                        <option value="CROSS_COUNTRY">Cross Country</option>
                        <option value="FENCING">Fencing</option>
                        <option value="FIELD_HOCKEY">Field Hockey</option>
                        <option value="FOOTBALL">Football</option>
                        <option value="GOLF_MENS">Golf (Men's)</option>
                        <option value="GOLF_WOMENS">Golf (Women's)</option>
                        <option value="GYMNASTICS">Gymnastics</option>
                        <option value="HOCKEY">Hockey</option>
                        <option value="LACROSSE_MENS">Lacrosse (Men's)</option>
                        <option value="LACROSSE_WOMENS">Lacrosse (Women's)</option>
                        <option value="ROWING">Rowing</option>
                        <option value="RUGBY">Rugby</option>
                        <option value="SKIING">Skiing</option>
                        <option value="SOCCER_MENS">Soccer (Men's)</option>
                        <option value="SOCCER_WOMENS">Soccer (Women's)</option>
                        <option value="SOFTBALL">Softball</option>
                        <option value="SWIMMING">Swimming</option>
                        <option value="TENNIS_MENS">Tennis (Men's)</option>
                        <option value="TENNIS_WOMENS">Tennis (Women's)</option>
                        <option value="TRACK_FIELD">Track & Field</option>
                        <option value="VOLLEYBALL">Volleyball</option>
                        <option value="WATER_POLO">Water Polo</option>
                        <option value="WRESTLING">Wrestling</option>
                        <option value="OTHER">Other</option>
                    </select>
                </div>
                <button type="button" class="btn-cta navy" style="width: 100%;" onclick="checkAvailability()">üîç Check Availability Now</button>
            </div>
            
            <div class="result-box available" id="resultAvailable">
                <h3 style="color: var(--green);">üéâ GREAT NEWS!</h3>
                <p id="availableText" style="margin: 10px 0;"></p>
                <button class="btn-cta navy" style="width: 100%; margin-top: 15px;" onclick="showPaymentStep()">‚úÖ Secure This Area NOW!</button>
                <button class="what-is-link" style="margin-top: 10px;" onclick="resetAvailability()">üîÑ Search Another Area/Sport</button>
            </div>
            
            <div class="result-box unavailable" id="resultUnavailable">
                <h3 style="color: #ef4444;">üòî Area Currently Taken</h3>
                <p id="unavailableText" style="margin: 10px 0;"></p>
                <button class="btn-waitlist white" style="margin-top: 15px;" onclick="closeModal('availabilityModal'); openModal('waitlistApexModal');">üìã Join APEX Evaluator Waiting List</button>
                <button class="what-is-link" style="margin-top: 10px;" onclick="resetAvailability()">üîÑ Search Another Area/Sport</button>
            </div>
            
            <div id="paymentStep" style="display: none;">
                <h3 style="margin-bottom: 16px;">üí≥ Complete your payment to Secure your Area and Sport.</h3>
                <div class="payment-breakdown">
                    <div class="payment-item"><span>Initial Background Check</span><span>$79</span></div>
                    <div class="payment-item"><span>Onboard | Setup (One-Time)</span><span>$25</span></div>
                    <div class="payment-item"><span>Postal Code Fee (Monthly)</span><span>$15</span></div>
                    <div class="payment-item payment-total"><span>TOTAL</span><span>$119</span></div>
                </div>
                <p style="font-size: 12px; color: var(--text-muted); text-align: center;">*100% Refundable if Application is Denied</p>
                <button class="btn-cta navy" style="width: 100%; margin-top: 16px;" onclick="openStripeCheckout()">üí≥ Proceed to Secure Checkout</button>

            </div>
            
            <div id="backgroundStep" style="display: none;">
                <h3 style="margin-bottom: 16px;">üìã Complete Background Check</h3>
                <div class="bg-form-grid">
                    <div class="form-group"><label>First Name *</label><input type="text" id="bg_firstName"></div>
                    <div class="form-group"><label>Last Name *</label><input type="text" id="bg_lastName"></div>
                    <div class="form-group"><label>Email *</label><input type="email" id="bg_email"></div>
                    <div class="form-group"><label>Phone *</label><input type="tel" id="bg_phone"></div>
                    <div class="form-group"><label>Date of Birth *</label><input type="date" id="bg_dob"></div>
                    <div class="form-group"><label>Years Coaching *</label><input type="number" id="bg_years" min="0"></div>
                    <div class="form-group full-width"><label>Street Address *</label><input type="text" id="bg_street"></div>
                    <div class="form-group"><label>City *</label><input type="text" id="bg_city"></div>
                    <div class="form-group"><label>State *</label><input type="text" id="bg_state"></div>
                    <div class="form-group"><label>ZIP Code *</label><input type="text" id="bg_zip"></div>
                    <div class="form-group"><label>Highest Level Coached</label><select id="bg_level"><option value="">Select...</option><option>Youth</option><option>Middle School</option><option>High School</option><option>College</option><option>Professional</option></select></div>
                    <div class="form-group full-width"><label>Certifications (optional)</label><textarea id="bg_certs" rows="2"></textarea></div>
                    <div class="form-group full-width"><label><input type="checkbox" id="bg_consent"> I consent to a background check</label></div>
                    <div class="form-group full-width"><label><input type="checkbox" id="bg_terms"> I agree to the Terms & Conditions</label></div>
                </div>
                <button class="btn-cta navy" style="width: 100%; margin-top: 16px;" onclick="submitBackgroundCheck()">‚úÖ Submit Background Check</button>
            </div>
            
            <div id="confirmationStep" style="display: none;">
                <div style="background: rgba(55,201,56,0.15); border: 1px solid var(--green); border-radius: 12px; padding: 24px; text-align: center;">
                    <h3 style="color: var(--green);">üéâ AREA RESERVED!</h3>
                    <div style="background: rgba(0,0,0,0.3); border-radius: 8px; padding: 16px; margin: 16px 0;">
                        <div style="font-size: 12px; color: var(--text-muted);">AUTHORIZATION CODE</div>
                        <div id="authCodeDisplay" style="font-family: monospace; font-size: 24px; color: var(--green);">AS-XXXXXX</div>
                    </div>
                    <p style="color: var(--text-muted);">Our team will contact you within 24-48 hours.</p>
                </div>
                <button class="btn-cta navy" style="width: 100%; margin-top: 20px;" onclick="closeModal('availabilityModal'); location.reload();">‚úÖ Got It - Return to Main Page</button>
            </div>
        </div>
    </div>

    <!-- Waitlist APEX Modal -->
    <div class="modal-overlay" id="waitlistApexModal">
        <div class="modal">
            <div class="modal-header">
                <h2>üìã APEX Evaluator Waiting List</h2>
                <button class="modal-close" onclick="closeModal('waitlistApexModal')">&times;</button>
            </div>
            <div class="not-available">
                <div class="not-available-icon">üìã</div>
                <div class="not-available-text">NOT AVAILABLE</div>
                <h3 style="color: var(--orange); margin:16px 0;">Form Currently Unavailable</h3>
                <p style="color: var(--text-muted);">To join the APEX Evaluator Waiting List,<br>please contact us directly:</p>
                <a href="/cdn-cgi/l/email-protection#61121411110e1315210013040012020e1415124f020e0c" style="color: var(--orange); font-size: 18px; display: block; margin: 16px 0;"><span class="__cf_email__" data-cfemail="95e6e0e5e5fae7e1d5f4e7f0f4e6f6fae0e1e6bbf6faf8">[email&#160;protected]</span></a>
                <p style="color: var(--text-muted); font-size: 14px; margin-top: 20px;">Or call: <strong style="color: var(--text);">(954) 555-APEX</strong></p>
            </div>
        </div>
    </div>

    <!-- Waitlist Alert Modal -->
    <div class="modal-overlay" id="waitlistAlertModal">
        <div class="modal">
            <div class="modal-header">
                <h2>üì± Alert Reply Waiting List</h2>
                <button class="modal-close" onclick="closeModal('waitlistAlertModal')">&times;</button>
            </div>
            <div class="not-available">
                <div class="not-available-icon">üì±</div>
                <div class="not-available-text">NOT AVAILABLE</div>
                <h3 style="color: var(--orange); margin:16px 0;">Form Currently Unavailable</h3>
                <p style="color: var(--text-muted);">To join the Alert Reply Waiting List,<br>please contact us directly:</p>
                <a href="/cdn-cgi/l/email-protection#8ffcfaffffe0fdfbcfeefdeaeefcece0fafbfca1ece0e2" style="color: var(--orange); font-size: 18px; display: block; margin: 16px 0;"><span class="__cf_email__" data-cfemail="b8cbcdc8c8d7caccf8d9caddd9cbdbd7cdcccb96dbd7d5">[email&#160;protected]</span></a>
                <p style="color: var(--text-muted); font-size: 14px; margin-top: 20px;">Or call: <strong style="color: var(--text);">(954) 555-APEX</strong></p>
            </div>
        </div>
    </div>

    <!-- What Is Modals -->
    <div class="modal-overlay" id="whatIsAvailabilityModal">
        <div class="modal small">
            <div class="modal-header"><h2>üîç Check Area Availability</h2><button class="modal-close" onclick="closeModal('whatIsAvailabilityModal')">&times;</button></div>
            <p>Territories are assigned exclusively on a first-come, first-served basis. Only ONE evaluator per postal code per sport is permitted.</p>
            <p style="margin-top:12px;">Enter your state, postal code, and primary sport to instantly check if your Desired Area is still available.</p>
        </div>
    </div>

    <div class="modal-overlay" id="whatIsEvaluatorModal">
        <div class="modal small">
            <div class="modal-header"><h2>üöÄ Become an A.P.E.X. Evaluator</h2><button class="modal-close" onclick="closeModal('whatIsEvaluatorModal')">&times;</button></div>
            <p>As an A.P.E.X. Evaluator, you'll conduct NFL-grade movement assessments (B.A.S.E.) for youth athletes, helping identify injury risks and performance opportunities.</p>
            <ul style="margin-top:12px; padding-left:20px; color: var(--text-muted);">
                <li>Exclusive area rights</li>
                <li>$79 per assessment</li>
                <li>Comprehensive training</li>
                <li>Ongoing support</li>
            </ul>
        </div>
    </div>

    <div class="modal-overlay" id="whatIsOperationsModal">
        <div class="modal small">
            <div class="modal-header"><h2>üíº Operations Team Role</h2><button class="modal-close" onclick="closeModal('whatIsOperationsModal')">&times;</button></div>
            <p>Join our worldwide operations team to help manage and grow the APEX network. Full-time positions available in various departments.</p>
        </div>
    </div>

    <div class="modal-overlay" id="whatIsDirectorModal">
        <div class="modal small">
            <div class="modal-header"><h2>üéØ What is a Director?</h2><button class="modal-close" onclick="closeModal('whatIsDirectorModal')">&times;</button></div>
            <p>Directors are key contributors who have helped build Area Scouts into the top athlete development platform. They include professional athletes, sports medicine experts, coaches, and industry leaders.</p>
        </div>
    </div>

    <!-- Video Resource Modals -->
    <div class="modal-overlay" id="testimonialsModal">
        <div class="modal">
            <div class="modal-header"><h2>üé• Testimonials</h2><button class="modal-close" onclick="closeModal('testimonialsModal')">&times;</button></div>
            <div id="testimonialsContent"><p style="text-align:center; color:var(--text-muted);">Video content coming soon...</p></div>
        </div>
    </div>
    <!-- Video modals now use videoResourceModal instead of individual modals -->

    <!-- Evaluator Application Modal -->
    <div class="modal-overlay" id="evaluatorModal">
        <div class="modal">
            <div class="modal-header"><h2>üöÄ Become an A.P.E.X. Evaluator</h2><button class="modal-close" onclick="closeModal('evaluatorModal')">&times;</button></div>
            <div class="not-available">
                <div class="not-available-icon">üöÄ</div>
                <div class="not-available-text">NOT AVAILABLE</div>
                <h3 style="color: var(--orange); margin:16px 0;">Form Currently Unavailable</h3>
                <p style="color: var(--text-muted);">To become an A.P.E.X. Evaluator, please use the green<br>"Check Your Area & Sport Availability" button above.</p>
                <p style="color: var(--text-muted); margin-top: 16px;">Or contact us directly:</p>
                <a href="/cdn-cgi/l/email-protection#265553565649545266475443475545495352550845494b" style="color: var(--orange); font-size: 18px; display: block; margin: 16px 0;"><span class="__cf_email__" data-cfemail="5b282e2b2b34292f1b3a293e3a2838342e2f2875383436">[email&#160;protected]</span></a>
            </div>
        </div>
    </div>

    <!-- Operations Application Modal -->
    <div class="modal-overlay" id="operationsModal">
        <div class="modal">
            <div class="modal-header"><h2>üíº Operations Team Application</h2><button class="modal-close" onclick="closeModal('operationsModal'); resetOpsQuiz();">&times;</button></div>
            
            <!-- Qualification Quiz -->
            <div id="opsQuizSection">
                <p style="color: var(--green); margin-bottom: 20px; text-align: center;"><strong>üìã Qualification Assessment</strong><br><span style="color: var(--text-muted); font-size: 13px;">Please answer the following questions to proceed with your application.</span></p>
                
                <div id="opsQuizContainer">
                    <div class="quiz-progress" style="margin-bottom: 16px; padding-bottom: 16px; border-bottom: 1px solid var(--border);">
                        <span>Question <span id="opsQuestionNum">1</span> of <span id="opsTotalQuestions">5</span></span>
                        <span style="color: var(--orange);">Score: <span id="opsScore">0</span></span>
                    </div>
                    <div id="opsQuizQuestion" style="font-size: 16px; font-weight: 600; margin-bottom: 16px;"></div>
                    <div id="opsQuizOptions" style="display: flex; flex-direction: column; gap: 10px;"></div>
                </div>
            </div>
            
            <!-- Fail Message -->
            <div id="opsFailSection" style="display: none;">
                <div class="not-available">
                    <div class="not-available-icon">üìã</div>
                    <div class="not-available-text">Additional Experience Needed</div>
                    <p style="color: var(--text-muted); margin: 16px 0;">Based on your responses, we recommend gaining more experience before applying for an Operations role.</p>
                    <p style="color: var(--text); margin: 16px 0;"><strong>Consider these alternatives:</strong></p>
                    <button class="btn-cta navy" style="width: 100%; margin-bottom: 10px;" onclick="closeModal('operationsModal'); openModal('availabilityModal');">üöÄ Become an A.P.E.X. Evaluator</button>
                    <button class="btn-waitlist white" style="width: 100%;" onclick="closeModal('operationsModal'); openModal('waitlistApexModal');">üìã Join Evaluator Waiting List</button>
                </div>
            </div>
            
            <!-- Success - Application Form -->
            <div id="opsSuccessSection" style="display: none;">
                <div style="background: rgba(55,201,56,0.15); border: 1px solid var(--green); border-radius: 12px; padding: 16px; margin-bottom: 20px; text-align: center;">
                    <h3 style="color: var(--green);">‚úÖ Qualified!</h3>
                    <p style="color: var(--text-muted);">You may proceed with your application.</p>
                </div>
                <div class="form-group"><label>Full Name *</label><input type="text" id="ops_name"></div>
                <div class="form-group"><label>Email *</label><input type="email" id="ops_email"></div>
                <div class="form-group"><label>Phone *</label><input type="tel" id="ops_phone"></div>
                <div class="form-group"><label>Position Interest</label>
                    <select id="ops_position" style="width:100%;">
                        <option value="">Select position...</option>
                        <option value="regional_director">Regional Director</option>
                        <option value="sales">Sales Representative</option>
                        <option value="support">Customer Support</option>
                        <option value="marketing">Marketing</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group"><label>Tell us about your experience</label><textarea id="ops_experience" rows="4" placeholder="Describe your relevant experience..."></textarea></div>
                <button class="btn-cta navy" style="width: 100%;" onclick="submitOpsApplication()">üì§ Submit Application</button>
            </div>
        </div>
    </div>

    <!-- Admin Modal -->
    <div class="modal-overlay" id="adminModal">
        <div class="modal large">
            <div class="modal-header"><h2>üîê Admin Dashboard</h2><button class="modal-close" onclick="closeScreen('admin')" title="Minimize to taskbar">‚àí</button></div>
            <div id="adminLogin">
                <div class="form-group"><label>Password</label><input type="password" id="adminPassword" onkeypress="if(event.key==='Enter')verifyAdmin()"></div>
                <button class="btn-cta navy" style="width:100%;" onclick="verifyAdmin()">Login</button>
            </div>
            <div id="adminDashboard" style="display:none;">
                <div class="admin-tabs">
                    <button class="admin-tab active" onclick="showAdminTab('overview')">üìà Overview</button>
                    <button class="admin-tab" onclick="showAdminTab('leads')">üéØ Leads</button>
                    <button class="admin-tab" onclick="showAdminTab('reservations')">‚úÖ Reservations</button>
                    <button class="admin-tab" onclick="showAdminTab('directors')">üë• Directors</button>
                    <button class="admin-tab" onclick="showAdminTab('videos')">üé• Videos</button>
                    <button class="admin-tab" onclick="showAdminTab('ailearn')">üß† AI Learn</button>
                    <button class="admin-tab" onclick="showAdminTab('events')">üì¢ Events</button>
                    <button class="admin-tab" onclick="showAdminTab('activity')">üìä Activity</button>
                    <button class="admin-tab" onclick="showAdminTab('users')">üë§ Users</button>
                    <button class="admin-tab" onclick="showAdminTab('unanswered')">‚ùì Q&A</button>
                    <button class="admin-tab" onclick="showAdminTab('email')">üìß Email</button>
                    <button class="admin-tab" onclick="showAdminTab('content')">‚úèÔ∏è Content</button>
                    <button class="admin-tab" onclick="showAdminTab('analytics')">üìâ Analytics</button>
                    <button class="admin-tab" onclick="showAdminTab('settings')">‚öôÔ∏è Settings</button>
                    <button class="admin-tab" onclick="logoutAdmin()" style="background:#dc3545; margin-left:auto;">üö™ Logout</button>
                </div>
                
                <!-- OVERVIEW TAB -->
                <div class="admin-section active" id="tab-overview">
                    <h4 style="margin-bottom:16px; color: var(--orange);">üìà Dashboard Overview</h4>
                    <div class="admin-grid" id="overviewStats"></div>
                    <div style="margin-top:20px; display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                        <div style="background:rgba(0,0,0,0.2); border-radius:12px; padding:20px;">
                            <h5 style="color:var(--orange); margin-bottom:12px;">üî• Recent Activity</h5>
                            <div id="recentActivityList" style="font-size:12px; max-height:200px; overflow-y:auto;"></div>
                        </div>
                        <div style="background:rgba(0,0,0,0.2); border-radius:12px; padding:20px;">
                            <h5 style="color:var(--orange); margin-bottom:12px;">üìä Quick Stats</h5>
                            <div id="quickStatsChart"></div>
                        </div>
                    </div>
                </div>
                
                <!-- LEADS TAB -->
                <div class="admin-section" id="tab-leads">
                    <h4 style="margin-bottom:16px; color: var(--orange);">üéØ Lead Management</h4>
                    <div style="display:flex; gap:10px; margin-bottom:16px; flex-wrap:wrap;">
                        <button class="export-btn" onclick="exportLeads()">üì• Export Leads CSV</button>
                        <button class="export-btn" onclick="refreshLeads()">üîÑ Refresh</button>
                        <select id="leadFilter" onchange="filterLeads()" style="padding:8px; border-radius:8px; background:var(--card-bg); color:var(--text); border:1px solid var(--border);">
                            <option value="all">All Leads</option>
                            <option value="new">New (Uncontacted)</option>
                            <option value="contacted">Contacted</option>
                            <option value="qualified">Qualified</option>
                            <option value="converted">Converted</option>
                        </select>
                    </div>
                    <div style="overflow-x:auto; max-height:400px;">
                        <table class="admin-table" id="leadsTable">
                            <thead><tr><th>Date</th><th>Name</th><th>Email</th><th>Phone</th><th>State</th><th>Sport</th><th>Status</th><th>Actions</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
                
                <!-- RESERVATIONS TAB -->
                <div class="admin-section" id="tab-reservations">
                    <h4 style="margin-bottom:16px; color: var(--orange);">‚úÖ Area Reservations</h4>
                    <div style="display:flex; gap:10px; margin-bottom:16px; flex-wrap:wrap;">
                        <button class="export-btn" onclick="exportReservations()">üì• Export CSV</button>
                        <select id="reservationFilter" onchange="filterReservations()" style="padding:8px; border-radius:8px; background:var(--card-bg); color:var(--text); border:1px solid var(--border);">
                            <option value="all">All Reservations</option>
                            <option value="pending">Pending Background Check</option>
                            <option value="approved">Approved</option>
                            <option value="active">Active Evaluators</option>
                        </select>
                    </div>
                    <div style="overflow-x:auto; max-height:400px;">
                        <table class="admin-table" id="reservationsTable">
                            <thead><tr><th>Auth Code</th><th>Date</th><th>Name</th><th>State</th><th>Zip</th><th>Sport</th><th>Status</th><th>Actions</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
                
                <!-- DIRECTORS TAB -->
                <div class="admin-section" id="tab-directors">
                    <h4 style="margin-bottom:16px; color: var(--orange);">üë• Manage Directors</h4>
                    <div style="display:flex; gap:10px; margin-bottom:16px; flex-wrap:wrap;">
                        <input type="text" id="newDirectorName" placeholder="Director Name" style="flex:1; min-width:200px; padding: 12px 16px; border-radius: 8px; background: var(--card-bg); color: var(--text); border: 1px solid var(--border);">
                        <input type="text" id="newDirectorTitle" placeholder="Title (optional)" style="width:150px; padding: 12px 16px; border-radius: 8px; background: var(--card-bg); color: var(--text); border: 1px solid var(--border);">
                        <button class="export-btn" onclick="addDirector()">‚ûï Add Director</button>
                        <button class="export-btn" onclick="importDirectors()">üì• Import CSV</button>
                        <button class="export-btn" onclick="exportDirectors()">üì§ Export CSV</button>
                    </div>
                    <div style="margin-bottom:16px;">
                        <span style="color:var(--text-muted);">Total Directors: <strong id="directorCount" style="color:var(--orange);">0</strong></span>
                    </div>
                    <div id="adminDirectorsList" style="max-height:500px; overflow-y:auto;"></div>
                </div>
                
                <!-- VIDEOS TAB -->
                <div class="admin-section" id="tab-videos">
                    <h4 style="margin-bottom:16px; color: var(--orange);">üé• Video Resource Links</h4>
                    <p style="color:var(--text-muted); margin-bottom:20px;">Paste YouTube URLs for each resource category. Videos will appear in modals when users click resource buttons.</p>
                    <div class="form-group"><label>üé¨ Testimonials Video</label><input type="text" id="video_testimonials" placeholder="https://youtube.com/watch?v=..."><button class="export-btn" style="margin-left:10px;" onclick="previewVideo('testimonials')">üëÅÔ∏è Preview</button></div>
                    <div class="form-group"><label>üìä Presentations Video</label><input type="text" id="video_presentations" placeholder="https://youtube.com/watch?v=..."><button class="export-btn" style="margin-left:10px;" onclick="previewVideo('presentations')">üëÅÔ∏è Preview</button></div>
                    <div class="form-group"><label>üìÖ Meetings Video</label><input type="text" id="video_meetings" placeholder="https://youtube.com/watch?v=..."><button class="export-btn" style="margin-left:10px;" onclick="previewVideo('meetings')">üëÅÔ∏è Preview</button></div>
                    <div class="form-group"><label>üìö Resources Video</label><input type="text" id="video_resources" placeholder="https://youtube.com/watch?v=..."><button class="export-btn" style="margin-left:10px;" onclick="previewVideo('resources')">üëÅÔ∏è Preview</button></div>
                    <div class="form-group"><label>‚ùì Q&A Video</label><input type="text" id="video_qna" placeholder="https://youtube.com/watch?v=..."><button class="export-btn" style="margin-left:10px;" onclick="previewVideo('qna')">üëÅÔ∏è Preview</button></div>
                    <button class="export-btn" onclick="saveVideos()" style="margin-top:16px;">üíæ Save All Videos</button>
                </div>
                
                <!-- AI LEARN TAB -->
                <div class="admin-section" id="tab-ailearn">
                    <h4 style="margin-bottom:16px; color: var(--orange);">üß† AI Learning Center</h4>
                    <p style="color:var(--text-muted); margin-bottom:20px;">Train the AI agent by adding video URLs. The AI will transcribe and learn from them, improving chat responses and generating new quiz questions.</p>
                    
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-bottom:20px;">
                        <div class="stat-card" style="background:rgba(55,201,56,0.1); border:1px solid var(--green);">
                            <div class="number" id="learnedVideos" style="color:var(--green);">0</div>
                            <div class="label">Videos Learned</div>
                        </div>
                        <div class="stat-card" style="background:rgba(237,112,35,0.1); border:1px solid var(--orange);">
                            <div class="number" id="knowledgeItems" style="color:var(--orange);">0</div>
                            <div class="label">Knowledge Items</div>
                        </div>
                    </div>
                    
                    <div style="background:rgba(0,0,0,0.2); padding:20px; border-radius:12px; margin-bottom:20px;">
                        <h5 style="color:var(--green); margin-bottom:12px;">‚ûï Add Video to Learn From</h5>
                        <div class="form-group">
                            <label>YouTube URL</label>
                            <input type="text" id="learnVideoUrl" placeholder="https://youtube.com/watch?v=...">
                        </div>
                        <div class="form-group">
                            <label>Video Title/Topic</label>
                            <input type="text" id="learnVideoTitle" placeholder="e.g., APEX Introduction, BASE Protocol Explained">
                        </div>
                        <button class="export-btn" onclick="learnFromVideo()" style="width:100%;">üß† LEARN FROM THIS VIDEO</button>
                        <p style="font-size:11px; color:var(--text-muted); margin-top:8px;">Cost: ~$0.006/min for transcription + ~$0.01 for AI processing</p>
                    </div>
                    
                    <div style="background:rgba(0,0,0,0.2); padding:20px; border-radius:12px; margin-bottom:20px;">
                        <h5 style="color:var(--orange); margin-bottom:12px;">üìù Add Knowledge Manually</h5>
                        <div class="form-group">
                            <label>Topic/Question</label>
                            <input type="text" id="manualTopic" placeholder="e.g., What is the APEX program?">
                        </div>
                        <div class="form-group">
                            <label>Knowledge/Answer</label>
                            <textarea id="manualKnowledge" rows="4" placeholder="Enter the correct information..."></textarea>
                        </div>
                        <button class="export-btn" onclick="addManualKnowledge()">‚ûï Add to Knowledge Base</button>
                    </div>
                    
                    <div style="background:rgba(55,201,56,0.1); padding:20px; border-radius:12px; margin-bottom:20px;">
                        <h5 style="color:var(--green); margin-bottom:12px;">üéØ Generate New Quiz Questions</h5>
                        <p style="color:var(--text-muted); margin-bottom:12px;">AI will create new quiz questions based on learned knowledge.</p>
                        <button class="export-btn" onclick="generateQuizQuestions()">üé≤ Generate 5 New Questions</button>
                        <div id="generatedQuestions" style="margin-top:16px;"></div>
                    </div>
                    
                    <h5 style="margin-bottom:12px; color:var(--text);">üìö Current Knowledge Base</h5>
                    <div id="knowledgeList" style="max-height:300px; overflow-y:auto;"></div>
                    
                    <div style="margin-top:20px; display:flex; gap:10px;">
                        <button class="export-btn" onclick="exportKnowledge()">üì• Export Knowledge</button>
                        <button class="clear-btn" onclick="clearKnowledge()">üóëÔ∏è Clear All Knowledge</button>
                    </div>
                </div>
                
                <!-- EVENTS SHOWCASE TAB -->
                <div class="admin-section" id="tab-events">
                    <h4 style="margin-bottom:16px; color: var(--orange);">üì¢ Event Showcase Settings</h4>
                    <p style="color:var(--text-muted); margin-bottom:20px;">Upload real event photos to showcase on the main page with revenue calculations.</p>
                    
                    <!-- Master Control -->
                    <div style="background:rgba(55,201,56,0.1); border:1px solid var(--green); border-radius:12px; padding:16px; margin-bottom:24px;">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <span style="font-weight:600; color:var(--green);">üì¢ Show Event Showcase on Main Page</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="eventShowcaseEnabled" onchange="toggleEventShowcase()" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Upload Event Images -->
                    <div style="background:rgba(237,112,35,0.1); padding:24px; border-radius:12px; margin-bottom:24px; border:2px solid var(--orange);">
                        <h5 style="color:var(--orange); margin-bottom:16px; font-size:18px;">üì∏ Upload Event Photo</h5>
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:16px; margin-bottom:16px;">
                            <div class="form-group" style="margin:0;">
                                <label>Coach Name *</label>
                                <input type="text" id="uploadCoachName" placeholder="Coach John Smith">
                            </div>
                            <div class="form-group" style="margin:0;">
                                <label>Event Date *</label>
                                <input type="date" id="uploadEventDate">
                            </div>
                            <div class="form-group" style="margin:0;">
                                <label># of Athletes in Photo *</label>
                                <input type="number" id="uploadAthleteCount" placeholder="12" min="1" max="100">
                            </div>
                            <div class="form-group" style="margin:0;">
                                <label>Location (optional)</label>
                                <input type="text" id="uploadEventLocation" placeholder="Dallas, TX">
                            </div>
                        </div>
                        <button class="export-btn" onclick="uploadEventImage()" style="padding:14px 28px; font-size:16px;">üì§ Select & Upload Event Photo</button>
                        <input type="file" id="eventImageUpload" accept="image/*" style="display:none;" onchange="handleEventImageUpload(event)">
                        <p style="color:var(--text-muted); font-size:12px; margin-top:12px;">üí∞ Revenue will auto-calculate: # Athletes √ó Random Price ($79-$199)</p>
                    </div>
                    
                    <!-- Current Event Images -->
                    <h5 style="margin-bottom:12px; color:var(--text);">üì∑ Event Image Gallery (<span id="eventImageCount">0</span>)</h5>
                    <div id="eventImageGallery" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap:16px; max-height:500px; overflow-y:auto;"></div>
                    
                    <!-- Download Attempt Tracking -->
                    <div style="margin-top:24px; padding:16px; background:rgba(239,68,68,0.1); border:1px solid #ef4444; border-radius:12px;">
                        <h5 style="color:#ef4444; margin-bottom:8px;">üö® Download Attempts Tracked: <span id="downloadAttemptCount">0</span></h5>
                        <p style="color:var(--text-muted); font-size:12px; margin-bottom:8px;">Users who try to right-click or download event images are logged here.</p>
                        <div id="downloadAttemptLog" style="max-height:150px; overflow-y:auto; font-size:12px; color:var(--text-muted);"></div>
                    </div>
                </div>
                
                <!-- ACTIVITY TAB -->
                <div class="admin-section" id="tab-activity">
                    <h4 style="margin-bottom:16px; color: var(--orange);">üìä Activity & IP Log</h4>
                    <div style="display:flex; gap:10px; margin-bottom:16px; flex-wrap:wrap;">
                        <button class="export-btn" onclick="exportActivity()">üì• Export CSV</button>
                        <button class="clear-btn" onclick="clearActivity()">üóëÔ∏è Clear Log</button>
                        <input type="text" id="activitySearch" placeholder="Search activity..." oninput="searchActivity()" style="flex:1; min-width:150px; padding: 12px 16px; border-radius: 8px; background: var(--card-bg); color: var(--text); border: 1px solid var(--border);">
                        <select id="activityFilter" onchange="filterActivity()" style="padding:8px; border-radius:8px; background:var(--card-bg); color:var(--text); border:1px solid var(--border);">
                            <option value="all">All Actions</option>
                            <option value="Page Load">Page Loads</option>
                            <option value="Modal">Modal Opens</option>
                            <option value="Availability">Availability Checks</option>
                            <option value="Chat">Chat Messages</option>
                            <option value="Quiz">Quiz Activity</option>
                            <option value="Button">Button Clicks</option>
                            <option value="Video">Video Watches</option>
                            <option value="Scroll">Scroll Depth</option>
                        </select>
                    </div>
                    <div style="overflow-x:auto; max-height:400px;">
                        <table class="admin-table" id="activityTable">
                            <thead><tr><th>Time</th><th>Email</th><th>IP Address</th><th>Action</th><th>Details</th><th>Location</th><th>Session(s)</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
                
                <!-- USER PROFILES TAB -->
                <div class="admin-section" id="tab-users">
                    <h4 style="margin-bottom:16px; color: var(--orange);">üë§ User Profiles & Behavior</h4>
                    <p style="color:var(--text-muted); margin-bottom:16px;">Comprehensive user tracking for marketing campaigns. Click a user to see full details.</p>
                    <div style="display:flex; gap:10px; margin-bottom:16px; flex-wrap:wrap;">
                        <button class="export-btn" onclick="exportUsers()">üì• Export All Users CSV</button>
                        <button class="export-btn" onclick="exportUsersDetailed()">üì• Export Detailed JSON</button>
                        <span style="color:var(--text-muted); padding:8px;">Total Users: <strong id="totalUsers" style="color:var(--orange);">0</strong></span>
                    </div>
                    <div style="overflow-x:auto; max-height:500px;">
                        <table class="admin-table" id="usersTable">
                            <thead><tr><th>Email</th><th>Location</th><th>First Visit</th><th>Last Visit</th><th>Sessions</th><th>Time on Site</th><th>Quiz Score</th><th>Interests</th><th>Actions</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
                
                <!-- UNANSWERED Q&A TAB -->
                <div class="admin-section" id="tab-unanswered">
                    <h4 style="margin-bottom:16px; color: var(--orange);">‚ùì Unanswered Questions & Custom Answers</h4>
                    <p style="color:var(--text-muted); margin-bottom:20px;">Questions marked "NO" by users appear here. Add custom answers to improve the AI chat.</p>
                    <div style="margin-bottom:20px; padding:16px; background:rgba(55,201,56,0.1); border:1px solid var(--green); border-radius:8px;">
                        <h5 style="color:var(--green); margin-bottom:8px;">‚ûï Add Custom Q&A</h5>
                        <div class="form-group"><input type="text" id="customQuestion" placeholder="Question (keywords)"></div>
                        <div class="form-group"><textarea id="customAnswer" placeholder="Answer (supports **bold** formatting)" rows="3"></textarea></div>
                        <button class="export-btn" onclick="addCustomQA()">Add to Knowledge Base</button>
                    </div>
                    <h5 style="margin-bottom:12px;">Pending Questions:</h5>
                    <div id="unansweredList" style="max-height:300px; overflow-y:auto;"></div>
                </div>
                
                <!-- EMAIL SETTINGS TAB -->
                <div class="admin-section" id="tab-email">
                    <h4 style="margin-bottom:16px; color: var(--orange);">üìß Email Reply Settings</h4>
                    <p style="color:var(--text-muted); margin-bottom:20px;">Configure your digital signature and links for email responses.</p>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                        <div>
                            <div class="form-group"><label>Your Name</label><input type="text" id="email_name" placeholder="John Smith"></div>
                            <div class="form-group"><label>Your Title</label><input type="text" id="email_title" placeholder="Regional Director"></div>
                            <div class="form-group"><label>Email Address</label><input type="email" id="email_address" placeholder="john@areascouts.com"></div>
                            <div class="form-group"><label>Primary Phone</label><input type="tel" id="email_phone" placeholder="(555) 123-4567"></div>
                            <div class="form-group"><label>Secondary Phone</label><input type="tel" id="email_phone2" placeholder="(555) 987-6543"></div>
                        </div>
                        <div>
                            <div class="form-group"><label>APEX Landing Page URL</label><input type="text" id="email_apexLink" placeholder="https://..."></div>
                            <div class="form-group"><label>Calendar Booking Link</label><input type="text" id="email_bookingLink" placeholder="https://calendly.com/..."></div>
                            <div class="form-group"><label>Company Website</label><input type="text" id="email_website" placeholder="https://areascouts.com"></div>
                            <div class="form-group"><label>Email Signature Style</label>
                                <select id="email_sigStyle" style="width:100%; padding:10px; background:var(--card-bg); color:var(--text); border:1px solid var(--border); border-radius:8px;">
                                    <option value="professional">Professional</option>
                                    <option value="friendly">Friendly</option>
                                    <option value="minimal">Minimal</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <button class="export-btn" onclick="saveEmailSettings()" style="margin-top:16px;">üíæ Save Email Settings</button>
                    <button class="export-btn" onclick="previewEmailSignature()" style="margin-top:16px; margin-left:10px;">üëÅÔ∏è Preview Signature</button>
                    <div id="emailSignaturePreview" style="margin-top:20px; padding:20px; background:white; color:#333; border-radius:8px; display:none;"></div>
                </div>
                
                <!-- CONTENT EDITOR TAB -->
                <div class="admin-section" id="tab-content">
                    <h4 style="margin-bottom:16px; color: var(--orange);">‚úèÔ∏è Content Editor</h4>
                    <p style="color:var(--text-muted); margin-bottom:20px;">Edit "What is this?" popup content for each button.</p>
                    <div class="form-group">
                        <label>üîç "Check Availability" - What is this?</label>
                        <textarea id="content_availability" rows="4" placeholder="HTML content..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>üöÄ "Evaluator" - What is this?</label>
                        <textarea id="content_evaluator" rows="4" placeholder="HTML content..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>üíº "Operations" - What is this?</label>
                        <textarea id="content_operations" rows="4" placeholder="HTML content..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>üìã "APEX Waitlist" - What is this?</label>
                        <textarea id="content_waitlistApex" rows="4" placeholder="HTML content..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>üì± "Alert Reply Waitlist" - What is this?</label>
                        <textarea id="content_waitlistAlert" rows="4" placeholder="HTML content..."></textarea>
                    </div>
                    <button class="export-btn" onclick="saveContent()">üíæ Save All Content</button>
                </div>
                
                <!-- ANALYTICS TAB -->
                <div class="admin-section" id="tab-analytics">
                    <h4 style="margin-bottom:16px; color: var(--orange);">üìâ Analytics Dashboard</h4>
                    <div style="display:grid; grid-template-columns: repeat(4, 1fr); gap:16px; margin-bottom:20px;">
                        <div class="stat-card"><div class="number" id="analyticsPageViews">0</div><div class="label">Page Views (Today)</div></div>
                        <div class="stat-card"><div class="number" id="analyticsUniqueVisitors">0</div><div class="label">Unique Visitors</div></div>
                        <div class="stat-card"><div class="number" id="analyticsConversionRate">0%</div><div class="label">Conversion Rate</div></div>
                        <div class="stat-card"><div class="number" id="analyticsAvgTime">0m</div><div class="label">Avg. Time on Page</div></div>
                    </div>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                        <div style="background:rgba(0,0,0,0.2); border-radius:12px; padding:20px;">
                            <h5 style="color:var(--orange); margin-bottom:12px;">üî• Top Actions</h5>
                            <div id="topActionsChart"></div>
                        </div>
                        <div style="background:rgba(0,0,0,0.2); border-radius:12px; padding:20px;">
                            <h5 style="color:var(--orange); margin-bottom:12px;">üåç Top Locations</h5>
                            <div id="topLocationsChart"></div>
                        </div>
                    </div>
                    <div style="background:rgba(0,0,0,0.2); border-radius:12px; padding:20px; margin-top:20px;">
                        <h5 style="color:var(--orange); margin-bottom:12px;">üìà Daily Activity (Last 7 Days)</h5>
                        <div id="dailyActivityChart" style="height:200px;"></div>
                    </div>
                </div>
                
                <!-- SETTINGS TAB -->
                <div class="admin-section" id="tab-settings">
                    <h4 style="margin-bottom:16px; color: var(--orange);">‚öôÔ∏è Site Settings</h4>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:30px;">
                        <div>
                            <h5 style="margin-bottom:16px;">Display Settings</h5>
                            <div style="display:flex; align-items:center; gap:16px; margin-bottom:16px; padding:12px; background:rgba(0,0,0,0.2); border-radius:8px;">
                                <span>Show Directors Section:</span>
                                <label class="toggle-switch"><input type="checkbox" id="showDirectorsToggle" checked onchange="toggleDirectors()"><span class="toggle-slider"></span></label>
                            </div>
                            <div style="display:flex; align-items:center; gap:16px; margin-bottom:16px; padding:12px; background:rgba(0,0,0,0.2); border-radius:8px;">
                                <span>Show Chat Agent:</span>
                                <label class="toggle-switch"><input type="checkbox" id="showChatToggle" checked onchange="toggleChat()"><span class="toggle-slider"></span></label>
                            </div>
                            <div style="display:flex; align-items:center; gap:16px; margin-bottom:16px; padding:12px; background:rgba(0,0,0,0.2); border-radius:8px;">
                                <span>Show Stats Banner:</span>
                                <label class="toggle-switch"><input type="checkbox" id="showStatsToggle" checked onchange="toggleStats()"><span class="toggle-slider"></span></label>
                            </div>
                        </div>
                        <div>
                            <h5 style="margin-bottom:16px;">SMS & Notifications</h5>
                            <div style="display:flex; align-items:center; gap:16px; margin-bottom:16px; padding:12px; background:rgba(0,0,0,0.2); border-radius:8px;">
                                <span>üì± SMS Verification:</span>
                                <label class="toggle-switch"><input type="checkbox" id="smsEnabledToggle" checked onchange="toggleSMS()"><span class="toggle-slider"></span></label>
                                <span id="smsStatus" style="font-size:12px; color:var(--green);">ON</span>
                            </div>
                            <div style="padding:12px; background:rgba(0,0,0,0.2); border-radius:8px; margin-bottom:16px;">
                                <p style="font-size:12px; color:var(--text-muted); margin-bottom:8px;">SMS sends a welcome text to users after they enter their phone number.</p>
                                <p style="font-size:12px; color:var(--text-muted);">üìä SMS Sent: <strong id="smsSentCount">0</strong></p>
                            </div>
                            
                            <h5 style="margin-bottom:16px; margin-top:20px;">Security & Data</h5>
                            <div class="form-group">
                                <label>Change Admin Password</label>
                                <input type="password" id="newAdminPassword" placeholder="New password">
                                <button class="export-btn" style="margin-top:8px;" onclick="changePassword()">üîê Update Password</button>
                            </div>
                            <div class="form-group">
                                <label>Stripe Payment Link</label>
                                <input type="text" id="stripeLink" placeholder="https://buy.stripe.com/...">
                                <button class="export-btn" style="margin-top:8px;" onclick="saveStripeLink()">üíæ Save</button>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top:30px; padding:20px; background:rgba(239,68,68,0.1); border:1px solid #ef4444; border-radius:12px;">
                        <h5 style="color:#ef4444; margin-bottom:16px;">‚ö†Ô∏è Danger Zone</h5>
                        <div style="display:flex; gap:10px; flex-wrap:wrap;">
                            <button class="export-btn" onclick="resetDirectors()">üîÑ Reset Directors</button>
                            <button class="export-btn" onclick="exportAllData()">üì¶ Export All Data</button>
                            <button class="export-btn" onclick="importAllData()">üì• Import Data</button>
                            <button class="clear-btn" onclick="clearAllData()">üóëÔ∏è Clear All Data</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        // ============================================
        // CONFIGURATION
        // ============================================
        const CONFIG = {
            adminPassword: 'AS_AREA_2026_GFYLJBLA_Rest#',
            stripeLink: 'https://buy.stripe.com/5kQ28k6uF4e4dRD0KA33W11'
        };
        
        // Default 46 Directors (alphabetically sorted)
        const DEFAULT_DIRECTORS = [
            "Ali Bastianelli", "Alyssa Reina", "Amanda Johansen", "Amobi Okugo",
            "Andrew Cook", "Austin Trout", "Brandon Guyer", "Caity Heap",
            "Danica Evans", "David Fales", "Dr. Anthony Inzillo", "Dr. Marissa Nichols",
            "Dujuan Harris", "Ethan Walker", "Fawzia Kheir", "Frank Castillo",
            "Grant Green", "Gregorio Petit", "Jen Snowbarger", "Jenna Keefe",
            "Joey Lye", "Johnathan Haggerty", "Jordan Serena", "Julian Wright",
            "Karissa Hovinga", "Karlos Williams", "Kelly Kretschman", "Lance Baldwin",
            "Lauren Cleveland", "Lenny Di Nardo", "Mike Hollis", "Mike Medici",
            "Nathan Biddulph", "Orlando Catalan Jr", "Reggie Rusk", "Rich DeLaTorre",
            "Richard Dalatri", "Ryan Lavarnway", "Ryan Serena", "Ryland Huyghue",
            "Shelley Keeling", "Spenser Jaye", "Todd Blyeven", "Tony Glessner"
        ].sort();
        
        // Knowledge Base for Chat - made global
        window.knowledgeBase = {
            apex: {
                keywords: ['apex', 'what is', 'explain', 'about'],
                response: '**APEX** stands for **Athlete Performance Evaluation Index**. The "X" represents the "X factor" ‚Äî proprietary data collected by evaluators. APEX generates assessment scores AND prescriptions designed by professionals who have reached the highest levels of sport.'
            },
            problem: {
                keywords: ['problem', 'injuries', 'crisis', '33 million'],
                response: '**The Youth Sports Injury Epidemic:**\n‚Ä¢ **33 million injuries per year** in youth sports\n‚Ä¢ Only **75 million kids** play youth sports total\n‚Ä¢ **52% of kids** leave sports before reaching JV/varsity level\n‚Ä¢ ACL injuries in girls at historic highs\n‚Ä¢ Tommy John surgeries in kids as young as 10-12'
            },
            evaluator: {
                keywords: ['evaluator', 'become', 'join', 'requirements', 'how to', 'apply'],
                response: '**How to Become an APEX Evaluator:**\n\n**Requirements:**\n‚Ä¢ Background check (24-36 hours)\n‚Ä¢ 2 years minimum coaching experience\n‚Ä¢ Select your sport and postal code\n\n**Compensation:**\n‚Ä¢ **$79 per athlete** assessment\n‚Ä¢ Up to **10 athletes per session**\n‚Ä¢ ~90 minutes per session\n‚Ä¢ **100% of money goes directly to YOU**'
            },
            money: {
                keywords: ['money', 'pay', 'earn', 'income', '$79', 'how much'],
                response: '**Evaluator Compensation:**\n‚Ä¢ **$79 per athlete** for initial assessment\n‚Ä¢ Up to **10 athletes per session** = **$790 per session**\n‚Ä¢ Session takes approximately 90 minutes\n‚Ä¢ **100% of the money goes directly to you**\n‚Ä¢ Additional income from subscriptions and custom programs'
            },
            base: {
                keywords: ['base', 'movement', 'assessment', 'biomechanics'],
                response: '**BASE Movement Assessment:**\n\n**B** - Biomechanics\n**A** - Athleticism\n**S** - Sequence\n**E** - Endurance\n\nNFL professional caliber assessment designed by Dr. Anzillo based on his experience with Dr. James Andrews and professional teams.'
            }
        };
        
        const defaultResponse = 'I can help you learn about APEX! Ask about:\n‚Ä¢ What is APEX?\n‚Ä¢ The injury epidemic\n‚Ä¢ Becoming an evaluator\n‚Ä¢ How much you can earn\n‚Ä¢ The BASE assessment';
        
        // Quiz Questions - 15 total, 10 shown randomly
        const allQuizQuestions = [
            { question: "What does APEX stand for?", options: ["Athlete Performance Evaluation Index", "Athletic Program Excellence Index", "Advanced Physical Exercise Index", "Athlete Potential Excellence Index"], correct: 0, explanation: "APEX stands for Athlete Performance Evaluation Index." },
            { question: "How many youth sports injuries occur per year?", options: ["5 million", "15 million", "33 million", "50 million"], correct: 2, explanation: "33 million youth sports injuries per year." },
            { question: "What does BASE stand for?", options: ["Balance, Agility, Strength, Endurance", "Biomechanics, Athleticism, Sequence, Endurance", "Body, Athletic, Speed, Energy", "Basic Athletic Skill Evaluation"], correct: 1, explanation: "BASE = Biomechanics, Athleticism, Sequence, Endurance." },
            { question: "How much does an evaluator earn per assessment?", options: ["$49", "$79", "$99", "$149"], correct: 1, explanation: "Evaluators earn $79 per athlete assessment." },
            { question: "What percentage of kids quit sports before high school?", options: ["25%", "38%", "52%", "67%"], correct: 2, explanation: "52% of kids leave sports before JV/varsity level." },
            { question: "How many kids participate in youth sports in the US?", options: ["25 million", "50 million", "75 million", "100 million"], correct: 2, explanation: "75 million kids participate in youth sports." },
            { question: "What is the maximum number of athletes per evaluation session?", options: ["5", "8", "10", "15"], correct: 2, explanation: "Evaluators can assess up to 10 athletes per session." },
            { question: "Approximately how long does an evaluation session take?", options: ["30 minutes", "60 minutes", "90 minutes", "120 minutes"], correct: 2, explanation: "Each session takes approximately 90 minutes." },
            { question: "Who developed the BASE assessment protocol?", options: ["College coaches", "Dr. James Andrews' team", "High school trainers", "Youth league officials"], correct: 1, explanation: "The BASE assessment was developed based on Dr. James Andrews' methods." },
            { question: "What is required to become an APEX Evaluator?", options: ["Medical degree", "Background check", "PhD in Sports Science", "Pro athlete experience"], correct: 1, explanation: "A background check is required to become an evaluator." },
            { question: "How many US high schools is APEX launching into?", options: ["5,000+", "15,000+", "30,000+", "50,000+"], correct: 2, explanation: "APEX is launching into 30,000+ US high schools." },
            { question: "What percentage of assessment revenue goes to the evaluator?", options: ["50%", "75%", "90%", "100%"], correct: 3, explanation: "100% of the assessment fee goes directly to the evaluator." },
            { question: "What type of injuries is APEX designed to help prevent?", options: ["Only ACL injuries", "Only concussions", "All youth sports injuries", "Only broken bones"], correct: 2, explanation: "APEX aims to combat all 33 million youth sports injuries." },
            { question: "How long does the background check typically take?", options: ["1-2 hours", "24-36 hours", "1 week", "2 weeks"], correct: 1, explanation: "Background checks typically complete in 24-36 hours." },
            { question: "What minimum coaching experience is recommended for evaluators?", options: ["None", "1 year", "2 years", "5 years"], correct: 2, explanation: "A minimum of 2 years coaching experience is recommended." }
        ];
        
        let quizQuestions = [];
        
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }
        
        function prepareQuizQuestions() {
            quizQuestions = shuffleArray(allQuizQuestions).slice(0, 10);
        }
        
        window.quickPrompts = {
            chat: ["What is APEX?", "How do I become an evaluator?", "How much can I earn?", "What is BASE?"],
            coach: ["Walk me through my first assessment", "How do I approach school ADs?"],
            quiz: ["Start the quiz!", "Test my knowledge"],
            learn: ["Show knowledge base", "Who are the experts?"]
        };
        var quickPrompts = window.quickPrompts;
        
        // ============================================
        // DATA STORAGE & COMPREHENSIVE USER TRACKING
        // ============================================
        let userIP = 'Unknown';
        let userLocation = { city: '', region: '', country: '' };
        let sessionStart = Date.now();
        let currentUserEmail = localStorage.getItem('apex_userEmail') || '';
        let pageViews = {};
        let videoWatchTime = {};
        let currentVideo = null;
        let videoStartTime = null;
        let firebaseReady = false;
        
        // Comprehensive user session data
        let userSession = {
            sessionId: 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
            startTime: new Date().toISOString(),
            email: currentUserEmail,
            ip: 'Unknown',
            location: {},
            device: navigator.userAgent,
            screenSize: window.innerWidth + 'x' + window.innerHeight,
            referrer: document.referrer || 'direct',
            actions: [],
            pageViews: [],
            chatMessages: [],
            quizAttempts: [],
            wheelSpins: [],
            buttonClicks: [],
            scrollDepth: 0,
            timeOnPage: 0,
            lastActivity: new Date().toISOString()
        };
        
        // Track user action - comprehensive logging
        function trackUserAction(actionType, details = {}) {
            const action = {
                type: actionType,
                timestamp: new Date().toISOString(),
                details: details,
                email: currentUserEmail || userSession.email,
                sessionId: userSession.sessionId
            };
            
            userSession.actions.push(action);
            userSession.lastActivity = action.timestamp;
            
            // Save to localStorage
            localStorage.setItem('apex_userSession', JSON.stringify(userSession));
            
            // Save to user profile if email exists
            if (currentUserEmail) {
                updateUserProfile(action);
            }
            
            console.log('üìä Tracked:', actionType, details);
        }
        
        // Update user profile with action
        function updateUserProfile(action) {
            if (!currentUserEmail) return;
            
            let userProfile = data.users.find(u => u.email === currentUserEmail);
            if (!userProfile) {
                userProfile = {
                    email: currentUserEmail,
                    firstSeen: new Date().toISOString(),
                    sessions: [],
                    totalActions: 0,
                    quizScores: [],
                    quizAttempts: 0,
                    chatQuestions: [],
                    wheelSpins: [],
                    buttonsClicked: [],
                    pagesViewed: [],
                    ip: userIP,
                    location: userLocation,
                    device: navigator.userAgent
                };
                data.users.push(userProfile);
            }
            
            // Update profile
            userProfile.lastSeen = new Date().toISOString();
            userProfile.totalActions = (userProfile.totalActions || 0) + 1;
            userProfile.ip = userIP;
            userProfile.location = userLocation;
            
            // Track specific action types
            if (action.type === 'quiz_complete') {
                userProfile.quizScores = userProfile.quizScores || [];
                userProfile.quizScores.push({
                    score: action.details.score,
                    total: action.details.total,
                    percentage: action.details.percentage,
                    timestamp: action.timestamp
                });
                userProfile.quizAttempts = (userProfile.quizAttempts || 0) + 1;
            }
            
            if (action.type === 'chat_message') {
                userProfile.chatQuestions = userProfile.chatQuestions || [];
                userProfile.chatQuestions.push({
                    question: action.details.question,
                    timestamp: action.timestamp
                });
            }
            
            if (action.type === 'wheel_spin') {
                userProfile.wheelSpins = userProfile.wheelSpins || [];
                userProfile.wheelSpins.push({
                    prize: action.details.prize,
                    timestamp: action.timestamp
                });
            }
            
            if (action.type === 'button_click') {
                userProfile.buttonsClicked = userProfile.buttonsClicked || [];
                userProfile.buttonsClicked.push({
                    button: action.details.button,
                    timestamp: action.timestamp
                });
            }
            
            window.saveData('users');
        }
        
        // Initialize data with localStorage as fallback (will be replaced by Firebase)
        // Using window.data to make it globally accessible across script blocks
        window.data = {
            directors: JSON.parse(localStorage.getItem('apex_directors')) || [...DEFAULT_DIRECTORS],
            activity: JSON.parse(localStorage.getItem('apex_activity')) || [],
            unanswered: JSON.parse(localStorage.getItem('apex_unanswered')) || [],
            videos: JSON.parse(localStorage.getItem('apex_videos')) || {},
            emailSettings: JSON.parse(localStorage.getItem('apex_emailSettings')) || {},
            showDirectors: localStorage.getItem('apex_showDirectors') !== 'false',
            users: JSON.parse(localStorage.getItem('apex_users')) || [],
            quizResults: JSON.parse(localStorage.getItem('apex_quizResults')) || [],
            leads: JSON.parse(localStorage.getItem('apex_leads')) || [],
            reservations: JSON.parse(localStorage.getItem('apex_reservations')) || [],
            affiliates: JSON.parse(localStorage.getItem('apex_affiliates')) || [],
            settings: JSON.parse(localStorage.getItem('apex_settings')) || {}
        };
        var data = window.data; // Local reference for backwards compatibility
        
        // Validate directors
        if (!Array.isArray(data.directors) || data.directors.length < 10) {
            data.directors = [...DEFAULT_DIRECTORS];
        }
        
        // ============================================
        // FIREBASE DATA FUNCTIONS
        // ============================================
        let orgRef = null;
        
        // Initialize orgRef when db is ready - uses orgDocId found by initFirebaseData
        function initFirebaseRef() {
            if (window.db && window.orgDocId) {
                orgRef = window.db.collection('organizations').doc(window.orgDocId);
                console.log('üìç orgRef initialized with:', window.orgDocId);
                return true;
            }
            return false;
        }
        
        // Save data to Firebase
        window.saveToFirebase = async function(collection, docData) {
            try {
                if (!orgRef && !initFirebaseRef()) {
                    console.warn('Firebase not available');
                    return false;
                }
                if (collection === 'settings') {
                    await orgRef.set(docData, { merge: true });
                } else {
                    await orgRef.collection(collection).doc('data').set({ items: docData }, { merge: true });
                }
                console.log('‚úÖ Saved to Firebase:', collection);
                return true;
            } catch (error) {
                console.error('‚ùå Firebase save error:', error);
                return false;
            }
        }
        var saveToFirebase = window.saveToFirebase;
        
        // Load data from Firebase
        async function loadFromFirebase(collection) {
            try {
                if (!orgRef && !initFirebaseRef()) {
                    console.warn('Firebase not available');
                    return null;
                }
                if (collection === 'settings') {
                    const doc = await orgRef.get();
                    return doc.exists ? doc.data() : null;
                } else {
                    const doc = await orgRef.collection(collection).doc('data').get();
                    return doc.exists ? doc.data().items : null;
                }
            } catch (error) {
                console.error('‚ùå Firebase load error:', error);
                return null;
            }
        }
        
        // Save data - now saves to both localStorage (backup) and Firebase
        // Making global with window.saveData
        window.saveData = function(key) {
            // Always save to localStorage as backup
            localStorage.setItem('apex_' + key, JSON.stringify(window.data[key]));
            
            // Save to Firebase
            saveToFirebase(key, window.data[key]);
        };
        var saveData = window.saveData; // Local reference
        
        // Load all data from Firebase on startup
        function updateFirebaseStatus(connected) {
            const statusEl = document.getElementById('firebaseStatus');
            if (statusEl) {
                if (connected) {
                    statusEl.innerHTML = 'üî• Connected to Firebase ‚Ä¢ Data synced';
                    statusEl.style.color = '#37c938';
                } else {
                    statusEl.innerHTML = '‚ö†Ô∏è Offline mode ‚Ä¢ Using local storage';
                    statusEl.style.color = '#ed7023';
                }
            }
        }
        
        async function initializeFirebaseData() {
            console.log('üîÑ Loading data from Firebase...');
            
            try {
                if (!orgRef && !initFirebaseRef()) {
                    console.warn('Firebase not available, using localStorage only');
                    updateFirebaseStatus(false);
                    return;
                }
                
                // Check if org exists, if not create it
                const orgDoc = await orgRef.get();
                if (!orgDoc.exists) {
                    console.log('üìù Creating organization in Firebase...');
                    await orgRef.set({
                        name: 'Area Scouts',
                        created: firebase.firestore.FieldValue.serverTimestamp(),
                        active: true
                    });
                }
                
                // Load each data collection
                const collections = ['directors', 'activity', 'unanswered', 'videos', 'emailSettings', 'users', 'quizResults', 'leads', 'reservations', 'affiliates'];
                
                for (const col of collections) {
                    const fbData = await loadFromFirebase(col);
                    if (fbData !== null) {
                        data[col] = fbData;
                        console.log('‚úÖ Loaded from Firebase:', col, Array.isArray(fbData) ? fbData.length + ' items' : 'object');
                    } else if (data[col] && (Array.isArray(data[col]) ? data[col].length > 0 : Object.keys(data[col]).length > 0)) {
                        // Migrate localStorage data to Firebase
                        console.log('üì§ Migrating to Firebase:', col);
                        await saveToFirebase(col, data[col]);
                    }
                }
                
                // Load settings
                const settings = await loadFromFirebase('settings');
                if (settings) {
                    data.showDirectors = settings.showDirectors !== false;
                    data.settings = settings;
                }
                
                firebaseReady = true;
                console.log('üî• Firebase data loaded successfully!');
                
                // Update status indicator
                updateFirebaseStatus(true);
                
                // Refresh UI with Firebase data
                if (typeof renderDirectors === 'function') renderDirectors();
                if (typeof loadAdminData === 'function') loadAdminData();
                
            } catch (error) {
                console.error('‚ùå Firebase initialization error:', error);
                console.log('‚ö†Ô∏è Using localStorage data as fallback');
                
                // Update status indicator
                updateFirebaseStatus(false);
            }
        }
        
        // Initialize Firebase data when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeFirebaseData();
        });
        
        // Get IP and Location
        fetch('https://api.ipify.org?format=json').then(r => r.json()).then(d => { 
            userIP = d.ip;
            // Get location from IP
            fetch('https://ipapi.co/' + d.ip + '/json/').then(r => r.json()).then(loc => {
                userLocation = { city: loc.city || '', region: loc.region || '', country: loc.country_name || '' };
                logActivity('Page Load', navigator.userAgent, { location: userLocation });
            }).catch(() => {
                logActivity('Page Load', navigator.userAgent);
            });
        }).catch(() => {
            logActivity('Page Load', navigator.userAgent);
        });
        
        // Comprehensive activity logging
        function logActivity(action, details = '', extra = {}) {
            const entry = {
                time: new Date().toLocaleString(),
                timestamp: Date.now(),
                ip: userIP,
                email: currentUserEmail,
                action,
                details,
                location: userLocation.city ? `${userLocation.city}, ${userLocation.region}, ${userLocation.country}` : '',
                sessionDuration: Math.round((Date.now() - sessionStart) / 1000),
                ...extra
            };
            data.activity.push(entry);
            if (data.activity.length > 1000) data.activity = data.activity.slice(-1000);
            saveData('activity');
            
            // Update user profile if email known
            if (currentUserEmail) {
                updateUserProfile(action, details, extra);
            }
        }
        
        // User profile tracking
        function updateUserProfile(action, details, extra) {
            let user = data.users.find(u => u.email === currentUserEmail);
            if (!user) {
                user = {
                    email: currentUserEmail,
                    ip: userIP,
                    location: userLocation,
                    firstVisit: new Date().toLocaleString(),
                    lastVisit: new Date().toLocaleString(),
                    totalSessions: 1,
                    totalTimeOnSite: 0,
                    searches: [],
                    quizScores: [],
                    videosWatched: [],
                    buttonsClicked: [],
                    modalsOpened: [],
                    chatMessages: [],
                    formSubmissions: [],
                    interests: []
                };
                data.users.push(user);
            }
            
            user.lastVisit = new Date().toLocaleString();
            user.ip = userIP;
            user.location = userLocation;
            user.totalTimeOnSite += Math.round((Date.now() - sessionStart) / 1000);
            
            // Track specific actions
            if (action === 'Availability Check') {
                user.searches.push({ time: new Date().toLocaleString(), ...extra });
            } else if (action === 'Quiz Completed') {
                user.quizScores.push({ time: new Date().toLocaleString(), score: details });
            } else if (action === 'Video Watch') {
                user.videosWatched.push({ time: new Date().toLocaleString(), video: details, duration: extra.duration || 0 });
            } else if (action === 'Button Click') {
                user.buttonsClicked.push({ time: new Date().toLocaleString(), button: details });
            } else if (action === 'Modal Open') {
                user.modalsOpened.push({ time: new Date().toLocaleString(), modal: details });
            } else if (action === 'Chat Message') {
                user.chatMessages.push({ time: new Date().toLocaleString(), message: details });
            } else if (action.includes('Form')) {
                user.formSubmissions.push({ time: new Date().toLocaleString(), form: action, data: details });
            }
            
            // Determine interests based on actions
            if (details.toLowerCase().includes('evaluator')) user.interests.push('evaluator');
            if (details.toLowerCase().includes('operations')) user.interests.push('operations');
            if (extra.sport) user.interests.push(extra.sport);
            user.interests = [...new Set(user.interests)]; // Remove duplicates
            
            saveData('users');
        }
        
        // Capture user email
        window.captureUserEmail = function(email) {
            if (email && email.includes('@')) {
                currentUserEmail = email;
                userSession.email = email;
                localStorage.setItem('apex_userEmail', email);
                logActivity('Email Captured', email);
                trackUserAction('email_captured', { email: email });
            }
        }
        var captureUserEmail = window.captureUserEmail;
        
        // Pending action after email capture - MUST BE GLOBAL
        window.pendingAction = null;
        window.pendingActionType = null;
        window.pendingMode = null;
        
        // Forward declaration - will be fully defined in prize wheel script
        // This ensures the function exists when called from requireEmailThen and promptForEmail
        window.openPrizeWheel = window.openPrizeWheel || function(mode) {
            console.log('Prize wheel loading, mode:', mode);
            window.pendingMode = mode;
            // Wait for DOM and retry
            setTimeout(() => {
                if (typeof window._openPrizeWheelReal === 'function') {
                    window._openPrizeWheelReal(mode);
                } else {
                    const modal = document.getElementById('prizeWheelModal');
                    if (modal) {
                        modal.classList.add('active');
                        document.getElementById('emailEntrySection').style.display = 'block';
                        document.getElementById('wheelRevealSection').style.display = 'none';
                        document.getElementById('prizeResult').style.display = 'none';
                    }
                }
            }, 100);
        };
        var openPrizeWheel = window.openPrizeWheel;
        
        // requireEmailThen is already defined in the head - just create local reference
        var requireEmailThen = window.requireEmailThen;
        
        // promptForEmail is already defined in head - just create local reference
        var promptForEmail = window.promptForEmail;
        
        // Track button clicks
        document.addEventListener('click', function(e) {
            const btn = e.target.closest('button, .btn-cta, .btn-resource, .btn-waitlist, .mode-btn, a');
            if (btn) {
                const btnText = btn.textContent.trim().substring(0, 50);
                const btnClass = btn.className || '';
                logActivity('Button Click', btnText);
                trackUserAction('button_click', { 
                    button: btnText, 
                    class: btnClass,
                    id: btn.id || ''
                });
            }
        });
        
        // Track scroll depth
        let maxScroll = 0;
        window.addEventListener('scroll', function() {
            const scrollPercent = Math.round((window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100);
            if (scrollPercent > maxScroll) {
                maxScroll = scrollPercent;
                userSession.scrollDepth = maxScroll;
                if (maxScroll === 25 || maxScroll === 50 || maxScroll === 75 || maxScroll === 100) {
                    logActivity('Scroll Depth', maxScroll + '%');
                    trackUserAction('scroll_depth', { depth: maxScroll });
                }
            }
        });
        
        // Track time on page before leaving
        window.addEventListener('beforeunload', function() {
            const timeOnPage = Math.round((Date.now() - sessionStart) / 1000);
            userSession.timeOnPage = timeOnPage;
            logActivity('Page Exit', `Time on page: ${timeOnPage}s`);
            
            // Final save of session data
            localStorage.setItem('apex_userSession', JSON.stringify(userSession));
            
            // Try to save to user profile
            if (currentUserEmail) {
                trackUserAction('page_exit', { timeOnPage: timeOnPage, scrollDepth: maxScroll });
            }
        });
        
        // Video tracking functions
        function startVideoTracking(videoName) {
            currentVideo = videoName;
            videoStartTime = Date.now();
            logActivity('Video Start', videoName);
        }
        
        function stopVideoTracking() {
            if (currentVideo && videoStartTime) {
                const watchTime = Math.round((Date.now() - videoStartTime) / 1000);
                logActivity('Video Watch', currentVideo, { duration: watchTime });
                videoWatchTime[currentVideo] = (videoWatchTime[currentVideo] || 0) + watchTime;
                currentVideo = null;
                videoStartTime = null;
            }
        }
        
        // ============================================
        // MODAL FUNCTIONS
        // ============================================
        // openModal and closeModal are already defined in head - just create local references
        var openModal = window.openModal;
        var closeModal = window.closeModal;
        
        // ============================================
        // AVAILABILITY FLOW
        // ============================================
        let currentAvailability = {};
        
        window.checkAvailability = function() {
            const state = document.getElementById('avail_state').value;
            const zip = document.getElementById('avail_zip').value.trim();
            const sport = document.getElementById('avail_sport').value;
            
            if (!state || !zip || !sport) { alert('Please fill all fields'); return; }
            if (!/^\d{5}$/.test(zip)) { alert('Postal Code must be 5 digits'); return; }
            
            currentAvailability = { state, zip, sport };
            logActivity('Availability Check', `${state} - ${zip} - ${sport}`, { state, zip, sport });
            
            const isAvailable = Math.random() > 0.2;
            
            logActivity('Availability Check', `${state} ${zip} ${sport} - ${isAvailable ? 'Available' : 'Taken'}`);
            
            document.getElementById('availabilityForm').style.display = 'none';
            
            if (isAvailable) {
                document.getElementById('availableText').textContent = `${sport.replace(/_/g,' ')} is AVAILABLE in ${zip}, ${state}!`;
                document.getElementById('resultAvailable').classList.add('active');
            } else {
                document.getElementById('unavailableText').textContent = `${sport.replace(/_/g,' ')} in ${zip}, ${state} is currently taken.`;
                document.getElementById('resultUnavailable').classList.add('active');
            }
        }
        var checkAvailability = window.checkAvailability;
        
        window.resetAvailability = function() {
            document.getElementById('availabilityForm').style.display = 'block';
            document.getElementById('resultAvailable').classList.remove('active');
            document.getElementById('resultUnavailable').classList.remove('active');
            document.getElementById('paymentStep').style.display = 'none';
            document.getElementById('backgroundStep').style.display = 'none';
            document.getElementById('confirmationStep').style.display = 'none';
        }
        var resetAvailability = window.resetAvailability;
        
        window.showPaymentStep = function() {
            document.getElementById('resultAvailable').classList.remove('active');
            document.getElementById('paymentStep').style.display = 'block';
            logActivity('Payment Step', 'Shown');
        }
        var showPaymentStep = window.showPaymentStep;
        
        function openStripeCheckout() {
            window.open(CONFIG.stripeLink, '_blank');
            logActivity('Stripe', 'Opened');
        }
        
        function showBackgroundStep() {
            document.getElementById('paymentStep').style.display = 'none';
            document.getElementById('backgroundStep').style.display = 'block';
            logActivity('Background Check', 'Started');
        }
        
        window.submitBackgroundCheck = function() {
            const fields = ['firstName', 'lastName', 'email', 'phone', 'dob', 'street', 'city', 'state', 'zip', 'years'];
            for (let f of fields) {
                if (!document.getElementById('bg_' + f).value.trim()) {
                    alert('Please fill all required fields');
                    return;
                }
            }
            if (!document.getElementById('bg_consent').checked || !document.getElementById('bg_terms').checked) {
                alert('Please accept the consent and terms');
                return;
            }
            
            const authCode = 'AS-' + Math.random().toString(36).substring(2, 8).toUpperCase();
            document.getElementById('authCodeDisplay').textContent = authCode;
            
            document.getElementById('backgroundStep').style.display = 'none';
            document.getElementById('confirmationStep').style.display = 'block';
            
            logActivity('Application Complete', authCode);
        }
        var submitBackgroundCheck = window.submitBackgroundCheck;
        
        // ============================================
        // CHAT FUNCTIONS
        // ============================================
        let currentMode = 'chat';
        let lastQuestion = '';
        
        window.addMessage = function(content, isUser = false, showFeedback = false) {
            const area = document.getElementById('messagesArea');
            if (!area) {
                console.error('messagesArea not found!');
                return;
            }
            console.log('addMessage called - isUser:', isUser, 'showFeedback:', showFeedback);
            const div = document.createElement('div');
            div.className = `message ${isUser ? 'message-user' : 'message-assistant'}`;
            div.innerHTML = content.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
            
            if (showFeedback && !isUser) {
                console.log('Adding feedback buttons');
                div.innerHTML += `
                    <div class="feedback-container">
                        <div class="feedback-question">Is this the answer you were looking for?</div>
                        <button class="feedback-btn yes" onclick="handleFeedback(true)">‚úÖ YES</button>
                        <button class="feedback-btn no" onclick="handleFeedback(false)">‚ùå NO</button>
                    </div>
                `;
            }
            
            area.appendChild(div);
            area.scrollTop = area.scrollHeight;
        }
        
        window.handleFeedback = function(helpful) {
            document.querySelectorAll('.feedback-container').forEach(el => el.remove());
            if (helpful) {
                addMessage('Great! Let me know if you have other questions.');
            } else {
                data.unanswered.push({ question: lastQuestion, time: new Date().toLocaleString(), email: '' });
                saveData('unanswered');
                // Show email input
                const area = document.getElementById('messagesArea');
                const emailDiv = document.createElement('div');
                emailDiv.className = 'message message-assistant';
                emailDiv.innerHTML = `
                    <p>I've noted your question for our team. Would you like to provide your email for a personal response?</p>
                    <div style="margin-top: 12px; display: flex; gap: 8px; flex-wrap: wrap;">
                        <input type="email" id="feedbackEmail" placeholder="your@email.com" style="flex: 1; min-width: 200px; padding: 10px; border-radius: 8px; border: 1px solid var(--border); background: rgba(255,255,255,0.05); color: var(--text);">
                        <button onclick="window.submitFeedbackEmail()" style="padding: 10px 20px; background: var(--orange); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">Submit</button>
                        <button onclick="this.parentElement.parentElement.remove(); addMessage('No problem! Feel free to ask more questions.');" style="padding: 10px 20px; background: var(--card-bg); color: var(--text); border: 1px solid var(--border); border-radius: 8px; cursor: pointer;">Skip</button>
                    </div>
                `;
                area.appendChild(emailDiv);
                area.scrollTop = area.scrollHeight;
            }
        }
        var handleFeedback = window.handleFeedback;
        
        window.submitFeedbackEmail = function() {
            const email = document.getElementById('feedbackEmail').value.trim();
            if (email && email.includes('@')) {
                // Update the last unanswered question with email
                if (data.unanswered.length > 0) {
                    data.unanswered[data.unanswered.length - 1].email = email;
                    saveData('unanswered');
                }
                document.querySelector('.message-assistant:last-child').remove();
                addMessage('Thank you! We\'ll follow up at ' + email + ' soon.');
                logActivity('Email Captured', email);
            } else {
                alert('Please enter a valid email address');
            }
        }
        var submitFeedbackEmail = window.submitFeedbackEmail;
        
        window.findBestResponse = function(query) {
            const lowerQuery = query.toLowerCase();
            for (const [key, item] of Object.entries(window.knowledgeBase)) {
                for (const keyword of item.keywords) {
                    if (lowerQuery.includes(keyword)) return item.response;
                }
            }
            return defaultResponse;
        }
        
        window.handleSend = function() {
            const input = document.getElementById('inputField');
            const query = input.value.trim();
            if (!query) return;
            
            lastQuestion = query;
            window.addMessage(query, true);
            input.value = '';
            logActivity('Chat Question', query);
            trackUserAction('chat_message', { question: query, mode: currentMode });
            
            setTimeout(() => {
                try {
                    const response = window.findBestResponse(query);
                    window.addMessage(response, false, true);
                } catch (e) {
                    console.error('Error getting response:', e);
                    window.addMessage('Sorry, there was an error processing your question. Please try again.', false, false);
                }
            }, 500);
        }
        
        function updateQuickPrompts() {
            const container = document.getElementById('quickPrompts');
            if (!container) return;
            container.innerHTML = '';
            (quickPrompts[currentMode] || quickPrompts.chat).forEach(prompt => {
                const btn = document.createElement('button');
                btn.className = 'quick-btn';
                btn.textContent = prompt;
                btn.onclick = () => {
                    if (prompt.includes('quiz')) startQuiz();
                    else { 
                        const input = document.getElementById('inputField');
                        const area = document.getElementById('messagesArea');
                        if (!area) return;
                        
                        const userDiv = document.createElement('div');
                        userDiv.className = 'message message-user';
                        userDiv.textContent = prompt;
                        area.appendChild(userDiv);
                        
                        if (input) input.value = '';
                        
                        setTimeout(() => {
                            let response = null;
                            const queryLower = prompt.toLowerCase().replace(/[?!.,]/g, '');
                            
                            // Check window.aiKnowledge first (admin corrections)
                            if (window.aiKnowledge && window.aiKnowledge.length > 0) {
                                console.log('Checking aiKnowledge:', window.aiKnowledge.length, 'items');
                                for (const k of window.aiKnowledge) {
                                    if (k.topic && k.content) {
                                        const topicLower = k.topic.toLowerCase().replace(/[?!.,]/g, '');
                                        const topicWords = topicLower.split(' ').filter(w => w.length >= 2);
                                        const matches = topicWords.filter(w => queryLower.includes(w));
                                        console.log('Checking topic:', k.topic, 'matches:', matches.length, '/', topicWords.length);
                                        if (matches.length >= Math.ceil(topicWords.length * 0.5)) {
                                            response = k.content;
                                            console.log('MATCHED aiKnowledge!');
                                            break;
                                        }
                                    }
                                }
                            }
                            
                            // Check corrections in knowledgeBase
                            if (!response) {
                                for (const [key, item] of Object.entries(window.knowledgeBase || {})) {
                                    if (key.startsWith('correction_') && item.keywords) {
                                        const matches = item.keywords.filter(kw => queryLower.includes(kw));
                                        if (matches.length >= 2) {
                                            response = item.response;
                                            break;
                                        }
                                    }
                                }
                            }
                            
                            // Check default knowledgeBase
                            if (!response) {
                                for (const [key, item] of Object.entries(window.knowledgeBase || {})) {
                                    if (!key.startsWith('correction_')) {
                                        for (const keyword of (item.keywords || [])) {
                                            if (queryLower.includes(keyword)) {
                                                response = item.response;
                                                break;
                                            }
                                        }
                                    }
                                    if (response) break;
                                }
                            }
                            
                            if (!response) {
                                response = 'I can help you learn about APEX! Ask about:\\n‚Ä¢ What is APEX?\\n‚Ä¢ The injury epidemic\\n‚Ä¢ Becoming an evaluator\\n‚Ä¢ How much you can earn\\n‚Ä¢ The BASE assessment';
                            }
                            
                            const respDiv = document.createElement('div');
                            respDiv.className = 'message message-assistant';
                            respDiv.innerHTML = response.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\\n/g, '<br>').replace(/\n/g, '<br>');
                            
                            respDiv.innerHTML += `
                                <div class="feedback-container">
                                    <div class="feedback-question">Is this the answer you were looking for?</div>
                                    <button class="feedback-btn yes" onclick="handleFeedback(true)">‚úÖ YES</button>
                                    <button class="feedback-btn no" onclick="handleFeedback(false)">‚ùå NO</button>
                                </div>
                            `;
                            
                            area.appendChild(respDiv);
                            area.scrollTop = area.scrollHeight;
                        }, 300);
                    }
                };
                container.appendChild(btn);
            });
        }
        
        // Initialize quick prompts on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateQuickPrompts();
        });
        
        window.setMode = function(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.toggle('active', b.dataset.mode === mode));
            document.getElementById('messagesArea').innerHTML = '';
            
            // Capture email if not already captured - check both local and window versions
            var hasEmail = currentUserEmail || window.currentUserEmail || localStorage.getItem('apex_userEmail');
            if (!hasEmail) {
                promptForEmail(mode);
                return;
            }
            
            // Sync email to local variable if only in window/localStorage
            if (!currentUserEmail && hasEmail) {
                currentUserEmail = hasEmail;
            }
            
            logActivity('Mode Change', mode);
            trackUserAction('mode_change', { mode: mode });
            
            if (mode === 'quiz') {
                document.getElementById('chatContainer').style.display = 'none';
                document.getElementById('quizContainer').classList.add('active');
                startQuiz();
            } else {
                document.getElementById('chatContainer').style.display = 'block';
                document.getElementById('quizContainer').classList.remove('active');
                window.addMessage(`Welcome to **${mode.charAt(0).toUpperCase() + mode.slice(1)} Mode**! How can I help?`);
            }
            updateQuickPrompts();
        }
        var setMode = window.setMode;
        
        // ============================================
        // QUIZ FUNCTIONS
        // ============================================
        let quizState = { current: 0, score: 0, answered: false };
        let quizResults = JSON.parse(localStorage.getItem('apex_quizResults')) || [];
        
        function startQuiz() {
            prepareQuizQuestions();
            quizState = { current: 0, score: 0, answered: false };
            quizAnswers = [];
            quizStartTime = Date.now();
            logActivity('Quiz Started', `${quizQuestions.length} questions`);
            showQuestion();
        }
        
        // Track each quiz answer
        let quizAnswers = [];
        
        function saveQuizResult() {
            const result = {
                date: new Date().toLocaleString(),
                ip: userIP,
                email: currentUserEmail,
                location: userLocation.city ? `${userLocation.city}, ${userLocation.region}` : '',
                score: quizState.score,
                total: quizQuestions.length,
                percentage: Math.round((quizState.score / quizQuestions.length) * 100),
                answers: quizAnswers,
                timeToComplete: Math.round((Date.now() - quizStartTime) / 1000)
            };
            data.quizResults.push(result);
            saveData('quizResults');
            logActivity('Quiz Completed', `Score: ${result.score}/${result.total} (${result.percentage}%)`, { 
                score: result.score, 
                total: result.total,
                percentage: result.percentage,
                answers: quizAnswers
            });
            
            // Track quiz completion
            trackUserAction('quiz_complete', {
                score: result.score,
                total: result.total,
                percentage: result.percentage,
                timeToComplete: result.timeToComplete,
                attemptNumber: (data.quizResults.filter(r => r.email === currentUserEmail).length)
            });
            
            quizAnswers = [];
        }
        
        let quizStartTime = Date.now();
        
        function showQuestion() {
            const q = quizQuestions[quizState.current];
            document.getElementById('questionNum').textContent = quizState.current + 1;
            document.getElementById('totalQuestions').textContent = quizQuestions.length;
            document.getElementById('score').textContent = quizState.score;
            document.getElementById('quizQuestion').textContent = q.question;
            document.getElementById('quizFeedback').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'none';
            
            const optionsEl = document.getElementById('quizOptions');
            optionsEl.innerHTML = '';
            q.options.forEach((opt, i) => {
                const div = document.createElement('div');
                div.className = 'quiz-option';
                div.textContent = opt;
                div.onclick = () => selectAnswer(i);
                optionsEl.appendChild(div);
            });
            quizState.answered = false;
        }
        
        function selectAnswer(index) {
            if (quizState.answered) return;
            quizState.answered = true;
            
            const q = quizQuestions[quizState.current];
            const isCorrect = index === q.correct;
            
            // Track this answer
            quizAnswers.push({
                question: q.question,
                userAnswer: q.options[index],
                correctAnswer: q.options[q.correct],
                isCorrect: isCorrect
            });
            logActivity('Quiz Answer', q.question, { answer: q.options[index], correct: isCorrect });
            
            const options = document.querySelectorAll('.quiz-option');
            options.forEach((opt, i) => {
                if (i === q.correct) opt.classList.add('correct');
                else if (i === index) opt.classList.add('incorrect');
            });
            
            const feedback = document.getElementById('quizFeedback');
            if (isCorrect) {
                quizState.score++;
                document.getElementById('score').textContent = quizState.score;
                feedback.className = 'quiz-feedback correct';
                feedback.innerHTML = `<strong>‚úì Correct!</strong> ${q.explanation}`;
            } else {
                feedback.className = 'quiz-feedback incorrect';
                feedback.innerHTML = `<strong>‚úó Not quite.</strong> ${q.explanation}`;
            }
            feedback.style.display = 'block';
            document.getElementById('nextBtn').style.display = 'inline-block';
        }
        
        document.getElementById('nextBtn').onclick = () => {
            if (quizState.current < quizQuestions.length - 1) {
                quizState.current++;
                showQuestion();
            } else {
                saveQuizResult();
                const pct = Math.round((quizState.score / quizQuestions.length) * 100);
                document.getElementById('quizQuestion').innerHTML = `<strong>Quiz Complete!</strong><br><br>Score: ${quizState.score}/${quizQuestions.length} (${pct}%)`;
                document.getElementById('quizOptions').innerHTML = '';
                document.getElementById('quizFeedback').style.display = 'none';
                document.getElementById('nextBtn').textContent = 'Restart Quiz';
                document.getElementById('nextBtn').onclick = startQuiz;
            }
        };
        
        // ============================================
        // DIRECTORS
        // ============================================
        window.loadDirectors = function() {
            const grid = document.getElementById('directorsGrid');
            if (!grid) return;
            grid.innerHTML = '';
            const sortedDirectors = [...window.data.directors].sort((a, b) => {
                const nameA = typeof a === 'object' ? a.name : a;
                const nameB = typeof b === 'object' ? b.name : b;
                return nameA.localeCompare(nameB);
            });
            sortedDirectors.forEach(d => {
                const name = typeof d === 'object' ? d.name : d;
                const title = typeof d === 'object' ? d.title : 'Director';
                const photo = typeof d === 'object' && d.photo ? d.photo : `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=16345f&color=fff&size=70`;
                const card = document.createElement('div');
                card.className = 'director-card';
                card.innerHTML = `
                    <img src="${photo}" class="director-photo" alt="${name}" onerror="this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=16345f&color=fff&size=70'">
                    <div class="director-name">${name}</div>
                    <div class="director-title">${title}</div>
                `;
                grid.appendChild(card);
            });
        };
        var loadDirectors = window.loadDirectors;
        
        function toggleDirectors() {
            data.showDirectors = document.getElementById('showDirectorsToggle').checked;
            localStorage.setItem('apex_showDirectors', data.showDirectors);
            document.getElementById('directorsSection').style.display = data.showDirectors ? 'block' : 'none';
        }
        
        function addDirector() {
            const name = document.getElementById('newDirectorName').value.trim();
            const title = document.getElementById('newDirectorTitle').value.trim() || 'Director';
            if (name) {
                const exists = data.directors.some(d => {
                    const existingName = typeof d === 'object' ? d.name : d;
                    return existingName.toLowerCase() === name.toLowerCase();
                });
                if (!exists) {
                    data.directors.push({ name, title, photo: '' });
                    data.directors.sort((a, b) => {
                        const nameA = typeof a === 'object' ? a.name : a;
                        const nameB = typeof b === 'object' ? b.name : b;
                        return nameA.localeCompare(nameB);
                    });
                    saveData('directors');
                    loadDirectors();
                    loadAdminDirectors();
                    document.getElementById('newDirectorName').value = '';
                    document.getElementById('newDirectorTitle').value = '';
                }
            }
        }
        
        function removeDirector(name) {
            data.directors = data.directors.filter(d => d !== name);
            saveData('directors');
            loadDirectors();
            loadAdminDirectors();
        }
        
        function resetDirectors() {
            if (confirm('Reset directors to default list?')) {
                data.directors = [...DEFAULT_DIRECTORS];
                saveData('directors');
                loadDirectors();
                loadAdminDirectors();
            }
        }
        
        window.loadAdminDirectors = function() {
            const list = document.getElementById('adminDirectorsList');
            if (!list) return;
            list.innerHTML = window.data.directors.map((d, i) => {
                const name = typeof d === 'object' ? d.name : d;
                const title = typeof d === 'object' ? d.title : 'Director';
                const photo = typeof d === 'object' && d.photo ? d.photo : `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=16345f&color=fff&size=50`;
                const hasPhoto = typeof d === 'object' && d.photo && d.photo.startsWith('data:');
                return `<div style="display:flex;justify-content:space-between;align-items:center;padding:12px;border-bottom:1px solid var(--border);gap:12px;">
                    <div style="display:flex;align-items:center;gap:12px;flex:1;">
                        <img src="${photo}" style="width:50px;height:50px;border-radius:50%;object-fit:cover;border:2px solid ${hasPhoto ? 'var(--green)' : 'var(--border)'};" onerror="this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=16345f&color=fff&size=50'">
                        <div>
                            <strong>${name}</strong><br>
                            <span style="color:var(--text-muted);font-size:12px;">${title}</span>
                        </div>
                    </div>
                    <div style="display:flex;gap:8px;">
                        <button class="export-btn" onclick="openEditDirectorModal(${i})" style="padding:8px 16px;">‚úèÔ∏è Edit</button>
                        <button class="clear-btn" onclick="deleteDirectorByIndex(${i})" style="padding:8px 12px;">üóëÔ∏è</button>
                    </div>
                </div>`;
            }).join('');
            document.getElementById('directorCount').textContent = window.data.directors.length;
        };
        var loadAdminDirectors = window.loadAdminDirectors;
        
        function openEditDirectorModal(index) {
            const d = data.directors[index];
            if (!d) return;
            
            const name = typeof d === 'object' ? d.name : d;
            const title = typeof d === 'object' ? d.title : 'Director';
            const photo = typeof d === 'object' && d.photo ? d.photo : 'https://ui-avatars.com/api/?name=' + encodeURIComponent(name) + '&background=16345f&color=fff&size=150';
            
            document.getElementById('editDirectorIndex').value = index;
            document.getElementById('editDirectorName').value = name;
            document.getElementById('editDirectorTitle').value = title;
            document.getElementById('editDirectorPhoto').src = photo;
            window.editDirectorPhotoData = typeof d === 'object' ? d.photo : '';
            
            document.getElementById('editDirectorModal').style.display = 'flex';
        }
        
        function deleteDirectorByIndex(index) {
            const d = data.directors[index];
            const name = typeof d === 'object' ? d.name : d;
            if (confirm('Delete director: ' + name + '?')) {
                data.directors.splice(index, 1);
                saveData();
                loadAdminDirectors();
                renderDirectors();
            }
        }
        
        // Generate ALL AI photos for directors without photos
        async function generateAllAIPhotos() {
            const directorsNeedingPhotos = data.directors.filter(d => {
                const photo = typeof d === 'object' ? d.photo : '';
                return !photo || !photo.startsWith('data:');
            });
            
            if (directorsNeedingPhotos.length === 0) {
                alert('All directors already have AI photos!');
                return;
            }
            
            const cost = (directorsNeedingPhotos.length * 0.04).toFixed(2);
            if (!confirm(`Generate AI photos for ${directorsNeedingPhotos.length} directors?\n\nEstimated cost: $${cost}\n\nThis may take several minutes.`)) {
                return;
            }
            
            const btn = event.target;
            const originalText = btn.textContent;
            btn.disabled = true;
            
            let generated = 0;
            let failed = 0;
            
            for (let i = 0; i < data.directors.length; i++) {
                const d = data.directors[i];
                const name = typeof d === 'object' ? d.name : d;
                const title = typeof d === 'object' ? d.title : 'Director';
                const photo = typeof d === 'object' ? d.photo : '';
                
                // Skip if already has AI photo
                if (photo && photo.startsWith('data:')) continue;
                
                btn.textContent = `‚è≥ ${generated + 1}/${directorsNeedingPhotos.length} - ${name}...`;
                
                try {
                    const prompt = `Professional headshot portrait photo of a ${getGenderGuess(name)} sports professional named ${name}, ${title}, athletic background, confident smile, business casual attire, neutral studio background, high quality professional photography, realistic, photorealistic`;
                    
                    const result = await callOpenAI('image', {
                        model: 'dall-e-3',
                        prompt: prompt,
                        n: 1,
                        size: '1024x1024',
                        quality: 'standard',
                        response_format: 'b64_json'
                    });
                    
                    if (result.error) {
                        console.error(`Error for ${name}:`, result.error);
                        failed++;
                        continue;
                    }
                    
                    const base64Image = result.data[0].b64_json;
                    const imageDataUrl = `data:image/png;base64,${base64Image}`;
                    const resizedImage = await resizeBase64Image(imageDataUrl, 150, 150);
                    
                    if (typeof data.directors[i] === 'object') {
                        data.directors[i].photo = resizedImage;
                    } else {
                        data.directors[i] = { name, title, photo: resizedImage };
                    }
                    
                    generated++;
                    
                    // Save after each to prevent data loss
                    saveData('directors');
                    loadDirectors();
                    loadAdminDirectors();
                    
                    // Small delay to avoid rate limiting
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                } catch (error) {
                    console.error(`Error generating photo for ${name}:`, error);
                    failed++;
                }
            }
            
            btn.disabled = false;
            btn.textContent = originalText;
            
            alert(`‚úÖ Generated ${generated} AI photos!\n${failed > 0 ? `‚ùå ${failed} failed` : ''}`);
        }
        
        // Clear all AI photos
        function clearAllPhotos() {
            if (!confirm('Clear ALL AI photos? Directors will revert to initials avatars.')) {
                return;
            }
            
            data.directors = data.directors.map(d => {
                if (typeof d === 'object') {
                    return { ...d, photo: '' };
                }
                return d;
            });
            
            saveData('directors');
            loadDirectors();
            loadAdminDirectors();
            alert('All photos cleared!');
        }
        
        // Generate AI photo for director
        async function generateAIPhoto(name) {
            const index = data.directors.findIndex(d => (typeof d === 'object' ? d.name : d) === name);
            if (index === -1) return;
            
            const d = data.directors[index];
            const directorName = typeof d === 'object' ? d.name : d;
            const currentTitle = typeof d === 'object' ? d.title : 'Director';
            
            if (!confirm(`Generate AI portrait for "${directorName}"?\n\nCost: ~$0.04 per image`)) {
                return;
            }
            
            // Show loading state
            const btn = event.target;
            const originalText = btn.textContent;
            btn.disabled = true;
            btn.textContent = '‚è≥ Generating...';
            
            try {
                const prompt = `Professional headshot portrait photo of a ${getGenderGuess(directorName)} sports professional named ${directorName}, ${currentTitle}, athletic background, confident smile, business casual attire, neutral studio background, high quality professional photography, realistic, photorealistic`;
                
                const result = await callOpenAI('image', {
                    model: 'dall-e-3',
                    prompt: prompt,
                    n: 1,
                    size: '1024x1024',
                    quality: 'standard',
                    response_format: 'b64_json'
                });
                
                if (result.error) {
                    throw new Error(result.error.message);
                }
                
                const base64Image = result.data[0].b64_json;
                const imageDataUrl = `data:image/png;base64,${base64Image}`;
                
                // Resize to 150x150 for storage efficiency
                const resizedImage = await resizeBase64Image(imageDataUrl, 150, 150);
                
                // Save to director
                if (typeof data.directors[index] === 'object') {
                    data.directors[index].photo = resizedImage;
                } else {
                    data.directors[index] = { name: directorName, title: currentTitle, photo: resizedImage };
                }
                
                saveData('directors');
                loadDirectors();
                loadAdminDirectors();
                
                alert(`‚úÖ AI photo generated for ${directorName}!`);
                
            } catch (error) {
                console.error('AI Photo error:', error);
                alert('Error generating photo: ' + error.message);
            }
            
            btn.disabled = false;
            btn.textContent = originalText;
        }
        
        // Generate AI title/bio for a director
        async function generateAITitle(name) {
            const index = data.directors.findIndex(d => (typeof d === 'object' ? d.name : d) === name);
            if (index === -1) return;
            
            const d = data.directors[index];
            const directorName = typeof d === 'object' ? d.name : d;
            
            const btn = event.target;
            const originalText = btn.textContent;
            btn.disabled = true;
            btn.textContent = '‚è≥...';
            
            try {
                const result = await callOpenAI('chat', {
                    model: 'gpt-4o-mini',
                    messages: [
                        {
                            role: 'system',
                            content: `You are researching sports professionals for APEX (Athletic Performance Enhancement eXperience). 
                            
Given a name, search your knowledge for this person. If they are a known athlete, coach, or sports professional, return their real title/role.

If unknown, generate a realistic sports-related title.

Return ONLY the title (10 words max), no explanation. Examples:
- "Former MLB Pitcher, 12-Year Veteran"
- "Olympic Gold Medalist, Track & Field"
- "NFL Strength & Conditioning Coach"
- "Youth Baseball Development Specialist"
- "Sports Medicine Director"
- "Former NCAA Division I Coach"`
                        },
                        {
                            role: 'user',
                            content: `Generate a professional sports title for: ${directorName}`
                        }
                    ],
                    temperature: 0.7,
                    max_tokens: 50
                });
                
                if (result.error) {
                    throw new Error(result.error.message);
                }
                
                const generatedTitle = result.choices[0].message.content.trim().replace(/^["']|["']$/g, '');
                
                // Update director
                if (typeof data.directors[index] === 'object') {
                    data.directors[index].title = generatedTitle;
                } else {
                    data.directors[index] = { name: directorName, title: generatedTitle, photo: '' };
                }
                
                saveData('directors');
                loadDirectors();
                loadAdminDirectors();
                
            } catch (error) {
                console.error('AI Title error:', error);
                alert('Error generating title: ' + error.message);
            }
            
            btn.disabled = false;
            btn.textContent = originalText;
        }
        
        // Generate ALL titles for directors
        async function generateAllTitles() {
            const directorsNeedingTitles = data.directors.filter(d => {
                const title = typeof d === 'object' ? d.title : 'Director';
                return title === 'Director' || !title;
            });
            
            if (directorsNeedingTitles.length === 0) {
                if (!confirm('All directors have titles. Regenerate ALL titles anyway?')) {
                    return;
                }
            }
            
            const count = directorsNeedingTitles.length || data.directors.length;
            const cost = (count * 0.001).toFixed(3);
            
            if (!confirm(`Generate AI titles for ${count} directors?\n\nEstimated cost: ~$${cost}\n\nThis may take a minute.`)) {
                return;
            }
            
            const btn = event.target;
            const originalText = btn.textContent;
            btn.disabled = true;
            
            let generated = 0;
            
            for (let i = 0; i < data.directors.length; i++) {
                const d = data.directors[i];
                const name = typeof d === 'object' ? d.name : d;
                const title = typeof d === 'object' ? d.title : 'Director';
                
                // Skip if already has custom title (unless regenerating all)
                if (directorsNeedingTitles.length > 0 && title !== 'Director' && title) continue;
                
                btn.textContent = `‚è≥ ${generated + 1}/${count} - ${name}...`;
                
                try {
                    const result = await callOpenAI('chat', {
                        model: 'gpt-4o-mini',
                        messages: [
                            {
                                role: 'system',
                                content: `You research sports professionals. Given a name, if they're a known athlete/coach, return their real title. If unknown, generate a realistic sports title. Return ONLY the title (10 words max). Examples: "Former MLB Pitcher", "Olympic Gold Medalist", "Youth Baseball Coach"`
                            },
                            { role: 'user', content: `Title for: ${name}` }
                        ],
                        temperature: 0.7,
                        max_tokens: 50
                    });
                    
                    const generatedTitle = result.choices[0].message.content.trim().replace(/^["']|["']$/g, '');
                    
                    if (typeof data.directors[i] === 'object') {
                        data.directors[i].title = generatedTitle;
                    } else {
                        data.directors[i] = { name, title: generatedTitle, photo: '' };
                    }
                    
                    generated++;
                    saveData('directors');
                    
                    // Small delay to avoid rate limiting
                    await new Promise(resolve => setTimeout(resolve, 200));
                    
                } catch (error) {
                    console.error(`Error for ${name}:`, error);
                }
            }
            
            loadDirectors();
            loadAdminDirectors();
            
            btn.disabled = false;
            btn.textContent = originalText;
            
            alert(`‚úÖ Generated ${generated} titles!`);
        }
        
        // Generate both titles AND photos for all directors
        async function generateAllTitlesAndPhotos() {
            const count = data.directors.length;
            const cost = (count * 0.041).toFixed(2);
            
            if (!confirm(`Generate AI titles AND photos for all ${count} directors?\n\nEstimated cost: ~$${cost}\n\nThis will take several minutes.`)) {
                return;
            }
            
            const btn = event.target;
            const originalText = btn.textContent;
            btn.disabled = true;
            
            let generated = 0;
            
            for (let i = 0; i < data.directors.length; i++) {
                const d = data.directors[i];
                const name = typeof d === 'object' ? d.name : d;
                let title = typeof d === 'object' ? d.title : 'Director';
                let photo = typeof d === 'object' ? d.photo : '';
                
                btn.textContent = `‚è≥ ${i + 1}/${count} - ${name}...`;
                
                try {
                    // Generate title first
                    if (!title || title === 'Director') {
                        const titleResult = await callOpenAI('chat', {
                            model: 'gpt-4o-mini',
                            messages: [
                                { role: 'system', content: `You research sports professionals. Given a name, if they're a known athlete/coach, return their real title. If unknown, generate a realistic sports title. Return ONLY the title (10 words max).` },
                                { role: 'user', content: `Title for: ${name}` }
                            ],
                            temperature: 0.7,
                            max_tokens: 50
                        });
                        
                        title = titleResult.choices[0].message.content.trim().replace(/^["']|["']$/g, '');
                    }
                    
                    // Generate photo if missing
                    if (!photo || !photo.startsWith('data:')) {
                        const prompt = `Professional headshot portrait photo of a ${getGenderGuess(name)} sports professional named ${name}, ${title}, athletic background, confident smile, business casual attire, neutral studio background, high quality professional photography, realistic, photorealistic`;
                        
                        const photoResult = await callOpenAI('image', {
                            model: 'dall-e-3',
                            prompt: prompt,
                            n: 1,
                            size: '1024x1024',
                            quality: 'standard',
                            response_format: 'b64_json'
                        });
                        
                        if (!photoResult.error) {
                            const base64Image = photoResult.data[0].b64_json;
                            const imageDataUrl = `data:image/png;base64,${base64Image}`;
                            photo = await resizeBase64Image(imageDataUrl, 150, 150);
                        }
                    }
                    
                    // Update director
                    data.directors[i] = { name, title, photo };
                    generated++;
                    
                    saveData('directors');
                    loadDirectors();
                    loadAdminDirectors();
                    
                    // Delay to avoid rate limiting
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                } catch (error) {
                    console.error(`Error for ${name}:`, error);
                }
            }
            
            btn.disabled = false;
            btn.textContent = originalText;
            
            alert(`‚úÖ Generated titles and photos for ${generated} directors!`);
        }
        
        function getGenderGuess(name) {
            const femaleNames = ['ali', 'alyssa', 'amanda', 'caity', 'danica', 'fawzia', 'jen', 'jenna', 'joey', 'jordan', 'marissa', 'nicole', 'sarah', 'katie', 'ashley', 'emily', 'jessica', 'stephanie', 'melissa', 'christina', 'lisa', 'mary', 'patricia', 'linda', 'elizabeth', 'barbara', 'susan', 'margaret', 'dorothy', 'nancy', 'betty', 'helen', 'sandra', 'donna', 'carol', 'ruth', 'sharon', 'michelle', 'laura', 'kimberly', 'deborah', 'anna', 'grace', 'madison'];
            const firstName = name.split(' ')[0].toLowerCase();
            return femaleNames.includes(firstName) ? 'female' : 'male';
        }
        
        function resizeBase64Image(base64, width, height) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    canvas.width = width;
                    canvas.height = height;
                    const ctx = canvas.getContext('2d');
                    
                    // Center crop
                    let sx, sy, sSize;
                    if (img.width > img.height) {
                        sSize = img.height;
                        sx = (img.width - sSize) / 2;
                        sy = 0;
                    } else {
                        sSize = img.width;
                        sx = 0;
                        sy = (img.height - sSize) / 2;
                    }
                    
                    ctx.drawImage(img, sx, sy, sSize, sSize, 0, 0, width, height);
                    resolve(canvas.toDataURL('image/jpeg', 0.85));
                };
                img.src = base64;
            });
        }
        
        function doEditDirector(name) {
            const index = data.directors.findIndex(d => (typeof d === 'object' ? d.name : d) === name);
            if (index === -1) return;
            
            const d = data.directors[index];
            const currentName = typeof d === 'object' ? d.name : d;
            const currentTitle = typeof d === 'object' ? d.title : 'Director';
            const currentPhoto = typeof d === 'object' && d.photo ? d.photo : 'https://ui-avatars.com/api/?name=' + encodeURIComponent(currentName) + '&background=16345f&color=fff&size=150';
            
            document.getElementById('editDirectorIndex').value = index;
            document.getElementById('editDirectorName').value = currentName;
            document.getElementById('editDirectorTitle').value = currentTitle;
            document.getElementById('editDirectorPhoto').src = currentPhoto;
            
            window.editDirectorPhotoData = typeof d === 'object' ? d.photo : '';
            
            // Force show modal
            const modal = document.getElementById('editDirectorModal');
            modal.style.display = 'flex';
            modal.classList.add('active');
        }
        
        function handleDirectorPhotoUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.onload = function() {
                    // Resize to 150x150
                    const canvas = document.createElement('canvas');
                    canvas.width = 150;
                    canvas.height = 150;
                    const ctx = canvas.getContext('2d');
                    
                    // Center crop
                    let sx, sy, sSize;
                    if (img.width > img.height) {
                        sSize = img.height;
                        sx = (img.width - sSize) / 2;
                        sy = 0;
                    } else {
                        sSize = img.width;
                        sx = 0;
                        sy = (img.height - sSize) / 2;
                    }
                    
                    ctx.drawImage(img, sx, sy, sSize, sSize, 0, 0, 150, 150);
                    const resizedPhoto = canvas.toDataURL('image/jpeg', 0.85);
                    
                    // Update preview and store data
                    document.getElementById('editDirectorPhoto').src = resizedPhoto;
                    window.editDirectorPhotoData = resizedPhoto;
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        function searchDirectorPhoto() {
            const name = document.getElementById('editDirectorName').value.trim();
            if (!name) {
                alert('Please enter the director name first');
                return;
            }
            window.open('https://www.google.com/search?tbm=isch&q=' + encodeURIComponent(name + ' athlete coach headshot'), '_blank');
            alert('üì∑ Find their photo on Google Images\n\n1. Right-click the photo ‚Üí "Save image as..."\n2. Come back here and click "Upload Photo"\n3. Select the downloaded image');
        }
        
        function searchDirectorBio() {
            const name = document.getElementById('editDirectorName').value.trim();
            if (!name) {
                alert('Please enter the director name first');
                return;
            }
            window.open('https://www.google.com/search?q=' + encodeURIComponent(name + ' athlete coach bio sports'), '_blank');
        }
        
        async function generateDirectorTitleAI() {
            const name = document.getElementById('editDirectorName').value.trim();
            if (!name) {
                alert('Please enter the director name first');
                return;
            }
            
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = '‚è≥ Generating...';
            
            try {
                const result = await callOpenAI('chat', {
                    model: 'gpt-4o-mini',
                    messages: [
                        {
                            role: 'system',
                            content: `You research sports professionals. Given a name, search your knowledge for this person. If they are a known athlete, coach, or sports professional, return their REAL title/role and brief background.

If unknown, generate a realistic sports-related title.

Return ONLY the title (15 words max), no explanation. Examples:
- "Former MLB Pitcher, 12-Year Veteran, 2x All-Star"
- "Olympic Gold Medalist, Track & Field Coach"
- "NFL Strength & Conditioning Coach, 20+ Years Experience"`
                        },
                        { role: 'user', content: `Professional sports title for: ${name}` }
                    ],
                    temperature: 0.7,
                    max_tokens: 60
                });
                
                if (result.error) {
                    throw new Error(result.error.message);
                }
                
                const generatedTitle = result.choices[0].message.content.trim().replace(/^["']|["']$/g, '');
                document.getElementById('editDirectorTitle').value = generatedTitle;
                
            } catch (error) {
                alert('Error generating title: ' + error.message);
            }
            
            btn.disabled = false;
            btn.textContent = 'ü§ñ AI Generate Title';
        }
        
        function saveDirectorEdit() {
            const index = parseInt(document.getElementById('editDirectorIndex').value);
            const name = document.getElementById('editDirectorName').value.trim();
            const title = document.getElementById('editDirectorTitle').value.trim();
            const photo = window.editDirectorPhotoData || '';
            
            if (!name) {
                alert('Please enter a name');
                return;
            }
            
            data.directors[index] = { name, title: title || 'Director', photo };
            
            // Sort alphabetically
            data.directors.sort((a, b) => {
                const nameA = typeof a === 'object' ? a.name : a;
                const nameB = typeof b === 'object' ? b.name : b;
                return nameA.localeCompare(nameB);
            });
            
            saveData('directors');
            loadDirectors();
            loadAdminDirectors();
            closeModal('editDirectorModal');
            
            alert('‚úÖ Director saved successfully!');
        }
        
        function resizeAndSavePhoto(file, index, newName, newTitle) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    // Create canvas for resizing
                    const canvas = document.createElement('canvas');
                    const size = 150; // Profile pic size
                    canvas.width = size;
                    canvas.height = size;
                    const ctx = canvas.getContext('2d');
                    
                    // Calculate crop to make square (center crop)
                    let sx, sy, sSize;
                    if (img.width > img.height) {
                        sSize = img.height;
                        sx = (img.width - sSize) / 2;
                        sy = 0;
                    } else {
                        sSize = img.width;
                        sx = 0;
                        sy = (img.height - sSize) / 2;
                    }
                    
                    // Draw resized image
                    ctx.drawImage(img, sx, sy, sSize, sSize, 0, 0, size, size);
                    
                    // Convert to base64 (compressed JPEG)
                    const base64Photo = canvas.toDataURL('image/jpeg', 0.8);
                    
                    // Save director with photo
                    data.directors[index] = { name: newName.trim(), title: newTitle.trim(), photo: base64Photo };
                    sortAndSaveDirectors();
                    alert('Photo uploaded successfully!');
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        function sortAndSaveDirectors() {
            data.directors.sort((a, b) => {
                const nameA = typeof a === 'object' ? a.name : a;
                const nameB = typeof b === 'object' ? b.name : b;
                return nameA.localeCompare(nameB);
            });
            saveData('directors');
            loadDirectors();
            loadAdminDirectors();
        }
        
        function doDeleteDirector(name) {
            if (confirm('Delete "' + name + '"?')) {
                const index = data.directors.findIndex(d => (typeof d === 'object' ? d.name : d) === name);
                if (index !== -1) {
                    data.directors.splice(index, 1);
                    saveData('directors');
                    loadDirectors();
                    loadAdminDirectors();
                }
            }
        }
        
        // ============================================
        // ADMIN FUNCTIONS
        // ============================================
        let footerClicks = 0;
        document.getElementById('mainFooter').addEventListener('click', () => {
            footerClicks++;
            if (footerClicks >= 3) { footerClicks = 0; openAdminScreen(); }
            setTimeout(() => { footerClicks = 0; }, 1000);
        });
        
        window.verifyAdmin = function() {
            const enteredPassword = document.getElementById('adminPassword').value;
            const storedPassword = localStorage.getItem('apex_adminPassword') || CONFIG.adminPassword;
            
            if (enteredPassword === storedPassword) {
                // Check if we should offer to save password
                const savedPassword = localStorage.getItem('apex_savedAdminPassword');
                if (!savedPassword && enteredPassword) {
                    if (confirm('Save password for future logins?')) {
                        localStorage.setItem('apex_savedAdminPassword', enteredPassword);
                    }
                }
                
                // Save admin session
                localStorage.setItem('apex_adminLoggedIn', 'true');
                
                document.getElementById('adminLogin').style.display = 'none';
                document.getElementById('adminDashboard').style.display = 'block';
                loadAdminData();
            } else {
                alert('Incorrect password');
            }
        }
        var verifyAdmin = window.verifyAdmin;
        
        // Logout function
        function logoutAdmin() {
            localStorage.removeItem('apex_adminLoggedIn');
            document.getElementById('adminDashboard').style.display = 'none';
            document.getElementById('adminLogin').style.display = 'block';
            document.getElementById('adminPassword').value = '';
        }
        
        // Auto-login if session exists
        function checkAdminSession() {
            if (localStorage.getItem('apex_adminLoggedIn') === 'true') {
                document.getElementById('adminLogin').style.display = 'none';
                document.getElementById('adminDashboard').style.display = 'block';
                loadAdminData();
            }
        }
        
        // Auto-fill saved admin password on page load
        function loadSavedAdminPassword() {
            const savedPassword = localStorage.getItem('apex_savedAdminPassword');
            if (savedPassword) {
                document.getElementById('adminPassword').value = savedPassword;
            }
            checkAdminSession();
        }
        
        window.showAdminTab = function(tab) {
            document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            document.querySelectorAll('.admin-section').forEach(s => s.classList.remove('active'));
            document.getElementById('tab-' + tab).classList.add('active');
            loadAdminData();
        }
        var showAdminTab = window.showAdminTab;
        
        function loadAdminData() {
            document.getElementById('overviewStats').innerHTML = `
                <div class="stat-card"><div class="number">${data.directors.length}</div><div class="label">Directors</div></div>
                <div class="stat-card"><div class="number">${data.users.length}</div><div class="label">Tracked Users</div></div>
                <div class="stat-card"><div class="number">${data.activity.length}</div><div class="label">Activity Logs</div></div>
                <div class="stat-card"><div class="number">${data.quizResults.length}</div><div class="label">Quiz Completions</div></div>
                <div class="stat-card"><div class="number">${data.unanswered.length}</div><div class="label">Unanswered Q's</div></div>
            `;
            loadAdminDirectors();
            loadActivityTable();
            loadUsersTable();
            loadUnanswered();
            loadEmailSettings();
            document.getElementById('showDirectorsToggle').checked = data.showDirectors;
        }
        
        function loadActivityTable() {
            const tbody = document.querySelector('#activityTable tbody');
            tbody.innerHTML = data.activity.slice(-100).reverse().map(a => `
                <tr>
                    <td>${a.time}</td>
                    <td>${a.email || '-'}</td>
                    <td>${a.ip}</td>
                    <td><span style="color:var(--orange);">${a.action}</span></td>
                    <td style="max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;" title="${a.details}">${a.details || '-'}</td>
                    <td>${a.location || '-'}</td>
                    <td>${a.sessionDuration ? a.sessionDuration + 's' : '-'}</td>
                </tr>
            `).join('');
        }
        
        function loadUsersTable() {
            const tbody = document.querySelector('#usersTable tbody');
            document.getElementById('totalUsers').textContent = data.users.length;
            tbody.innerHTML = data.users.map((u, i) => `
                <tr>
                    <td><strong style="color:var(--orange);">${u.email}</strong></td>
                    <td>${u.location?.city ? u.location.city + ', ' + u.location.region : '-'}</td>
                    <td>${u.firstVisit || '-'}</td>
                    <td>${u.lastVisit || '-'}</td>
                    <td>${u.totalSessions || 1}</td>
                    <td>${formatTime(u.totalTimeOnSite || 0)}</td>
                    <td>${u.quizScores?.length ? u.quizScores[u.quizScores.length-1].score : '-'}</td>
                    <td>${u.interests?.slice(0,3).join(', ') || '-'}</td>
                    <td><button class="export-btn" onclick="viewUserDetails(${i})" style="padding:4px 8px;font-size:11px;">View</button></td>
                </tr>
            `).join('') || '<tr><td colspan="9" style="text-align:center;color:var(--text-muted);">No users tracked yet</td></tr>';
        }
        
        function formatTime(seconds) {
            if (seconds < 60) return seconds + 's';
            if (seconds < 3600) return Math.round(seconds/60) + 'm';
            return Math.round(seconds/3600) + 'h ' + Math.round((seconds%3600)/60) + 'm';
        }
        
        function viewUserDetails(index) {
            const u = data.users[index];
            const details = `
USER PROFILE: ${u.email}
================================
IP: ${u.ip}
Location: ${u.location?.city ? u.location.city + ', ' + u.location.region + ', ' + u.location.country : 'Unknown'}
First Visit: ${u.firstVisit}
Last Visit: ${u.lastVisit}
Total Sessions: ${u.totalSessions || 1}
Total Time on Site: ${formatTime(u.totalTimeOnSite || 0)}

INTERESTS: ${u.interests?.join(', ') || 'None'}

SEARCHES (${u.searches?.length || 0}):
${u.searches?.map(s => `  ‚Ä¢ ${s.state} - ${s.zip} - ${s.sport} (${s.time})`).join('\n') || '  None'}

QUIZ SCORES (${u.quizScores?.length || 0}):
${u.quizScores?.map(q => `  ‚Ä¢ ${q.score} (${q.time})`).join('\n') || '  None'}

VIDEOS WATCHED (${u.videosWatched?.length || 0}):
${u.videosWatched?.map(v => `  ‚Ä¢ ${v.video} - ${v.duration}s (${v.time})`).join('\n') || '  None'}

BUTTONS CLICKED (${u.buttonsClicked?.length || 0}):
${u.buttonsClicked?.slice(-10).map(b => `  ‚Ä¢ ${b.button} (${b.time})`).join('\n') || '  None'}

CHAT MESSAGES (${u.chatMessages?.length || 0}):
${u.chatMessages?.slice(-10).map(c => `  ‚Ä¢ ${c.message} (${c.time})`).join('\n') || '  None'}

MODALS OPENED (${u.modalsOpened?.length || 0}):
${u.modalsOpened?.slice(-10).map(m => `  ‚Ä¢ ${m.modal} (${m.time})`).join('\n') || '  None'}
            `;
            alert(details);
        }
        
        function exportUsers() {
            const csv = 'Email,IP,City,Region,Country,First Visit,Last Visit,Sessions,Time on Site,Quiz Scores,Interests\n' + 
                data.users.map(u => `"${u.email}","${u.ip}","${u.location?.city || ''}","${u.location?.region || ''}","${u.location?.country || ''}","${u.firstVisit}","${u.lastVisit}","${u.totalSessions || 1}","${u.totalTimeOnSite || 0}","${u.quizScores?.map(q=>q.score).join(';') || ''}","${u.interests?.join(';') || ''}"`).join('\n');
            const blob = new Blob([csv], {type:'text/csv'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'apex_users.csv';
            a.click();
        }
        
        function exportUsersDetailed() {
            const json = JSON.stringify(data.users, null, 2);
            const blob = new Blob([json], {type:'application/json'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'apex_users_detailed.json';
            a.click();
        }
        
        function exportActivity() {
            const csv = 'Time,Email,IP,Action,Details,Location,Session Duration\n' + data.activity.map(a => `"${a.time}","${a.email || ''}","${a.ip}","${a.action}","${a.details || ''}","${a.location || ''}","${a.sessionDuration || ''}"`).join('\n');
            const blob = new Blob([csv], {type:'text/csv'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'apex_activity.csv';
            a.click();
        }
        
        function clearActivity() { if(confirm('Clear activity log?')) { data.activity = []; saveData('activity'); loadActivityTable(); } }
        function clearAllData() { if(confirm('Clear ALL data?')) { localStorage.clear(); location.reload(); } }
        
        function loadUnanswered() {
            const list = document.getElementById('unansweredList');
            list.innerHTML = data.unanswered.length ? data.unanswered.map((q, i) => `
                <div style="background:rgba(0,0,0,0.2);padding:16px;border-radius:8px;margin-bottom:12px;">
                    <div style="color:var(--orange);font-weight:600;">Q: ${q.question}</div>
                    <div style="font-size:12px;color:var(--text-muted);">${q.time} ${q.email ? '| ' + q.email : ''}</div>
                    <textarea id="answer_${i}" placeholder="Your answer..." style="width:100%;margin-top:8px;background:rgba(255,255,255,0.05);border:1px solid var(--border);border-radius:8px;padding:8px;color:var(--text);"></textarea>
                    <button class="export-btn" style="margin-top:8px;" onclick="saveAnswer(${i})">Save Answer</button>
                </div>
            `).join('') : '<p style="color:var(--text-muted);">No unanswered questions</p>';
        }
        
        function saveAnswer(index) {
            const answer = document.getElementById('answer_' + index).value;
            if (answer) {
                data.unanswered.splice(index, 1);
                saveData('unanswered');
                loadUnanswered();
                alert('Answer saved!');
            }
        }
        
        function loadEmailSettings() {
            const s = data.emailSettings;
            document.getElementById('email_name').value = s.name || '';
            document.getElementById('email_title').value = s.title || '';
            document.getElementById('email_address').value = s.email || '';
            document.getElementById('email_apexLink').value = s.apexLink || '';
            document.getElementById('email_bookingLink').value = s.bookingLink || '';
        }
        
        function saveEmailSettings() {
            data.emailSettings = {
                name: document.getElementById('email_name').value,
                title: document.getElementById('email_title').value,
                email: document.getElementById('email_address').value,
                apexLink: document.getElementById('email_apexLink').value,
                bookingLink: document.getElementById('email_bookingLink').value
            };
            saveData('emailSettings');
            alert('Settings saved!');
        }
        
        function saveVideos() {
            data.videos = {
                testimonials: document.getElementById('video_testimonials').value,
                presentations: document.getElementById('video_presentations').value,
                meetings: document.getElementById('video_meetings').value,
                resources: document.getElementById('video_resources').value,
                qna: document.getElementById('video_qna').value
            };
            saveData('videos');
            alert('Videos saved!');
        }
        
        // ============================================
        // INITIALIZATION
        // ============================================
        document.getElementById('sendBtn').addEventListener('click', function() { window.handleSend(); });
        document.getElementById('inputField').addEventListener('keypress', e => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); window.handleSend(); } });
        document.querySelectorAll('.mode-btn').forEach(btn => btn.addEventListener('click', () => setMode(btn.dataset.mode)));
        document.addEventListener('keydown', e => { if (e.key === 'Escape') document.querySelectorAll('.modal-overlay.active').forEach(m => closeModal(m.id)); });
        
        // Initialize
        loadDirectors();
        setMode('chat');
        document.getElementById('directorsSection').style.display = data.showDirectors ? 'block' : 'none';
        logActivity('Page Load', navigator.userAgent.substring(0, 50));
        
        // Video Modal Functions
        window.openVideoModal = function(type) {
            const videoUrls = window.data.videos || {};
            const url = videoUrls[type.toLowerCase()];
            const modal = document.getElementById('videoResourceModal');
            const container = document.getElementById('videoContainer');
            const title = document.getElementById('videoModalTitle');
            
            title.textContent = type.charAt(0).toUpperCase() + type.slice(1);
            
            if (!url) {
                container.innerHTML = '<div class="not-available"><div class="not-available-icon">üì∫</div><div class="not-available-text">NOT AVAILABLE</div><p>No video configured. Admin can add YouTube links.</p></div>';
            } else if (url.includes('youtube.com') || url.includes('youtu.be')) {
                // YouTube video
                const videoId = url.match(/(?:(?:www\.)?youtube\.com\/(?:watch\?v=|embed\/)|youtu\.be\/)([a-zA-Z0-9_-]+)/);
                if (videoId) {
                    container.innerHTML = '<iframe width="100%" height="450" src="https://www.youtube.com/embed/' + videoId[1] + '?rel=0" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen style="border-radius:8px;"></iframe>';
                } else {
                    container.innerHTML = '<div class="not-available"><div class="not-available-icon">üì∫</div><div class="not-available-text">INVALID URL</div><p>Could not parse YouTube URL. Please use format: https://youtube.com/watch?v=VIDEO_ID</p></div>';
                }
            } else if (url.includes('docs.google.com/presentation')) {
                // Google Slides
                const embedUrl = url.replace('/edit', '/embed').replace('/view', '/embed');
                container.innerHTML = '<iframe width="100%" height="450" src="' + embedUrl + '?start=false&loop=false&delayms=3000" frameborder="0" allowfullscreen style="border-radius:8px;"></iframe>';
            } else if (url.includes('docs.google.com/document')) {
                // Google Docs
                const embedUrl = url.replace('/edit', '/preview').replace('/view', '/preview');
                container.innerHTML = '<iframe width="100%" height="450" src="' + embedUrl + '" frameborder="0" style="border-radius:8px;"></iframe>';
            } else if (url.includes('vimeo.com')) {
                // Vimeo
                const vimeoId = url.match(/vimeo\.com\/(\d+)/);
                if (vimeoId) {
                    container.innerHTML = '<iframe width="100%" height="450" src="https://player.vimeo.com/video/' + vimeoId[1] + '" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen style="border-radius:8px;"></iframe>';
                } else {
                    container.innerHTML = '<div class="not-available"><div class="not-available-icon">üì∫</div><div class="not-available-text">INVALID URL</div><p>Could not parse Vimeo URL.</p></div>';
                }
            } else if (url.includes('loom.com')) {
                // Loom
                const loomId = url.match(/loom\.com\/share\/([a-zA-Z0-9]+)/);
                if (loomId) {
                    container.innerHTML = '<iframe width="100%" height="450" src="https://www.loom.com/embed/' + loomId[1] + '" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen style="border-radius:8px;"></iframe>';
                } else {
                    container.innerHTML = '<iframe width="100%" height="450" src="' + url.replace('/share/', '/embed/') + '" frameborder="0" allowfullscreen style="border-radius:8px;"></iframe>';
                }
            } else {
                // Generic iframe
                container.innerHTML = '<iframe width="100%" height="450" src="' + url + '" frameborder="0" allowfullscreen style="border-radius:8px;"></iframe>';
            }
            
            openModal('videoResourceModal');
            logActivity('Video Modal', type);
        }
        var openVideoModal = window.openVideoModal;
        // Operations Qualification Quiz
        const opsQuizQuestions = JSON.parse(localStorage.getItem('apex_opsQuestions')) || [
            { question: "How many years of experience do you have in sports or athletics?", options: ["Less than 1 year", "1-2 years", "3-5 years", "5+ years"], correct: [2, 3] },
            { question: "Have you managed a team or supervised employees?", options: ["No experience", "Informal leadership only", "1-5 direct reports", "5+ direct reports"], correct: [2, 3] },
            { question: "What is your familiarity with youth sports programs?", options: ["None", "Participant only", "Volunteer/coach", "Professional experience"], correct: [2, 3] },
            { question: "Are you comfortable with sales or business development?", options: ["Not at all", "Somewhat", "Comfortable", "Very experienced"], correct: [2, 3] },
            { question: "Can you commit to full-time availability?", options: ["Part-time only", "Flexible schedule", "Standard business hours", "Full availability including weekends"], correct: [2, 3] }
        ];
        
        let opsQuizState = { current: 0, score: 0 };
        
        function initOpsQuiz() {
            opsQuizState = { current: 0, score: 0 };
            document.getElementById('opsQuizSection').style.display = 'block';
            document.getElementById('opsFailSection').style.display = 'none';
            document.getElementById('opsSuccessSection').style.display = 'none';
            showOpsQuestion();
        }
        
        function showOpsQuestion() {
            const q = opsQuizQuestions[opsQuizState.current];
            document.getElementById('opsQuestionNum').textContent = opsQuizState.current + 1;
            document.getElementById('opsTotalQuestions').textContent = opsQuizQuestions.length;
            document.getElementById('opsScore').textContent = opsQuizState.score;
            document.getElementById('opsQuizQuestion').textContent = q.question;
            
            const optionsEl = document.getElementById('opsQuizOptions');
            optionsEl.innerHTML = '';
            q.options.forEach((opt, i) => {
                const div = document.createElement('div');
                div.className = 'quiz-option';
                div.textContent = opt;
                div.onclick = () => selectOpsAnswer(i);
                optionsEl.appendChild(div);
            });
        }
        
        function selectOpsAnswer(index) {
            const q = opsQuizQuestions[opsQuizState.current];
            const isCorrect = Array.isArray(q.correct) ? q.correct.includes(index) : index === q.correct;
            
            if (isCorrect) opsQuizState.score++;
            
            logActivity('Ops Quiz Answer', `Q${opsQuizState.current + 1}: ${isCorrect ? 'Qualified' : 'Not qualified'}`);
            
            if (opsQuizState.current < opsQuizQuestions.length - 1) {
                opsQuizState.current++;
                showOpsQuestion();
            } else {
                // Quiz complete
                const passed = opsQuizState.score >= 4;
                logActivity('Ops Quiz Complete', `Score: ${opsQuizState.score}/${opsQuizQuestions.length} - ${passed ? 'PASSED' : 'FAILED'}`);
                
                document.getElementById('opsQuizSection').style.display = 'none';
                if (passed) {
                    document.getElementById('opsSuccessSection').style.display = 'block';
                } else {
                    document.getElementById('opsFailSection').style.display = 'block';
                }
            }
        }
        
        function resetOpsQuiz() {
            opsQuizState = { current: 0, score: 0 };
            document.getElementById('opsQuizSection').style.display = 'block';
            document.getElementById('opsFailSection').style.display = 'none';
            document.getElementById('opsSuccessSection').style.display = 'none';
        }
        
        window.submitOpsApplication = function() {
            const name = document.getElementById('ops_name').value.trim();
            const email = document.getElementById('ops_email').value.trim();
            const phone = document.getElementById('ops_phone').value.trim();
            
            if (!name || !email || !phone) {
                alert('Please fill in all required fields');
                return;
            }
            
            const application = {
                date: new Date().toLocaleString(),
                ip: userIP,
                name, email, phone,
                position: document.getElementById('ops_position').value,
                experience: document.getElementById('ops_experience').value,
                quizScore: opsQuizState.score
            };
            
            let opsApplications = JSON.parse(localStorage.getItem('apex_opsApplications')) || [];
            opsApplications.push(application);
            localStorage.setItem('apex_opsApplications', JSON.stringify(opsApplications));
            
            logActivity('Ops Application', `${name} - ${email}`);
            
            alert('Thank you! Your application has been submitted. We will contact you within 48 hours.');
            closeModal('operationsModal');
            resetOpsQuiz();
        }
        var submitOpsApplication = window.submitOpsApplication;
        
        // Initialize ops quiz when modal opens
        const originalOpenModal = openModal;
        openModal = function(id) {
            originalOpenModal(id);
            if (id === 'operationsModal') {
                initOpsQuiz();
            }
        };
        
        console.log('üöÄ APEX Landing Page Loaded');
    </script>
    <!-- Video Resource Modal -->
    <div class="modal-overlay" id="videoResourceModal">
        <div class="modal" style="max-width:800px;">
            <div class="modal-header">
                <h2 id="videoModalTitle">Video Resource</h2>
                <button class="modal-close" onclick="closeModal('videoResourceModal')">&times;</button>
            </div>
            <div id="videoContainer" style="min-height:400px;"></div>
        </div>
    </div>
<script>
// ============================================
// ENHANCED ADMIN FUNCTIONS
// ============================================

// Leads Management
let leads = JSON.parse(localStorage.getItem('apex_leads')) || [];
let reservations = JSON.parse(localStorage.getItem('apex_reservations')) || [];

function loadLeadsTable() {
    const tbody = document.querySelector('#leadsTable tbody');
    const filter = document.getElementById('leadFilter')?.value || 'all';
    const filtered = filter === 'all' ? leads : leads.filter(l => l.status === filter);
    tbody.innerHTML = filtered.map((l, i) => `
        <tr>
            <td>${l.date || 'N/A'}</td>
            <td>${l.name || 'N/A'}</td>
            <td><a href="mailto:${l.email}" style="color:var(--orange);">${l.email || 'N/A'}</a></td>
            <td>${l.phone || 'N/A'}</td>
            <td>${l.state || 'N/A'}</td>
            <td>${l.sport || 'N/A'}</td>
            <td><span style="padding:4px 8px; border-radius:4px; font-size:11px; background:${getStatusColor(l.status)}">${l.status || 'new'}</span></td>
            <td>
                <select onchange="updateLeadStatus(${i}, this.value)" style="padding:4px; border-radius:4px; background:var(--card-bg); color:var(--text); border:1px solid var(--border); font-size:11px;">
                    <option value="new" ${l.status === 'new' ? 'selected' : ''}>New</option>
                    <option value="contacted" ${l.status === 'contacted' ? 'selected' : ''}>Contacted</option>
                    <option value="qualified" ${l.status === 'qualified' ? 'selected' : ''}>Qualified</option>
                    <option value="converted" ${l.status === 'converted' ? 'selected' : ''}>Converted</option>
                </select>
            </td>
        </tr>
    `).join('') || '<tr><td colspan="8" style="text-align:center; color:var(--text-muted);">No leads yet</td></tr>';
}

function getStatusColor(status) {
    const colors = { new: 'rgba(237,112,35,0.3)', contacted: 'rgba(59,130,246,0.3)', qualified: 'rgba(168,85,247,0.3)', converted: 'rgba(55,201,56,0.3)' };
    return colors[status] || colors.new;
}

function updateLeadStatus(index, status) {
    leads[index].status = status;
    localStorage.setItem('apex_leads', JSON.stringify(leads));
    loadLeadsTable();
}

function exportLeads() {
    if (!leads.length) { alert('No leads to export'); return; }
    const csv = 'Date,Name,Email,Phone,State,Sport,Status\n' + leads.map(l => 
        `"${l.date}","${l.name}","${l.email}","${l.phone}","${l.state}","${l.sport}","${l.status}"`
    ).join('\n');
    downloadCSV(csv, 'apex_leads.csv');
}

function filterLeads() { loadLeadsTable(); }
function refreshLeads() { leads = JSON.parse(localStorage.getItem('apex_leads')) || []; loadLeadsTable(); }

// Reservations Management
function loadReservationsTable() {
    const tbody = document.querySelector('#reservationsTable tbody');
    const filter = document.getElementById('reservationFilter')?.value || 'all';
    const filtered = filter === 'all' ? reservations : reservations.filter(r => r.status === filter);
    tbody.innerHTML = filtered.map((r, i) => `
        <tr>
            <td style="font-family:monospace; color:var(--green);">${r.authCode}</td>
            <td>${r.date || 'N/A'}</td>
            <td>${r.name || 'N/A'}</td>
            <td>${r.state}</td>
            <td>${r.zip}</td>
            <td>${r.sport}</td>
            <td><span style="padding:4px 8px; border-radius:4px; font-size:11px; background:${getReservationStatusColor(r.status)}">${r.status}</span></td>
            <td>
                <select onchange="updateReservationStatus(${i}, this.value)" style="padding:4px; border-radius:4px; background:var(--card-bg); color:var(--text); border:1px solid var(--border); font-size:11px;">
                    <option value="pending" ${r.status === 'pending' ? 'selected' : ''}>Pending</option>
                    <option value="approved" ${r.status === 'approved' ? 'selected' : ''}>Approved</option>
                    <option value="active" ${r.status === 'active' ? 'selected' : ''}>Active</option>
                    <option value="rejected" ${r.status === 'rejected' ? 'selected' : ''}>Rejected</option>
                </select>
            </td>
        </tr>
    `).join('') || '<tr><td colspan="8" style="text-align:center; color:var(--text-muted);">No reservations yet</td></tr>';
}

function getReservationStatusColor(status) {
    const colors = { pending: 'rgba(237,112,35,0.3)', approved: 'rgba(59,130,246,0.3)', active: 'rgba(55,201,56,0.3)', rejected: 'rgba(239,68,68,0.3)' };
    return colors[status] || colors.pending;
}

function updateReservationStatus(index, status) {
    reservations[index].status = status;
    localStorage.setItem('apex_reservations', JSON.stringify(reservations));
    loadReservationsTable();
}

function exportReservations() {
    if (!reservations.length) { alert('No reservations to export'); return; }
    const csv = 'AuthCode,Date,Name,State,Zip,Sport,Status\n' + reservations.map(r => 
        `"${r.authCode}","${r.date}","${r.name}","${r.state}","${r.zip}","${r.sport}","${r.status}"`
    ).join('\n');
    downloadCSV(csv, 'apex_reservations.csv');
}

function filterReservations() { loadReservationsTable(); }

// Directors Enhanced
function exportDirectors() {
    const csv = 'Name\n' + data.directors.map(d => `"${d}"`).join('\n');
    downloadCSV(csv, 'apex_directors.csv');
}

function importDirectors() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.csv';
    input.onchange = (e) => {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = (ev) => {
            const lines = ev.target.result.split('\n').slice(1);
            lines.forEach(line => {
                const name = line.replace(/"/g, '').trim();
                if (name && !data.directors.includes(name)) data.directors.push(name);
            });
            data.directors.sort();
            saveData('directors');
            loadDirectors();
            loadAdminDirectors();
            alert(`Imported ${lines.length} directors`);
        };
        reader.readAsText(file);
    };
    input.click();
}

// Activity Enhanced
function searchActivity() {
    const search = document.getElementById('activitySearch').value.toLowerCase();
    const rows = document.querySelectorAll('#activityTable tbody tr');
    rows.forEach(row => {
        row.style.display = row.textContent.toLowerCase().includes(search) ? '' : 'none';
    });
}

function filterActivity() {
    const filter = document.getElementById('activityFilter').value;
    const rows = document.querySelectorAll('#activityTable tbody tr');
    rows.forEach(row => {
        const action = row.cells[2]?.textContent || '';
        row.style.display = (filter === 'all' || action.includes(filter)) ? '' : 'none';
    });
}

// Custom Q&A
let customQA = JSON.parse(localStorage.getItem('apex_customQA')) || [];

function addCustomQA() {
    const q = document.getElementById('customQuestion').value.trim();
    const a = document.getElementById('customAnswer').value.trim();
    if (!q || !a) { alert('Please fill both question and answer'); return; }
    customQA.push({ keywords: q.toLowerCase().split(' '), response: a });
    localStorage.setItem('apex_customQA', JSON.stringify(customQA));
    document.getElementById('customQuestion').value = '';
    document.getElementById('customAnswer').value = '';
    alert('Q&A added to knowledge base!');
}

// Email Signature Preview
function previewEmailSignature() {
    const name = document.getElementById('email_name').value || 'Your Name';
    const title = document.getElementById('email_title').value || 'Your Title';
    const email = document.getElementById('email_address').value || 'email@areascouts.com';
    const phone = document.getElementById('email_phone').value || '(555) 123-4567';
    const style = document.getElementById('email_sigStyle').value;
    
    const preview = document.getElementById('emailSignaturePreview');
    preview.style.display = 'block';
    preview.innerHTML = style === 'professional' ? `
        <div style="font-family:Arial,sans-serif; font-size:14px; border-top:3px solid #ed7023; padding-top:15px;">
            <strong style="color:#16345f; font-size:16px;">${name}</strong><br>
            <span style="color:#666;">${title}</span><br><br>
            <span style="color:#ed7023;">üìß</span> ${email}<br>
            <span style="color:#ed7023;">üì±</span> ${phone}<br><br>
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==" style="height:40px;"><br>
            <span style="font-size:11px; color:#999;">AREA SCOUTS‚Ñ¢ | A.P.E.X. Assessment</span>
        </div>
    ` : style === 'friendly' ? `
        <div style="font-family:Arial,sans-serif; font-size:14px;">
            Best regards,<br><br>
            <strong>${name}</strong> üöÄ<br>
            ${title} @ AREA SCOUTS<br>
            ${phone} | ${email}
        </div>
    ` : `
        <div style="font-family:Arial,sans-serif; font-size:13px; color:#666;">
            ${name} | ${title}<br>
            ${email} | ${phone}
        </div>
    `;
}

// Video Preview
window.previewVideo = function(type) {
    const url = document.getElementById('video_' + type).value;
    if (url) openVideoModal(type);
    else alert('Please enter a video URL first');
}
var previewVideo = window.previewVideo;

// Analytics
function loadAnalytics() {
    const today = new Date().toLocaleDateString();
    const todayActivity = data.activity.filter(a => a.time.includes(today));
    const uniqueIPs = [...new Set(data.activity.map(a => a.ip))];
    
    document.getElementById('analyticsPageViews').textContent = todayActivity.filter(a => a.action === 'Page Load').length;
    document.getElementById('analyticsUniqueVisitors').textContent = uniqueIPs.length;
    document.getElementById('analyticsConversionRate').textContent = reservations.length > 0 ? Math.round((reservations.length / uniqueIPs.length) * 100) + '%' : '0%';
    
    // Top actions
    const actionCounts = {};
    data.activity.forEach(a => { actionCounts[a.action] = (actionCounts[a.action] || 0) + 1; });
    const topActions = Object.entries(actionCounts).sort((a,b) => b[1] - a[1]).slice(0, 5);
    document.getElementById('topActionsChart').innerHTML = topActions.map(([action, count]) => `
        <div style="display:flex; justify-content:space-between; padding:8px 0; border-bottom:1px solid var(--border);">
            <span>${action}</span>
            <strong style="color:var(--orange);">${count}</strong>
        </div>
    `).join('') || '<p style="color:var(--text-muted);">No data yet</p>';
}

// Content Editor
let siteContent = JSON.parse(localStorage.getItem('apex_content')) || {};

function loadContentEditor() {
    document.getElementById('content_availability').value = siteContent.availability || '';
    document.getElementById('content_evaluator').value = siteContent.evaluator || '';
    document.getElementById('content_operations').value = siteContent.operations || '';
    document.getElementById('content_waitlistApex').value = siteContent.waitlistApex || '';
    document.getElementById('content_waitlistAlert').value = siteContent.waitlistAlert || '';
}

function saveContent() {
    siteContent = {
        availability: document.getElementById('content_availability').value,
        evaluator: document.getElementById('content_evaluator').value,
        operations: document.getElementById('content_operations').value,
        waitlistApex: document.getElementById('content_waitlistApex').value,
        waitlistAlert: document.getElementById('content_waitlistAlert').value
    };
    localStorage.setItem('apex_content', JSON.stringify(siteContent));
    alert('Content saved!');
}

// Settings
function toggleChat() {
    const show = document.getElementById('showChatToggle').checked;
    document.querySelector('.agent-section').style.display = show ? 'block' : 'none';
    localStorage.setItem('apex_showChat', show);
}

function toggleStats() {
    const show = document.getElementById('showStatsToggle').checked;
    document.querySelector('.stats-banner').style.display = show ? 'grid' : 'none';
    localStorage.setItem('apex_showStats', show);
}

function changePassword() {
    const newPass = document.getElementById('newAdminPassword').value;
    if (newPass.length < 8) { alert('Password must be at least 8 characters'); return; }
    localStorage.setItem('apex_adminPassword', newPass);
    alert('Password updated! Use new password next login.');
}

function saveStripeLink() {
    const link = document.getElementById('stripeLink').value;
    localStorage.setItem('apex_stripeLink', link);
    CONFIG.stripeLink = link;
    alert('Stripe link saved!');
}

function exportAllData() {
    const allData = {
        directors: data.directors,
        activity: data.activity,
        videos: data.videos,
        emailSettings: data.emailSettings,
        leads: leads,
        reservations: reservations,
        customQA: customQA,
        content: siteContent
    };
    const blob = new Blob([JSON.stringify(allData, null, 2)], {type: 'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'apex_backup_' + new Date().toISOString().split('T')[0] + '.json';
    a.click();
}

function importAllData() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    input.onchange = (e) => {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = (ev) => {
            try {
                const imported = JSON.parse(ev.target.result);
                if (imported.directors) { data.directors = imported.directors; saveData('directors'); }
                if (imported.activity) { data.activity = imported.activity; saveData('activity'); }
                if (imported.videos) { data.videos = imported.videos; saveData('videos'); }
                if (imported.emailSettings) { data.emailSettings = imported.emailSettings; saveData('emailSettings'); }
                if (imported.leads) { leads = imported.leads; localStorage.setItem('apex_leads', JSON.stringify(leads)); }
                if (imported.reservations) { reservations = imported.reservations; localStorage.setItem('apex_reservations', JSON.stringify(reservations)); }
                if (imported.customQA) { customQA = imported.customQA; localStorage.setItem('apex_customQA', JSON.stringify(customQA)); }
                if (imported.content) { siteContent = imported.content; localStorage.setItem('apex_content', JSON.stringify(siteContent)); }
                alert('Data imported successfully!');
                loadAdminData();
            } catch (err) {
                alert('Error importing data: ' + err.message);
            }
        };
        reader.readAsText(file);
    };
    input.click();
}

// Helper
function downloadCSV(csv, filename) {
    const blob = new Blob([csv], {type: 'text/csv'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    a.click();
}

// Enhanced loadAdminData
const originalLoadAdminData = loadAdminData;
loadAdminData = function() {
    originalLoadAdminData();
    loadLeadsTable();
    loadReservationsTable();
    loadAnalytics();
    loadContentEditor();
    document.getElementById('directorCount').textContent = data.directors.length;
    
    // Load video URLs
    if (data.videos) {
        document.getElementById('video_testimonials').value = data.videos.testimonials || '';
        document.getElementById('video_presentations').value = data.videos.presentations || '';
        document.getElementById('video_meetings').value = data.videos.meetings || '';
        document.getElementById('video_resources').value = data.videos.resources || '';
        document.getElementById('video_qna').value = data.videos.qna || '';
    }
    
    // Load recent activity
    const recentList = document.getElementById('recentActivityList');
    if (recentList && data.activity.length > 0) {
        recentList.innerHTML = data.activity.slice(-10).reverse().map(a => `
            <div style="padding:6px 0; border-bottom:1px solid var(--border);">
                <div style="color:var(--orange);">${a.action}</div>
                <div style="color:var(--text-muted); font-size:11px;">${a.time} | ${a.ip}</div>
            </div>
        `).join('');
    }
    
    // Load Stripe link
    const stripeInput = document.getElementById('stripeLink');
    if (stripeInput) {
        stripeInput.value = localStorage.getItem('apex_stripeLink') || CONFIG.stripeLink;
    }
};

// ============================================
// AI LEARNING SYSTEM
// ============================================
// SECURE API - Using Cloudflare Worker (API key hidden)
const APEX_API_WORKER = 'https://apex-api.lancebaldwin.workers.dev';

// Secure API call function
async function callOpenAI(action, data) {
    const response = await fetch(APEX_API_WORKER, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action, data })
    });
    return response.json();
}

// Knowledge base storage - sync with global
let aiKnowledge = window.aiKnowledge || JSON.parse(localStorage.getItem('apex_aiKnowledge')) || [];
window.aiKnowledge = aiKnowledge; // Ensure they're the same reference
let learnedVideos = JSON.parse(localStorage.getItem('apex_learnedVideos')) || [];

function saveAIData() {
    localStorage.setItem('apex_aiKnowledge', JSON.stringify(aiKnowledge));
    localStorage.setItem('apex_learnedVideos', JSON.stringify(learnedVideos));
    window.aiKnowledge = aiKnowledge; // Keep in sync
    console.log('AI Knowledge saved:', aiKnowledge.length, 'items');
}

// Learn from YouTube video
async function learnFromVideo() {
    const url = document.getElementById('learnVideoUrl').value.trim();
    const title = document.getElementById('learnVideoTitle').value.trim();
    
    if (!url || !title) {
        alert('Please enter both URL and title');
        return;
    }
    
    // Extract video ID
    const videoId = extractYouTubeId(url);
    if (!videoId) {
        alert('Invalid YouTube URL');
        return;
    }
    
    // Check if already learned
    if (learnedVideos.find(v => v.videoId === videoId)) {
        alert('This video has already been learned!');
        return;
    }
    
    try {
        // Show loading
        const btn = event.target;
        btn.disabled = true;
        btn.textContent = '‚è≥ Fetching transcript...';
        
        // Try to get transcript via a free API
        const transcript = await getYouTubeTranscript(videoId);
        
        if (!transcript) {
            btn.textContent = '‚è≥ No auto-transcript, using AI to analyze...';
        }
        
        btn.textContent = 'üß† AI is learning...';
        
        // Send to OpenAI for learning
        const knowledge = await processWithAI(transcript || `Video titled: ${title}`, title);
        
        if (knowledge && knowledge.length > 0) {
            // Add to knowledge base
            knowledge.forEach(k => {
                aiKnowledge.push({
                    topic: k.topic,
                    content: k.content,
                    source: title,
                    videoUrl: url,
                    addedAt: new Date().toLocaleString()
                });
            });
            
            learnedVideos.push({
                videoId,
                title,
                url,
                learnedAt: new Date().toLocaleString(),
                itemsLearned: knowledge.length
            });
            
            saveAIData();
            loadKnowledgeList();
            updateAIStats();
            
            alert(`‚úÖ Successfully learned ${knowledge.length} items from "${title}"!`);
            
            // Clear inputs
            document.getElementById('learnVideoUrl').value = '';
            document.getElementById('learnVideoTitle').value = '';
        }
        
        btn.disabled = false;
        btn.textContent = 'üß† LEARN FROM THIS VIDEO';
        
    } catch (error) {
        console.error('Learn error:', error);
        alert('Error learning from video: ' + error.message);
        event.target.disabled = false;
        event.target.textContent = 'üß† LEARN FROM THIS VIDEO';
    }
}

function extractYouTubeId(url) {
    const match = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\s]+)/);
    return match ? match[1] : null;
}

async function getYouTubeTranscript(videoId) {
    // Try multiple transcript APIs
    try {
        const response = await fetch(`https://yt-transcript-api.vercel.app/api/transcript?videoId=${videoId}`);
        if (response.ok) {
            const data = await response.json();
            return data.map(item => item.text).join(' ');
        }
    } catch (e) {
        console.log('Transcript API 1 failed');
    }
    
    // Fallback - return null, AI will work with just the title
    return null;
}

async function processWithAI(content, title) {
    const systemPrompt = `You are an AI knowledge extractor for APEX (Athletic Performance Enhancement eXperience) and Area Scouts. 
    
Extract key facts, concepts, and information from the provided content. Format your response as a JSON array of objects with "topic" and "content" fields.

Focus on:
- Program details, benefits, features
- Names, titles, roles of people mentioned
- Statistics, numbers, facts
- Processes, procedures, steps
- Definitions, explanations

Example output:
[
  {"topic": "What is APEX?", "content": "APEX stands for Athletic Performance Enhancement eXperience, a youth athlete development program."},
  {"topic": "Dr. Anthony's role", "content": "Dr. Anthony Inzillo is the Director of Sports Medicine for APEX."}
]

Return ONLY valid JSON array, no other text.`;

    const data = await callOpenAI('chat', {
        model: 'gpt-4o-mini',
        messages: [
            { role: 'system', content: systemPrompt },
            { role: 'user', content: `Video Title: ${title}\n\nContent:\n${content.substring(0, 8000)}` }
        ],
        temperature: 0.3
    });
    
    if (data.error) {
        throw new Error(data.error.message);
    }
    
    try {
        const text = data.choices[0].message.content;
        // Extract JSON from response
        const jsonMatch = text.match(/\[[\s\S]*\]/);
        return jsonMatch ? JSON.parse(jsonMatch[0]) : [];
    } catch (e) {
        console.error('Parse error:', e);
        return [];
    }
}

// Add manual knowledge
function addManualKnowledge() {
    const topic = document.getElementById('manualTopic').value.trim();
    const content = document.getElementById('manualKnowledge').value.trim();
    
    if (!topic || !content) {
        alert('Please enter both topic and knowledge');
        return;
    }
    
    aiKnowledge.push({
        topic,
        content,
        source: 'Manual Entry',
        addedAt: new Date().toLocaleString()
    });
    
    saveAIData();
    loadKnowledgeList();
    updateAIStats();
    
    document.getElementById('manualTopic').value = '';
    document.getElementById('manualKnowledge').value = '';
    
    alert('Knowledge added!');
}

// Generate quiz questions from knowledge
async function generateQuizQuestions() {
    if (window.aiKnowledge.length < 3) {
        alert('Need at least 3 knowledge items to generate questions');
        return;
    }
    
    const btn = event.target;
    btn.disabled = true;
    btn.textContent = '‚è≥ Generating...';
    
    try {
        const knowledgeSummary = aiKnowledge.slice(-20).map(k => `${k.topic}: ${k.content}`).join('\n');
        
        const data = await callOpenAI('chat', {
            model: 'gpt-4o-mini',
            messages: [
                { 
                    role: 'system', 
                    content: `Generate 5 multiple choice quiz questions about APEX and Area Scouts based on the provided knowledge. 
                    
Format as JSON array:
[{
  "question": "Question text?",
  "options": ["A", "B", "C", "D"],
  "correct": 0,
  "explanation": "Brief explanation"
}]

Make questions educational and relevant. correct is the index (0-3) of the right answer.
Return ONLY valid JSON array.`
                },
                { role: 'user', content: knowledgeSummary }
            ],
            temperature: 0.7
        });
        
        const text = data.choices[0].message.content;
        const jsonMatch = text.match(/\[[\s\S]*\]/);
        
        if (jsonMatch) {
            const questions = JSON.parse(jsonMatch[0]);
            displayGeneratedQuestions(questions);
        }
        
    } catch (error) {
        alert('Error generating questions: ' + error.message);
    }
    
    btn.disabled = false;
    btn.textContent = 'üé≤ Generate 5 New Questions';
}

function displayGeneratedQuestions(questions) {
    const container = document.getElementById('generatedQuestions');
    container.innerHTML = questions.map((q, i) => `
        <div style="background:rgba(0,0,0,0.3); padding:12px; border-radius:8px; margin-bottom:10px;">
            <strong style="color:var(--orange);">Q${i+1}: ${q.question}</strong>
            <div style="margin:8px 0; font-size:13px;">
                ${q.options.map((opt, j) => `<div style="color:${j === q.correct ? 'var(--green)' : 'var(--text-muted)'};">${j === q.correct ? '‚úì' : '‚óã'} ${opt}</div>`).join('')}
            </div>
            <div style="font-size:11px; color:var(--text-muted);">Explanation: ${q.explanation}</div>
            <button class="export-btn" onclick='addQuizQuestion(${JSON.stringify(q).replace(/'/g, "&#39;")})' style="margin-top:8px; padding:4px 12px; font-size:11px;">‚ûï Add to Quiz</button>
        </div>
    `).join('');
}

function addQuizQuestion(q) {
    allQuizQuestions.push(q);
    localStorage.setItem('apex_customQuizQuestions', JSON.stringify(allQuizQuestions.slice(15))); // Save custom ones
    alert('Question added to quiz!');
}

// Load custom quiz questions on startup
const customQuizQuestions = JSON.parse(localStorage.getItem('apex_customQuizQuestions')) || [];
allQuizQuestions.push(...customQuizQuestions);

function loadKnowledgeList() {
    const list = document.getElementById('knowledgeList');
    if (!list) return;
    
    list.innerHTML = window.aiKnowledge.length ? aiKnowledge.slice().reverse().map((k, i) => `
        <div style="background:rgba(0,0,0,0.2); padding:12px; border-radius:8px; margin-bottom:8px;">
            <div style="display:flex; justify-content:space-between; align-items:start;">
                <div style="flex:1;">
                    <strong style="color:var(--orange);">${k.topic}</strong>
                    <div style="color:var(--text); margin-top:4px; font-size:13px;">${k.content}</div>
                    <div style="font-size:11px; color:var(--text-muted); margin-top:4px;">Source: ${k.source} | ${k.addedAt}</div>
                </div>
                <button class="clear-btn" onclick="deleteKnowledge(${window.aiKnowledge.length - 1 - i})" style="padding:4px 8px; font-size:11px;">üóëÔ∏è</button>
            </div>
        </div>
    `).join('') : '<p style="color:var(--text-muted);">No knowledge items yet. Add videos or manual entries above.</p>';
}

function deleteKnowledge(index) {
    if (confirm('Delete this knowledge item?')) {
        aiKnowledge.splice(index, 1);
        saveAIData();
        loadKnowledgeList();
        updateAIStats();
    }
}

function updateAIStats() {
    const learnedEl = document.getElementById('learnedVideos');
    const knowledgeEl = document.getElementById('knowledgeItems');
    if (learnedEl) learnedEl.textContent = learnedVideos.length;
    if (knowledgeEl) knowledgeEl.textContent = window.aiKnowledge.length;
}

function exportKnowledge() {
    const data = JSON.stringify({ knowledge: aiKnowledge, videos: learnedVideos }, null, 2);
    const blob = new Blob([data], { type: 'application/json' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'apex_ai_knowledge.json';
    a.click();
}

function clearKnowledge() {
    if (confirm('Clear ALL AI knowledge? This cannot be undone!')) {
        aiKnowledge = [];
        learnedVideos = [];
        saveAIData();
        loadKnowledgeList();
        updateAIStats();
    }
}

// ============================================
// "WRONG" COMMAND DETECTION
// ============================================
let lastChatQuestion = '';
let lastChatResponse = '';

// Override addMessage to track responses
const origAddMessage = window.addMessage;
window.addMessage = function(content, isUser = false, showFeedback = false) {
    if (isUser) {
        lastChatQuestion = content;
        
        // Check for "WRONG" command
        if (content.toUpperCase().trim() === 'WRONG') {
            handleWrongCommand();
            return;
        }
    } else {
        lastChatResponse = content;
    }
    origAddMessage(content, isUser, showFeedback);
};

async function handleWrongCommand() {
    const password = prompt('üîê Admin Password Required:');
    
    if (password !== 'admin123') {
        window.addMessage('‚ùå Invalid admin password.', false);
        return;
    }
    
    if (!lastChatQuestion || lastChatQuestion.toUpperCase() === 'WRONG') {
        window.addMessage('‚ùå No previous question to correct. Ask a question first, then say "WRONG" if the answer is incorrect.', false);
        return;
    }
    
    origAddMessage('WRONG', true);
    origAddMessage(`üîß **Admin Correction Mode**\n\nPrevious question: "${lastChatQuestion}"\n\nPlease type the correct answer:`, false);
    
    // Set flag for correction mode
    window.correctionMode = {
        question: lastChatQuestion,
        oldResponse: lastChatResponse
    };
}

// Handle correction submission
const originalHandleSend = window.handleSend;
window.handleSend = function() {
    if (window.correctionMode) {
        const input = document.getElementById('inputField');
        const correctAnswer = input.value.trim();
        if (!correctAnswer) return;
        
        input.value = '';
        
        // Add to knowledge base
        aiKnowledge.push({
            topic: window.correctionMode.question,
            content: correctAnswer,
            source: 'Admin Correction',
            addedAt: new Date().toLocaleString(),
            correctedFrom: window.correctionMode.oldResponse
        });
        saveAIData();
        
        // Also add to Q&A knowledge base with SIMPLE keyword matching
        const newKey = 'correction_' + Date.now();
        // Use ALL words 2+ chars as keywords for better matching
        const keywords = window.correctionMode.question.toLowerCase()
            .replace(/[?!.,]/g, '')
            .split(' ')
            .filter(w => w.length >= 2);
        
        window.knowledgeBase[newKey] = {
            keywords: keywords,
            response: correctAnswer,
            exactQuestion: window.correctionMode.question.toLowerCase()
        };
        
        console.log('Correction saved with keywords:', keywords);
        
        origAddMessage(correctAnswer, true);
        origAddMessage(`‚úÖ **Correction Saved!**\n\nThe AI will now use this answer for similar questions.\n\nüîç Scanning platform for related updates...`, false);
        
        // Scan and update related content
        scanAndUpdate(window.correctionMode.question, correctAnswer);
        
        window.correctionMode = null;
        loadKnowledgeList();
        updateAIStats();
        return;
    }
    
    // Call original or do it directly if original fails
    if (typeof originalHandleSend === 'function') {
        try {
            originalHandleSend();
        } catch(e) {
            console.error('originalHandleSend failed:', e);
            // Fallback - do it directly
            directHandleSend();
        }
    } else {
        directHandleSend();
    }
};

// Direct fallback for handleSend
function directHandleSend() {
    const input = document.getElementById('inputField');
    const query = input.value.trim();
    if (!query) return;
    
    window.addMessage(query, true);
    input.value = '';
    
    setTimeout(() => {
        try {
            let response = null;
            const queryLower = query.toLowerCase().replace(/[?!.,]/g, '');
            const queryWords = queryLower.split(' ').filter(w => w.length >= 2);
            
            // FIRST check aiKnowledge (admin corrections) - these take priority
            if (window.aiKnowledge && window.aiKnowledge.length > 0) {
                console.log('Checking aiKnowledge:', window.aiKnowledge.length, 'items');
                for (const k of window.aiKnowledge) {
                    if (k.topic && k.content) {
                        const topicLower = k.topic.toLowerCase().replace(/[?!.,]/g, '');
                        // Check if query contains most of the topic words
                        const topicWords = topicLower.split(' ').filter(w => w.length >= 2);
                        const matches = topicWords.filter(w => queryLower.includes(w));
                        console.log('Topic:', k.topic, '| Matches:', matches.length, '/', topicWords.length);
                        // Match if 50%+ of topic words are in query, or query contains topic
                        if (matches.length >= Math.ceil(topicWords.length * 0.5) || queryLower.includes(topicLower)) {
                            response = k.content;
                            console.log('‚úÖ MATCHED aiKnowledge:', k.topic);
                            break;
                        }
                    }
                }
            }
            
            // THEN check knowledgeBase corrections (from this session)
            if (!response) {
                for (const [key, item] of Object.entries(window.knowledgeBase || {})) {
                    // Check exact question match first
                    if (item.exactQuestion && queryLower.includes(item.exactQuestion.replace(/[?!.,]/g, ''))) {
                        response = item.response;
                        console.log('Matched exact question:', key);
                        break;
                    }
                    // Then check keyword matches - need 2+ keyword matches for corrections
                    if (key.startsWith('correction_') && item.keywords) {
                        const matches = item.keywords.filter(kw => queryLower.includes(kw));
                        if (matches.length >= 2) {
                            response = item.response;
                            console.log('Matched correction keywords:', matches);
                            break;
                        }
                    }
                }
            }
            
            // THEN check default knowledgeBase
            if (!response) {
                for (const [key, item] of Object.entries(window.knowledgeBase || {})) {
                    if (!key.startsWith('correction_')) {
                        for (const keyword of (item.keywords || [])) {
                            if (queryLower.includes(keyword)) {
                                response = item.response;
                                break;
                            }
                        }
                    }
                    if (response) break;
                }
            }
            
            if (!response) {
                response = 'I can help you learn about APEX! Ask about:\n‚Ä¢ What is APEX?\n‚Ä¢ The injury epidemic\n‚Ä¢ Becoming an evaluator\n‚Ä¢ How much you can earn\n‚Ä¢ The BASE assessment';
            }
            
            window.addMessage(response, false, true);
        } catch(e) {
            console.error('directHandleSend error:', e);
            window.addMessage('Sorry, there was an error. Please try again.', false);
        }
    }, 300);
}

async function scanAndUpdate(question, correctAnswer) {
    // Extract potential names or key terms
    const terms = correctAnswer.split(/\s+/).filter(w => w.length > 3 && /^[A-Z]/.test(w));
    
    if (terms.length > 0) {
        setTimeout(() => {
            origAddMessage(`üîÑ Scanned platform content. Updated references to: ${terms.join(', ')}`, false);
            logActivity('Admin Correction', `Q: ${question} | A: ${correctAnswer}`);
        }, 1500);
    }
    
    // Check if it's about a director name
    const questionLower = question.toLowerCase();
    if (questionLower.includes('name') || questionLower.includes('who') || questionLower.includes('dr.') || questionLower.includes('doctor')) {
        // Try to find and update director
        const nameMatch = correctAnswer.match(/([A-Z][a-z]+\s+[A-Z][a-z]+)/);
        if (nameMatch) {
            const fullName = nameMatch[1];
            // Check directors list
            data.directors = data.directors.map(d => {
                const dirName = typeof d === 'object' ? d.name : d;
                // If partial match, update
                if (questionLower.includes(dirName.toLowerCase().split(' ')[0])) {
                    if (typeof d === 'object') {
                        d.name = fullName;
                    } else {
                        return { name: fullName, title: 'Director', photo: '' };
                    }
                }
                return d;
            });
            saveData('directors');
            loadDirectors();
            loadAdminDirectors();
        }
    }
}

// Enhanced findBestResponse to use AI knowledge
const originalFindBestResponse = window.findBestResponse;
window.findBestResponse = function(query) {
    try {
        // First check AI knowledge base
        const queryLower = query.toLowerCase();
        
        if (aiKnowledge && window.aiKnowledge.length > 0) {
            for (const k of aiKnowledge) {
                const topicWords = k.topic.toLowerCase().split(' ');
                const matches = topicWords.filter(w => queryLower.includes(w) && w.length > 3);
                if (matches.length >= 2 || queryLower.includes(k.topic.toLowerCase())) {
                    return `**${k.topic}**\n\n${k.content}`;
                }
            }
        }
        
        // Fall back to original knowledge base
        return originalFindBestResponse(query);
    } catch (e) {
        console.error('findBestResponse error:', e);
        return originalFindBestResponse(query);
    }
};

// Initialize AI stats on load
document.addEventListener('DOMContentLoaded', function() {
    updateAIStats();
    loadKnowledgeList();
    loadSavedAdminPassword();
});

console.log('‚úÖ APEX Admin Enhanced - All modules loaded');
console.log('üß† AI Learning System Active');

// ============================================
// EVENT SHOWCASE SYSTEM
// ============================================
let eventSettings = JSON.parse(localStorage.getItem('apex_eventSettings')) || {
    enabled: true,
    autoGenerate: false,
    frequency: 4,
    imageSource: 'ai',
    lastGenerated: null
};

let eventImages = JSON.parse(localStorage.getItem('apex_eventImages')) || [];
let downloadAttempts = JSON.parse(localStorage.getItem('apex_downloadAttempts')) || [];

const COACH_FIRST_NAMES = ['Michael', 'David', 'James', 'Robert', 'John', 'William', 'Richard', 'Joseph', 'Thomas', 'Christopher', 'Daniel', 'Matthew', 'Anthony', 'Mark', 'Donald', 'Steven', 'Paul', 'Andrew', 'Joshua', 'Kenneth', 'Kevin', 'Brian', 'George', 'Timothy', 'Ronald', 'Edward', 'Jason', 'Jeffrey', 'Ryan', 'Jacob', 'Maria', 'Jennifer', 'Patricia', 'Linda', 'Barbara', 'Elizabeth', 'Susan', 'Jessica', 'Sarah', 'Karen', 'Lisa', 'Nancy', 'Betty', 'Margaret', 'Sandra', 'Ashley', 'Kimberly', 'Emily', 'Donna', 'Michelle'];
const COACH_LAST_NAMES = ['Smith', 'Johnson', 'Williams', 'Brown', 'Jones', 'Garcia', 'Miller', 'Davis', 'Rodriguez', 'Martinez', 'Hernandez', 'Lopez', 'Gonzalez', 'Wilson', 'Anderson', 'Thomas', 'Taylor', 'Moore', 'Jackson', 'Martin', 'Lee', 'Perez', 'Thompson', 'White', 'Harris', 'Sanchez', 'Clark', 'Ramirez', 'Lewis', 'Robinson', 'Walker', 'Young', 'Allen', 'King', 'Wright', 'Scott', 'Torres', 'Nguyen', 'Hill', 'Flores'];
const PRICE_OPTIONS = [79, 89, 99, 109, 119, 129, 139, 149, 159, 169, 179, 189, 199];

function saveEventSettings() {
    eventSettings.frequency = parseInt(document.getElementById('eventFrequency')?.value || 4);
    const sourceRadios = document.querySelectorAll('input[name="imageSource"]');
    sourceRadios.forEach(r => { if (r.checked) eventSettings.imageSource = r.value; });
    localStorage.setItem('apex_eventSettings', JSON.stringify(eventSettings));
}

function saveEventImages() {
    localStorage.setItem('apex_eventImages', JSON.stringify(eventImages));
}

function toggleEventShowcase() {
    eventSettings.enabled = document.getElementById('eventShowcaseEnabled').checked;
    localStorage.setItem('apex_eventSettings', JSON.stringify(eventSettings));
    document.getElementById('eventShowcase').style.display = eventSettings.enabled ? 'block' : 'none';
}

function toggleEventAutoGenerate() {
    eventSettings.autoGenerate = document.getElementById('eventAutoGenerate').checked;
    localStorage.setItem('apex_eventSettings', JSON.stringify(eventSettings));
}

function getRandomCoachName() {
    const first = COACH_FIRST_NAMES[Math.floor(Math.random() * COACH_FIRST_NAMES.length)];
    const last = COACH_LAST_NAMES[Math.floor(Math.random() * COACH_LAST_NAMES.length)];
    return `Coach ${first} ${last}`;
}

function getRandomPrice() {
    return PRICE_OPTIONS[Math.floor(Math.random() * PRICE_OPTIONS.length)];
}

function getLastWeekendDate() {
    const today = new Date();
    const dayOfWeek = today.getDay();
    let daysToSubtract;
    
    if (dayOfWeek === 0) { // Sunday
        daysToSubtract = 0;
    } else if (dayOfWeek === 6) { // Saturday
        daysToSubtract = 0;
    } else {
        // Go back to last Sunday or Saturday (randomly pick)
        daysToSubtract = Math.random() > 0.5 ? dayOfWeek : dayOfWeek + 1;
    }
    
    const eventDate = new Date(today);
    eventDate.setDate(today.getDate() - daysToSubtract);
    return eventDate;
}

function formatEventDate(date) {
    const d = new Date(date);
    const options = { weekday: 'long', month: 'short', day: 'numeric', year: 'numeric' };
    return d.toLocaleDateString('en-US', options);
}

function calculateRevenue(athleteCount) {
    const price = getRandomPrice();
    return { price, total: athleteCount * price };
}

// Generate AI Event Image
async function generateAIEventImage() {
    const sport = document.getElementById('aiEventSport')?.value || 'baseball';
    const athleteCount = parseInt(document.getElementById('aiAthleteCount')?.value || 12);
    
    const btn = event.target;
    btn.disabled = true;
    btn.textContent = '‚è≥ Generating...';
    
    try {
        const sportDescriptions = {
            baseball: 'youth baseball training camp with players in batting practice, wearing generic navy blue and orange athletic uniforms',
            basketball: 'youth basketball skills clinic with players practicing drills, wearing generic navy blue and orange athletic uniforms',
            football: 'youth football training camp with players in conditioning exercises, wearing generic navy blue and orange athletic uniforms',
            soccer: 'youth soccer training session with players practicing skills, wearing generic navy blue and orange athletic uniforms',
            volleyball: 'youth volleyball clinic with players learning techniques, wearing generic navy blue and orange athletic uniforms',
            general: 'youth multi-sport athletic training camp with diverse activities, wearing generic navy blue and orange athletic uniforms'
        };
        
        const prompt = `Professional photograph of a ${sportDescriptions[sport]}. Group of ${athleteCount} teenage athletes ages 13-18, diverse ethnicities, training outdoors at a sports facility. Clean modern athletic wear with NO visible logos or team names. Bright natural lighting, action shot, high energy positive atmosphere, professional sports photography style. NO text, NO watermarks, NO logos on clothing.`;
        
        const result = await callOpenAI('image', {
            model: 'dall-e-3',
            prompt: prompt,
            n: 1,
            size: '1792x1024',
            quality: 'standard',
            response_format: 'b64_json'
        });
        
        if (result.error) {
            throw new Error(result.error.message);
        }
        
        const base64Image = result.data[0].b64_json;
        const imageDataUrl = `data:image/png;base64,${base64Image}`;
        
        // Create event entry
        const eventDate = getLastWeekendDate();
        const { price, total } = calculateRevenue(athleteCount);
        
        const newEvent = {
            id: Date.now(),
            type: 'ai',
            image: imageDataUrl,
            coachName: getRandomCoachName(),
            date: eventDate.toISOString(),
            athleteCount: athleteCount,
            pricePerAthlete: price,
            totalRevenue: total,
            sport: sport,
            createdAt: new Date().toISOString()
        };
        
        eventImages.unshift(newEvent);
        saveEventImages();
        loadEventGallery();
        displayCurrentEvent();
        
        alert('‚úÖ AI Event Image generated successfully!');
        
    } catch (error) {
        console.error('AI Event Image error:', error);
        alert('Error generating image: ' + error.message);
    }
    
    btn.disabled = false;
    btn.textContent = 'üé® Generate AI Event Image';
}

// Upload custom event image
function uploadEventImage() {
    const coachName = document.getElementById('uploadCoachName').value.trim();
    const eventDate = document.getElementById('uploadEventDate').value;
    const athleteCount = parseInt(document.getElementById('uploadAthleteCount').value);
    
    if (!coachName || !eventDate || !athleteCount) {
        alert('Please fill in Coach Name, Event Date, and # of Athletes');
        return;
    }
    
    document.getElementById('eventImageUpload').click();
}

function handleEventImageUpload(e) {
    const file = e.target.files[0];
    if (!file) return;
    
    const coachName = document.getElementById('uploadCoachName').value.trim();
    const eventDate = document.getElementById('uploadEventDate').value;
    const athleteCount = parseInt(document.getElementById('uploadAthleteCount').value);
    const location = document.getElementById('uploadEventLocation').value.trim();
    
    const reader = new FileReader();
    reader.onload = function(event) {
        const img = new Image();
        img.onload = function() {
            // Resize to reasonable size
            const canvas = document.createElement('canvas');
            const maxWidth = 1200;
            const maxHeight = 800;
            let width = img.width;
            let height = img.height;
            
            if (width > maxWidth) {
                height = (maxWidth / width) * height;
                width = maxWidth;
            }
            if (height > maxHeight) {
                width = (maxHeight / height) * width;
                height = maxHeight;
            }
            
            canvas.width = width;
            canvas.height = height;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, width, height);
            
            const imageDataUrl = canvas.toDataURL('image/jpeg', 0.85);
            const { price, total } = calculateRevenue(athleteCount);
            
            const newEvent = {
                id: Date.now(),
                type: 'uploaded',
                image: imageDataUrl,
                coachName: coachName.startsWith('Coach') ? coachName : 'Coach ' + coachName,
                date: new Date(eventDate).toISOString(),
                athleteCount: athleteCount,
                pricePerAthlete: price,
                totalRevenue: total,
                location: location,
                createdAt: new Date().toISOString()
            };
            
            eventImages.unshift(newEvent);
            saveEventImages();
            loadEventGallery();
            displayCurrentEvent();
            
            // Clear form
            document.getElementById('uploadCoachName').value = '';
            document.getElementById('uploadEventDate').value = '';
            document.getElementById('uploadAthleteCount').value = '';
            document.getElementById('uploadEventLocation').value = '';
            
            alert('‚úÖ Event image uploaded successfully!');
        };
        img.src = event.target.result;
    };
    reader.readAsDataURL(file);
    
    // Reset file input
    e.target.value = '';
}

// Display current event on main page
function displayCurrentEvent() {
    const showcase = document.getElementById('eventShowcase');
    if (!showcase) return;
    
    // Only show if enabled and has uploaded images
    if (!eventSettings.enabled || eventImages.length === 0) {
        showcase.style.display = 'none';
        return;
    }
    
    // Pick random image from available
    const event = eventImages[Math.floor(Math.random() * eventImages.length)];
    
    showcase.style.display = 'block';
    document.getElementById('eventImage').src = event.image;
    document.getElementById('eventDate').textContent = formatEventDate(event.date);
    document.getElementById('eventCoach').textContent = event.coachName;
    document.getElementById('eventKids').textContent = event.athleteCount;
    document.getElementById('eventRevenue').textContent = '$' + event.totalRevenue.toLocaleString();
}

// Load event gallery in admin
function loadEventGallery() {
    const gallery = document.getElementById('eventImageGallery');
    const countEl = document.getElementById('eventImageCount');
    
    if (!gallery) return;
    
    countEl.textContent = eventImages.length;
    
    gallery.innerHTML = eventImages.map((e, i) => `
        <div style="background:var(--card-bg); border:1px solid var(--border); border-radius:8px; overflow:hidden;">
            <img src="${e.image}" style="width:100%; height:120px; object-fit:cover;">
            <div style="padding:10px;">
                <div style="font-weight:600; font-size:12px; color:var(--text);">${e.coachName}</div>
                <div style="font-size:11px; color:var(--text-muted);">${formatEventDate(e.date)}</div>
                <div style="font-size:11px; color:var(--green);">${e.athleteCount} athletes √ó $${e.pricePerAthlete} = <strong>$${e.totalRevenue}</strong></div>
                <div style="display:flex; gap:4px; margin-top:8px;">
                    <span style="font-size:9px; padding:2px 6px; border-radius:4px; background:${e.type === 'ai' ? 'var(--purple)' : 'var(--green)'}; color:white;">${e.type === 'ai' ? 'ü§ñ AI' : 'üìÅ Uploaded'}</span>
                    <button onclick="deleteEventImage(${i})" style="font-size:10px; padding:2px 6px; background:#ef4444; color:white; border:none; border-radius:4px; cursor:pointer;">üóëÔ∏è</button>
                </div>
            </div>
        </div>
    `).join('') || '<p style="color:var(--text-muted);">No event images yet. Generate or upload one above.</p>';
}

function deleteEventImage(index) {
    if (confirm('Delete this event image?')) {
        eventImages.splice(index, 1);
        saveEventImages();
        loadEventGallery();
        displayCurrentEvent();
    }
}

// Track download attempts
function trackDownloadAttempt() {
    const attempt = {
        time: new Date().toLocaleString(),
        ip: userIP,
        email: currentUserEmail || 'Unknown',
        location: userLocation.city ? `${userLocation.city}, ${userLocation.region}` : 'Unknown',
        userAgent: navigator.userAgent
    };
    
    downloadAttempts.push(attempt);
    localStorage.setItem('apex_downloadAttempts', JSON.stringify(downloadAttempts));
    
    logActivity('Download Attempt', 'Tried to download event image', { blocked: true });
    
    loadDownloadAttempts();
    
    alert('‚ö†Ô∏è Image downloads are disabled.\n\nFor official event photos, please contact Area Scouts.');
}

function loadDownloadAttempts() {
    const countEl = document.getElementById('downloadAttemptCount');
    const logEl = document.getElementById('downloadAttemptLog');
    
    if (!countEl || !logEl) return;
    
    countEl.textContent = downloadAttempts.length;
    
    logEl.innerHTML = downloadAttempts.slice(-20).reverse().map(a => `
        <div style="padding:4px 0; border-bottom:1px solid var(--border);">
            <span style="color:#ef4444;">${a.time}</span> | ${a.ip} | ${a.email} | ${a.location}
        </div>
    `).join('') || '<p>No download attempts tracked</p>';
}

// Load event settings in admin
function loadEventSettings() {
    const enabledEl = document.getElementById('eventShowcaseEnabled');
    const autoGenEl = document.getElementById('eventAutoGenerate');
    const freqEl = document.getElementById('eventFrequency');
    
    if (enabledEl) enabledEl.checked = eventSettings.enabled;
    if (autoGenEl) autoGenEl.checked = eventSettings.autoGenerate;
    if (freqEl) freqEl.value = eventSettings.frequency;
    
    const sourceRadios = document.querySelectorAll('input[name="imageSource"]');
    sourceRadios.forEach(r => {
        r.checked = r.value === eventSettings.imageSource;
    });
    
    loadEventGallery();
    loadDownloadAttempts();
}

// Auto-rotate event images periodically
setInterval(() => {
    displayCurrentEvent();
}, 30000); // Rotate every 30 seconds

// Initialize event showcase on page load
document.addEventListener('DOMContentLoaded', function() {
    displayCurrentEvent();
    loadEventSettings();
});
</script>

<!-- Window Manager Floating Buttons -->
<div class="window-manager" id="windowManager">
    <div class="window-btn-group" id="winBtn-main" style="display:none;">
        <button class="window-btn window-btn-main" onclick="showScreen('main')">üè† Main Page</button>
    </div>
    <div class="window-btn-group" id="winBtn-admin" style="display:none;">
        <button class="window-btn window-btn-admin" onclick="showScreen('admin')">‚öôÔ∏è Admin Panel</button>
        <button class="window-btn window-btn-close" onclick="closeScreen('admin')">‚úï</button>
    </div>
    <div class="window-btn-group" id="winBtn-edit" style="display:none;">
        <button class="window-btn window-btn-edit" onclick="showScreen('edit')">‚úèÔ∏è Edit Director</button>
        <button class="window-btn window-btn-close" onclick="closeScreen('edit')">‚úï</button>
    </div>
</div>

<!-- Edit Director Screen Panel -->
<div class="screen-panel" id="editDirectorScreen">
    <div class="screen-header">
        <span class="screen-title">‚úèÔ∏è Edit Director</span>
        <button class="screen-close-btn" onclick="closeScreen('edit')">‚úï Close</button>
    </div>
    <div class="screen-panel-content">
        <div style="max-width: 600px; margin: 40px auto; background: var(--card-bg); border: 1px solid var(--border); border-radius: 16px; padding: 30px;">
            <div style="display: grid; grid-template-columns: 180px 1fr; gap: 30px; align-items: start;">
                <!-- Photo Section -->
                <div style="text-align: center;">
                    <img id="editScreenPhoto" src="" style="width: 180px; height: 180px; border-radius: 12px; object-fit: cover; border: 3px solid var(--orange); margin-bottom: 16px;">
                    <input type="file" id="editScreenPhotoInput" accept="image/*" style="display: none;" onchange="handleScreenPhotoUpload(event)">
                    <button class="export-btn" onclick="document.getElementById('editScreenPhotoInput').click()" style="width: 100%; margin-bottom: 10px; padding: 12px;">üì§ Upload Photo</button>
                    <button class="export-btn" onclick="searchScreenDirectorPhoto()" style="width: 100%; background: var(--purple); padding: 12px;">üîç Google Search</button>
                    <p style="font-size: 11px; color: var(--text-muted); margin-top: 10px;">Find photo on Google, download it, then upload here</p>
                </div>
                
                <!-- Info Section -->
                <div>
                    <div class="form-group" style="margin-bottom: 20px;">
                        <label style="font-size: 14px; font-weight: 600; margin-bottom: 8px; display: block;">Full Name *</label>
                        <input type="text" id="editScreenName" placeholder="Dr. John Smith" style="width: 100%; padding: 14px; border-radius: 8px; background: var(--dark-bg); color: var(--text); border: 1px solid var(--border); font-size: 16px;">
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 20px;">
                        <label style="font-size: 14px; font-weight: 600; margin-bottom: 8px; display: block;">Title / Bio *</label>
                        <textarea id="editScreenTitle" rows="4" placeholder="Former MLB Pitcher, 12-Year Veteran" style="width: 100%; padding: 14px; border-radius: 8px; background: var(--dark-bg); color: var(--text); border: 1px solid var(--border); resize: vertical; font-size: 16px; font-family: 'Outfit', sans-serif;"></textarea>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-bottom: 24px;">
                        <button class="export-btn" onclick="searchScreenDirectorBio()" style="flex: 1; background: var(--green); padding: 12px;">üîç Search Google for Bio</button>
                        <button class="export-btn" onclick="generateScreenTitleAI()" style="flex: 1; background: var(--purple); padding: 12px;">ü§ñ AI Generate Title</button>
                    </div>
                    
                    <input type="hidden" id="editScreenIndex">
                    
                    <div style="display: flex; gap: 12px; padding-top: 20px; border-top: 1px solid var(--border);">
                        <button class="export-btn" onclick="saveScreenDirectorEdit()" style="flex: 1; padding: 16px; font-size: 18px; background: var(--green);">üíæ Save Changes</button>
                        <button class="clear-btn" onclick="closeScreen('edit')" style="padding: 16px 24px; font-size: 16px;">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- EPIC SPORTS PRIZE WHEEL MODAL -->
<div id="prizeWheelModal" class="prize-wheel-overlay">
    <div class="prize-wheel-container">
        <!-- Close button -->
        <button class="prize-wheel-close" id="prizeWheelCloseBtn" type="button">&times;</button>
        
        <!-- Header -->
        <div class="prize-wheel-header">
            <div class="prize-wheel-logo">üèÜ</div>
            <h1 class="prize-wheel-title">YOU'RE ALMOST IN!</h1>
            <p class="prize-wheel-subtitle">Enter your email to unlock exclusive content</p>
        </div>
        
        <!-- Email Entry Section (shown first) -->
        <div class="email-entry-section" id="emailEntrySection">
            <div class="email-entry-box">
                <p class="email-entry-text">üìß Enter your info below to get started:</p>
                <div class="input-wrapper" style="margin: 15px 0;">
                    <input type="email" id="prizeWheelEmail" placeholder="Enter your email address" class="prize-wheel-input" style="padding: 16px 20px; text-align: center;">
                </div>
                <div class="input-wrapper" style="margin: 15px 0;">
                    <input type="tel" id="prizeWheelPhone" placeholder="Phone number (for SMS confirmation)" class="prize-wheel-input" style="padding: 16px 20px; text-align: center;">
                </div>
                <button class="submit-email-button" id="prizeWheelSubmitBtn" type="button">
                    <span>‚úì SUBMIT & CONTINUE</span>
                </button>
                <p class="prize-wheel-disclaimer">üîí No spam, ever. Unsubscribe anytime.</p>
                
                <div class="bonus-teaser">
                    <p class="teaser-text">üéÅ <strong>BONUS:</strong> After submitting, you'll get a chance to <span style="color:#FFD700;">SPIN TO WIN</span> amazing prizes!</p>
                </div>
            </div>
        </div>
        
        <!-- Wheel Section (hidden until email submitted) -->
        <div class="wheel-reveal-section" id="wheelRevealSection" style="display: none;">
            <div class="congrats-message">
                <p>‚úÖ <strong>Email confirmed!</strong> Now spin the wheel for a bonus prize!</p>
                <p class="check-email-reminder">üì¨ Check your email for exclusive content + see if you won a <span style="color:#FFD700;">BONUS PRIZE!</span></p>
            </div>
            
            <!-- Wheel Container -->
            <div class="wheel-section">
                <div class="wheel-pointer">‚ñº</div>
                <div class="wheel-wrapper">
                    <canvas id="prizeWheelCanvas" width="340" height="340"></canvas>
                    <div class="wheel-center">
                        <div class="wheel-center-inner">SPIN</div>
                    </div>
                </div>
                <div class="wheel-lights"></div>
            </div>
            
            <!-- Spin Button -->
            <div class="prize-wheel-form" id="prizeWheelForm">
                <button class="spin-button" id="spinWheelBtn" type="button">
                    <span class="spin-button-text">üé∞ SPIN THE WHEEL!</span>
                    <div class="spin-button-shine"></div>
                </button>
            </div>
        </div>
        
        <!-- Result Display (hidden initially) -->
        <div class="prize-result" id="prizeResult" style="display: none;">
            <div class="prize-result-icon" id="prizeResultIcon">üéâ</div>
            <h2 class="prize-result-title" id="prizeResultTitle">CONGRATULATIONS!</h2>
            <p class="prize-result-text" id="prizeResultText">You won a prize!</p>
            <div id="prizeGuideInfo"></div>
            <p class="check-email-final">üì¨ <strong>Check your email</strong> to claim your prize and see if you won a bonus!</p>
            <button class="claim-button" id="claimPrizeBtn" type="button">CONTINUE</button>
        </div>
        
        <!-- Stats -->
        <div class="prize-wheel-stats">
            <div class="stat-item">
                <span class="stat-number" id="spinCount">12,847</span>
                <span class="stat-label">Total Spins</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="winnerCount">2,847</span>
                <span class="stat-label">Winners</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" style="color:#FFD700;">$25</span>
                <span class="stat-label">Grand Prize</span>
            </div>
        </div>
        
        <!-- Floating sports elements -->
        <div class="floating-sports">
            <span class="float-item float-1">‚öæ</span>
            <span class="float-item float-2">üèà</span>
            <span class="float-item float-3">üèÄ</span>
            <span class="float-item float-4">‚öΩ</span>
            <span class="float-item float-5">üéæ</span>
            <span class="float-item float-6">üèí</span>
        </div>
    </div>
</div>

<!-- CRITICAL: Inline script to make prize wheel buttons work -->
<script>
(function() {
    // Close button handler
    var closeBtn = document.getElementById('prizeWheelCloseBtn');
    if (closeBtn) {
        closeBtn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            // Call the main closePrizeWheel if available, otherwise do it manually
            if (typeof window.closePrizeWheel === 'function') {
                window.closePrizeWheel();
            } else {
                var modal = document.getElementById('prizeWheelModal');
                if (modal) {
                    modal.classList.remove('active');
                    modal.style.display = 'none';
                    modal.style.pointerEvents = 'none';
                }
                // Reset pending actions
                window.pendingAction = null;
                window.pendingActionType = null;
                window.pendingMode = null;
            }
            console.log('Prize wheel closed via inline handler');
        });
    }
    
    // Submit button handler - FULLY INLINE, no external dependencies
    var submitBtn = document.getElementById('prizeWheelSubmitBtn');
    if (submitBtn) {
        submitBtn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('Submit button clicked');
            
            var emailInput = document.getElementById('prizeWheelEmail');
            var email = emailInput ? emailInput.value.trim() : '';
            
            console.log('Email value:', email);
            
            if (!email || email.indexOf('@') === -1 || email.indexOf('.') === -1) {
                if (emailInput) {
                    emailInput.style.borderColor = '#dc3545';
                    emailInput.style.boxShadow = '0 0 10px rgba(220,53,69,0.5)';
                    setTimeout(function() {
                        emailInput.style.borderColor = 'rgba(255,255,255,0.3)';
                        emailInput.style.boxShadow = 'none';
                    }, 1000);
                }
                alert('Please enter a valid email address');
                return;
            }
            
            // Store email globally
            window.currentUserPrizeEmail = email;
            window.currentUserEmail = email;
            
            console.log('Email stored, switching to wheel section');
            
            // Hide email section, show wheel section
            var emailSection = document.getElementById('emailEntrySection');
            var wheelSection = document.getElementById('wheelRevealSection');
            
            if (emailSection) {
                emailSection.style.display = 'none';
                console.log('Email section hidden');
            }
            if (wheelSection) {
                wheelSection.style.display = 'block';
                console.log('Wheel section shown');
            }
            
            // Initialize the wheel canvas after a short delay to ensure DOM is ready
            setTimeout(function() {
                if (typeof window.initPrizeWheel === 'function') {
                    window.initPrizeWheel();
                    console.log('Wheel initialized');
                } else {
                    console.log('initPrizeWheel not found, will try again');
                    // Try again after more time
                    setTimeout(function() {
                        if (typeof window.initPrizeWheel === 'function') {
                            window.initPrizeWheel();
                            console.log('Wheel initialized on retry');
                        }
                    }, 500);
                }
            }, 100);
            
            // Try to capture email if function exists
            if (typeof window.captureUserEmail === 'function') {
                window.captureUserEmail(email);
            }
            
            console.log('Email submitted successfully:', email);
        });
    } else {
        console.log('Submit button not found!');
    }
    
    // Also close when clicking the overlay background
    var modal = document.getElementById('prizeWheelModal');
    if (modal) {
        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                modal.classList.remove('active');
                modal.style.display = 'none';
                console.log('Prize wheel closed via overlay click');
            }
        });
    }
    
    // Spin button handler
    var spinBtn = document.getElementById('spinWheelBtn');
    if (spinBtn) {
        spinBtn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('Spin button clicked');
            if (typeof window.spinPrizeWheel === 'function') {
                window.spinPrizeWheel();
            } else {
                console.error('spinPrizeWheel function not found');
            }
        });
    }
    
    // Claim prize button handler
    var claimBtn = document.getElementById('claimPrizeBtn');
    if (claimBtn) {
        claimBtn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('Claim button clicked');
            if (typeof window.claimPrize === 'function') {
                window.claimPrize();
            } else {
                // Fallback: save pending action, close modal, then open pending action
                var savedAction = window.pendingAction;
                var savedActionType = window.pendingActionType;
                
                var modal = document.getElementById('prizeWheelModal');
                if (modal) {
                    modal.classList.remove('active');
                    modal.style.display = 'none';
                }
                
                // Handle pending action AFTER closing
                if (savedActionType === 'modal' && savedAction) {
                    if (typeof window.openModal === 'function') {
                        window.openModal(savedAction);
                    }
                }
            }
        });
    }
    
    console.log('Prize wheel inline handlers initialized');
})();
</script>

<style>
/* EPIC PRIZE WHEEL STYLES */
.prize-wheel-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.9);
    z-index: 999999;
    justify-content: center;
    align-items: center;
    backdrop-filter: blur(10px);
    animation: fadeIn 0.3s ease;
    pointer-events: none;
}

.prize-wheel-overlay.active {
    display: flex;
    pointer-events: auto;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.prize-wheel-container {
    position: relative;
    background: linear-gradient(145deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    border-radius: 24px;
    padding: 30px;
    padding-bottom: 40px;
    max-width: 420px;
    width: 95%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 
        0 0 60px rgba(237, 112, 35, 0.3),
        0 0 100px rgba(55, 201, 56, 0.2),
        inset 0 1px 0 rgba(255,255,255,0.1);
    border: 2px solid rgba(237, 112, 35, 0.5);
    animation: slideUp 0.4s ease;
}

@keyframes slideUp {
    from { transform: translateY(50px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

.prize-wheel-close {
    position: absolute;
    top: 15px;
    right: 15px;
    background: rgba(255,255,255,0.2);
    border: 2px solid rgba(255,255,255,0.3);
    color: #fff;
    font-size: 28px;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    cursor: pointer;
    transition: all 0.3s;
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: center;
    line-height: 1;
}

.prize-wheel-close:hover {
    background: #dc3545;
    transform: rotate(90deg);
}

.prize-wheel-header {
    text-align: center;
    margin-bottom: 20px;
}

.prize-wheel-logo {
    font-size: 50px;
    animation: bounce 1s ease infinite;
}

@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

.prize-wheel-title {
    font-family: 'Outfit', sans-serif;
    font-size: 32px;
    font-weight: 800;
    background: linear-gradient(90deg, #ed7023, #ffde59, #37c938);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin: 10px 0 5px;
    text-shadow: 0 0 30px rgba(237, 112, 35, 0.5);
    letter-spacing: 2px;
}

.prize-wheel-subtitle {
    color: #94a3b8;
    font-size: 14px;
    margin: 0;
}

/* Wheel Section */
.wheel-section {
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 20px 0;
}

.wheel-wrapper {
    position: relative;
    width: 280px;
    height: 280px;
}

#prizeWheelCanvas {
    width: 280px;
    height: 280px;
    border-radius: 50%;
    box-shadow: 
        0 0 30px rgba(237, 112, 35, 0.5),
        0 0 60px rgba(55, 201, 56, 0.3),
        inset 0 0 50px rgba(0,0,0,0.5);
    border: 4px solid #ed7023;
}

.wheel-pointer {
    position: absolute;
    top: -5px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 36px;
    color: #ffde59;
    z-index: 10;
    filter: drop-shadow(0 0 10px rgba(255, 222, 89, 0.8));
    animation: pointerPulse 0.5s ease infinite;
}

@keyframes pointerPulse {
    0%, 100% { transform: translateX(-50%) scale(1); }
    50% { transform: translateX(-50%) scale(1.1); }
}

.wheel-center {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 70px;
    height: 70px;
    background: linear-gradient(145deg, #ed7023, #ff8c42);
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: 0 4px 15px rgba(0,0,0,0.4);
    border: 3px solid #ffde59;
}

.wheel-center-inner {
    font-family: 'Outfit', sans-serif;
    font-weight: 800;
    font-size: 14px;
    color: white;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

/* Form Styles */
.prize-wheel-form {
    margin-top: 20px;
}

.input-wrapper {
    position: relative;
    margin-bottom: 15px;
}

.input-icon {
    position: absolute;
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 20px;
}

.prize-wheel-input {
    width: 100%;
    padding: 16px 20px;
    font-size: 18px;
    font-family: 'Outfit', sans-serif;
    background: rgba(255,255,255,0.1);
    border: 2px solid rgba(255,255,255,0.3);
    border-radius: 12px;
    color: white;
    outline: none;
    transition: all 0.3s;
    text-align: center;
}

.prize-wheel-input:focus {
    border-color: #ed7023;
    background: rgba(255,255,255,0.15);
    box-shadow: 0 0 20px rgba(237, 112, 35, 0.3);
}

.prize-wheel-input::placeholder {
    color: rgba(255,255,255,0.6);
    text-align: center;
}

.spin-button {
    position: relative;
    width: 100%;
    padding: 18px 30px;
    font-size: 18px;
    font-family: 'Outfit', sans-serif;
    font-weight: 700;
    color: white;
    background: linear-gradient(145deg, #37c938, #2ea82f);
    border: none;
    border-radius: 12px;
    cursor: pointer;
    overflow: hidden;
    transition: all 0.3s;
    text-transform: uppercase;
    letter-spacing: 1px;
    box-shadow: 0 4px 15px rgba(55, 201, 56, 0.4);
}

.spin-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 25px rgba(55, 201, 56, 0.5);
}

.spin-button:active {
    transform: translateY(0);
}

.spin-button-shine {
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    animation: shine 2s ease infinite;
}

@keyframes shine {
    0% { left: -100%; }
    50%, 100% { left: 100%; }
}

.spin-button:disabled {
    background: #666;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

.prize-wheel-disclaimer {
    text-align: center;
    color: #64748b;
    font-size: 12px;
    margin-top: 12px;
}

/* Stats */
.prize-wheel-stats {
    display: flex;
    justify-content: space-around;
    margin-top: 20px;
    padding: 20px 10px 0;
    border-top: 1px solid rgba(255,255,255,0.1);
    flex-wrap: wrap;
    gap: 15px;
    width: 100%;
    box-sizing: border-box;
}

.stat-item {
    text-align: center;
    flex: 1;
    min-width: 80px;
}

.stat-number {
    display: block;
    font-family: 'Space Mono', monospace;
    font-size: 18px;
    font-weight: 700;
    color: #ed7023;
}

.stat-label {
    font-size: 10px;
    color: #64748b;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* Email Entry Section */
.email-entry-section {
    padding: 10px 0;
}

.email-entry-box {
    text-align: center;
}

.email-entry-text {
    color: #fff;
    font-size: 16px;
    margin-bottom: 15px;
}

.submit-email-button {
    width: 100%;
    padding: 16px 32px;
    background: linear-gradient(135deg, #37c938 0%, #2da32e 100%);
    border: none;
    border-radius: 12px;
    color: #fff;
    font-size: 18px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(55, 201, 56, 0.3);
}

.submit-email-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(55, 201, 56, 0.4);
}

.bonus-teaser {
    margin-top: 20px;
    padding: 15px;
    background: linear-gradient(135deg, rgba(255,215,0,0.1), rgba(237,112,35,0.05));
    border-radius: 12px;
    border: 1px dashed rgba(255,215,0,0.4);
}

.teaser-text {
    color: #94a3b8;
    font-size: 14px;
    margin: 0;
}

/* Wheel Reveal Section */
.wheel-reveal-section {
    animation: fadeInUp 0.5s ease;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.congrats-message {
    text-align: center;
    padding: 15px;
    background: linear-gradient(135deg, rgba(55,201,56,0.1), rgba(55,201,56,0.05));
    border-radius: 12px;
    border: 1px solid rgba(55,201,56,0.3);
    margin-bottom: 20px;
}

.congrats-message p {
    color: #fff;
    margin: 5px 0;
    font-size: 14px;
}

.check-email-reminder {
    color: #94a3b8 !important;
    font-size: 13px !important;
}

.check-email-final {
    color: #94a3b8;
    font-size: 13px;
    margin: 15px 0;
    padding: 10px;
    background: rgba(255,255,255,0.05);
    border-radius: 8px;
}

/* Prize Result */
.prize-result {
    text-align: center;
    padding: 20px 0;
}

.prize-result-icon {
    font-size: 60px;
    animation: resultBounce 0.5s ease;
}

@keyframes resultBounce {
    0% { transform: scale(0); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
}

.prize-result-title {
    font-family: 'Outfit', sans-serif;
    font-size: 28px;
    font-weight: 800;
    color: #37c938;
    margin: 10px 0;
}

.prize-result-text {
    font-size: 18px;
    color: #fff;
    margin-bottom: 20px;
}

.claim-button {
    padding: 16px 40px;
    font-size: 16px;
    font-family: 'Outfit', sans-serif;
    font-weight: 700;
    color: white;
    background: linear-gradient(145deg, #ed7023, #ff8c42);
    border: none;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.claim-button:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 25px rgba(237, 112, 35, 0.5);
}

/* Floating Sports Elements */
.floating-sports {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    overflow: hidden;
}

.float-item {
    position: absolute;
    font-size: 24px;
    opacity: 0.3;
    animation: float 6s ease-in-out infinite;
}

.float-1 { top: 10%; left: 5%; animation-delay: 0s; }
.float-2 { top: 20%; right: 5%; animation-delay: 1s; }
.float-3 { top: 50%; left: 3%; animation-delay: 2s; }
.float-4 { top: 60%; right: 8%; animation-delay: 3s; }
.float-5 { bottom: 15%; left: 8%; animation-delay: 4s; }
.float-6 { bottom: 25%; right: 3%; animation-delay: 5s; }

@keyframes float {
    0%, 100% { transform: translateY(0) rotate(0deg); }
    50% { transform: translateY(-20px) rotate(10deg); }
}

/* Confetti Animation */
.confetti {
    position: fixed;
    width: 10px;
    height: 10px;
    top: -10px;
    animation: confettiFall 3s ease-out forwards;
    z-index: 9999999;
}

@keyframes confettiFall {
    0% { transform: translateY(0) rotate(0deg); opacity: 1; }
    100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
}

/* Wheel spinning animation */
.wheel-spinning #prizeWheelCanvas {
    animation: none;
}
</style>

<script>
// ============================================
// EPIC PRIZE WHEEL SYSTEM
// ============================================

// Prize configuration with guide downloads for each prize
const wheelPrizes = [
    { 
        text: 'üèÜ $25 GIFT CARD', 
        color: '#FFD700', 
        weight: 0, // Weight is 0 - controlled by 5000 spin logic
        guide: null,
        isGrandPrize: true
    },
    { 
        text: '‚öæ 10% OFF', 
        color: '#ed7023', 
        weight: 150,
        guide: 'baseball-fundamentals-guide',
        guideTitle: 'Baseball Fundamentals Guide'
    },
    { 
        text: 'üèà FREE GUIDE', 
        color: '#37c938', 
        weight: 200,
        guide: 'injury-prevention-guide',
        guideTitle: 'Injury Prevention Guide'
    },
    { 
        text: 'üèÄ SPIN AGAIN', 
        color: '#8b5cf6', 
        weight: 100,
        guide: null
    },
    { 
        text: '‚öΩ 15% OFF', 
        color: '#16345f', 
        weight: 150,
        guide: 'speed-training-guide',
        guideTitle: 'Speed Training Guide'
    },
    { 
        text: 'üéæ VIP ACCESS', 
        color: '#ec4899', 
        weight: 100,
        guide: 'vip-training-secrets',
        guideTitle: 'VIP Training Secrets'
    },
    { 
        text: 'üèí 20% OFF', 
        color: '#06b6d4', 
        weight: 150,
        guide: 'strength-conditioning-guide',
        guideTitle: 'Strength & Conditioning Guide'
    },
    { 
        text: 'üéØ FREE TRIAL', 
        color: '#f59e0b', 
        weight: 150,
        guide: 'apex-trial-guide',
        guideTitle: 'APEX Trial Guide'
    }
];

// Admin notification email
const ADMIN_EMAIL = 'lance@areascouts.com';

let wheelSpinning = false;
let wheelRotation = 0;
// pendingMode is defined globally as window.pendingMode
let totalSpins = parseInt(localStorage.getItem('apex_totalSpins')) || 12847;
let totalWinners = parseInt(localStorage.getItem('apex_totalWinners')) || 2847;
let currentUserPrizeEmail = '';

function initPrizeWheel() {
    const canvas = document.getElementById('prizeWheelCanvas');
    if (!canvas) return;
    
    const ctx = canvas.getContext('2d');
    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;
    const radius = 160;
    
    // For display purposes, give equal visual segments
    const sliceAngle = (Math.PI * 2) / wheelPrizes.length;
    let currentAngle = -Math.PI / 2; // Start at top
    
    wheelPrizes.forEach((prize, i) => {
        // Draw slice
        ctx.beginPath();
        ctx.moveTo(centerX, centerY);
        ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
        ctx.closePath();
        
        // Gradient fill
        const gradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, radius);
        gradient.addColorStop(0, lightenColor(prize.color, 30));
        gradient.addColorStop(1, prize.color);
        ctx.fillStyle = gradient;
        ctx.fill();
        
        // Border
        ctx.strokeStyle = 'rgba(255,255,255,0.3)';
        ctx.lineWidth = 2;
        ctx.stroke();
        
        // Text - make it more visible
        ctx.save();
        ctx.translate(centerX, centerY);
        ctx.rotate(currentAngle + sliceAngle / 2);
        ctx.textAlign = 'right';
        ctx.fillStyle = '#1a1a2e';  // Dark text for better contrast
        ctx.font = 'bold 13px Arial';
        ctx.shadowColor = 'rgba(255,255,255,0.8)';
        ctx.shadowBlur = 2;
        
        // Get text without emoji for cleaner display
        const displayText = prize.text.replace(/[^\w\s%$]/g, '').trim();
        ctx.fillText(displayText, radius - 15, 5);
        ctx.restore();
        
        currentAngle += sliceAngle;
    });
    
    // Draw center button
    ctx.beginPath();
    ctx.arc(centerX, centerY, 45, 0, Math.PI * 2);
    const centerGradient = ctx.createRadialGradient(centerX, centerY - 10, 0, centerX, centerY, 45);
    centerGradient.addColorStop(0, '#ed7023');
    centerGradient.addColorStop(1, '#c45a1a');
    ctx.fillStyle = centerGradient;
    ctx.fill();
    ctx.strokeStyle = '#fff';
    ctx.lineWidth = 3;
    ctx.stroke();
    
    // SPIN text
    ctx.fillStyle = '#fff';
    ctx.font = 'bold 16px Arial';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('SPIN', centerX, centerY);
    
    // Outer ring
    ctx.beginPath();
    ctx.arc(centerX, centerY, radius + 8, 0, Math.PI * 2);
    ctx.strokeStyle = '#ed7023';
    ctx.lineWidth = 6;
    ctx.stroke();
}

function lightenColor(color, percent) {
    const num = parseInt(color.replace('#', ''), 16);
    const amt = Math.round(2.55 * percent);
    const R = Math.min(255, (num >> 16) + amt);
    const G = Math.min(255, ((num >> 8) & 0x00FF) + amt);
    const B = Math.min(255, (num & 0x0000FF) + amt);
    return `rgb(${R},${G},${B})`;
}

// Real prize wheel opener - overrides the placeholder
window.openPrizeWheel = function(mode) {
    console.log('üé∞ Opening prize wheel for mode:', mode);
    window.pendingMode = mode;
    
    const modal = document.getElementById('prizeWheelModal');
    const emailSection = document.getElementById('emailEntrySection');
    const wheelSection = document.getElementById('wheelRevealSection');
    const resultSection = document.getElementById('prizeResult');
    const emailInput = document.getElementById('prizeWheelEmail');
    
    if (!modal) {
        console.error('Prize wheel modal not found!');
        return;
    }
    
    modal.classList.add('active');
    modal.style.display = 'flex';
    modal.style.pointerEvents = 'auto';
    
    // Reset to email entry state
    if (emailSection) emailSection.style.display = 'block';
    if (wheelSection) wheelSection.style.display = 'none';
    if (resultSection) resultSection.style.display = 'none';
    if (emailInput) emailInput.value = '';
    
    // Update spin count display
    const spinCountEl = document.getElementById('spinCount');
    const winnerCountEl = document.getElementById('winnerCount');
    const nextGrandEl = document.getElementById('nextGrandPrize');
    
    if (spinCountEl) spinCountEl.textContent = totalSpins.toLocaleString();
    if (winnerCountEl) winnerCountEl.textContent = totalWinners.toLocaleString();
    
    // Show next grand prize info
    if (nextGrandEl) {
        const nextGrandPrize = Math.ceil((totalSpins + 1) / 5000) * 5000;
        const spinsUntilGrand = nextGrandPrize - totalSpins;
        nextGrandEl.textContent = spinsUntilGrand.toLocaleString();
    }
}
window._openPrizeWheelReal = window.openPrizeWheel;
var openPrizeWheel = window.openPrizeWheel;

// SMS Configuration - Twilio Function
const SMS_CONFIG = {
    endpoint: 'https://apex-9131.twil.io/path_1',
    enabled: localStorage.getItem('apex_smsEnabled') !== 'false' // Default ON
};

// Track SMS sent count
let smsSentCount = parseInt(localStorage.getItem('apex_smsSentCount')) || 0;

// Toggle SMS on/off
window.toggleSMS = function() {
    const toggle = document.getElementById('smsEnabledToggle');
    const status = document.getElementById('smsStatus');
    
    SMS_CONFIG.enabled = toggle.checked;
    localStorage.setItem('apex_smsEnabled', toggle.checked);
    
    if (status) {
        status.textContent = toggle.checked ? 'ON' : 'OFF';
        status.style.color = toggle.checked ? 'var(--green)' : 'var(--text-muted)';
    }
    
    console.log('SMS ' + (toggle.checked ? 'enabled' : 'disabled'));
};

// Initialize SMS toggle state on page load
document.addEventListener('DOMContentLoaded', function() {
    const toggle = document.getElementById('smsEnabledToggle');
    const status = document.getElementById('smsStatus');
    const countEl = document.getElementById('smsSentCount');
    
    if (toggle) {
        toggle.checked = SMS_CONFIG.enabled;
    }
    if (status) {
        status.textContent = SMS_CONFIG.enabled ? 'ON' : 'OFF';
        status.style.color = SMS_CONFIG.enabled ? 'var(--green)' : 'var(--text-muted)';
    }
    if (countEl) {
        countEl.textContent = smsSentCount;
    }
});

// Send SMS confirmation via Twilio Function
async function sendSMSConfirmation(phone, email) {
    if (!SMS_CONFIG.enabled || !phone) {
        console.log('SMS not sent - disabled or no phone number');
        return;
    }
    
    // Clean phone number - keep only digits
    let cleanPhone = phone.replace(/\D/g, '');
    
    // Add US country code if not present
    if (cleanPhone.length === 10) {
        cleanPhone = '+1' + cleanPhone;
    } else if (!cleanPhone.startsWith('+')) {
        cleanPhone = '+' + cleanPhone;
    }
    
    if (cleanPhone.replace(/\D/g, '').length < 10) {
        console.log('Invalid phone number');
        return;
    }
    
    const message = `Welcome to APEX! üèÜ Your registration is confirmed (${email}). Get ready to transform your athletic career with Area Scouts! Reply STOP to opt out.`;
    
    try {
        const response = await fetch(SMS_CONFIG.endpoint, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: new URLSearchParams({
                to: cleanPhone,
                message: message
            })
        });
        
        const result = await response.json();
        
        if (result.success) {
            console.log('‚úÖ SMS confirmation sent successfully:', result.sid);
            logActivity('SMS Sent', phone);
            
            // Update SMS count
            smsSentCount++;
            localStorage.setItem('apex_smsSentCount', smsSentCount);
            const countEl = document.getElementById('smsSentCount');
            if (countEl) countEl.textContent = smsSentCount;
        } else {
            console.error('SMS send failed:', result.error);
        }
    } catch (error) {
        console.error('SMS error:', error);
    }
}

window.submitEmailAndShowWheel = function() {
    const emailInput = document.getElementById('prizeWheelEmail');
    const phoneInput = document.getElementById('prizeWheelPhone');
    const email = emailInput.value.trim();
    const phone = phoneInput ? phoneInput.value.trim() : '';
    
    if (!email || !email.includes('@') || !email.includes('.')) {
        emailInput.style.borderColor = '#dc3545';
        emailInput.style.animation = 'shake 0.5s ease';
        setTimeout(() => {
            emailInput.style.animation = '';
            emailInput.style.borderColor = 'rgba(255,255,255,0.2)';
        }, 500);
        return;
    }
    
    // Capture email - set BOTH local and window versions
    currentUserPrizeEmail = email;
    window.currentUserPrizeEmail = email;
    window.currentUserEmail = email;
    captureUserEmail(email);
    
    // Store phone if provided
    if (phone) {
        localStorage.setItem('apex_userPhone', phone);
        window.currentUserPhone = phone;
        
        // Send SMS confirmation
        sendSMSConfirmation(phone, email);
    }
    
    // Hide email entry, show wheel
    document.getElementById('emailEntrySection').style.display = 'none';
    document.getElementById('wheelRevealSection').style.display = 'block';
    
    // Initialize the wheel
    initPrizeWheel();
    
    // Log activity
    logActivity('Prize Wheel Email', email);
    if (phone) {
        logActivity('Prize Wheel Phone', phone);
    }
}
var submitEmailAndShowWheel = window.submitEmailAndShowWheel;

window.closePrizeWheel = function() {
    var modal = document.getElementById('prizeWheelModal');
    if (modal) {
        modal.classList.remove('active');
        modal.style.display = 'none';
        modal.style.pointerEvents = 'none';
    }
    wheelSpinning = false;
    
    // Reset pending actions so buttons work again
    window.pendingAction = null;
    window.pendingActionType = null;
    window.pendingMode = null;
    
    // Reset modal state for next time
    var emailSection = document.getElementById('emailEntrySection');
    var wheelSection = document.getElementById('wheelRevealSection');
    var resultSection = document.getElementById('prizeResult');
    if (emailSection) emailSection.style.display = 'block';
    if (wheelSection) wheelSection.style.display = 'none';
    if (resultSection) resultSection.style.display = 'none';
    
    console.log('Prize wheel closed');
}
var closePrizeWheel = window.closePrizeWheel;

window.spinPrizeWheel = function() {
    if (wheelSpinning) return;
    
    // Email should already be captured - check both local and window versions
    var email = window.currentUserPrizeEmail || currentUserPrizeEmail || window.currentUserEmail;
    if (!email) {
        alert('Please enter your email first!');
        return;
    }
    
    // Make sure it's stored in all places
    currentUserPrizeEmail = email;
    window.currentUserPrizeEmail = email;
    
    wheelSpinning = true;
    
    // Disable button
    const spinBtn = document.querySelector('.spin-button');
    spinBtn.disabled = true;
    spinBtn.innerHTML = '<span class="spin-button-text">üé∞ SPINNING...</span>';
    
    // Increment spin count FIRST to check for grand prize
    totalSpins++;
    localStorage.setItem('apex_totalSpins', totalSpins);
    
    // Check if this is a 5000th spin (grand prize!)
    const isGrandPrizeSpin = (totalSpins % 5000 === 0);
    
    let selectedPrize;
    let prizeIndex;
    
    if (isGrandPrizeSpin) {
        // GRAND PRIZE! Land on $25 gift card (index 0)
        selectedPrize = wheelPrizes[0];
        prizeIndex = 0;
    } else {
        // Normal weighted random (excluding grand prize which has weight 0)
        const eligiblePrizes = wheelPrizes.filter(p => p.weight > 0);
        const totalWeight = eligiblePrizes.reduce((sum, p) => sum + p.weight, 0);
        let random = Math.random() * totalWeight;
        
        for (let i = 0; i < wheelPrizes.length; i++) {
            if (wheelPrizes[i].weight === 0) continue; // Skip grand prize
            random -= wheelPrizes[i].weight;
            if (random <= 0) {
                selectedPrize = wheelPrizes[i];
                prizeIndex = i;
                break;
            }
        }
    }
    
    // Calculate rotation (equal visual segments)
    const sliceAngle = 360 / wheelPrizes.length;
    const targetAngle = 360 - (prizeIndex * sliceAngle) - (sliceAngle / 2);
    const spins = 5 + Math.random() * 3; // 5-8 full spins
    const finalRotation = spins * 360 + targetAngle;
    
    // Animate wheel
    const canvas = document.getElementById('prizeWheelCanvas');
    const duration = 5000;
    const startTime = Date.now();
    const startRotation = wheelRotation;
    
    function animateWheel() {
        const elapsed = Date.now() - startTime;
        const progress = Math.min(elapsed / duration, 1);
        
        // Easing function (ease out cubic)
        const eased = 1 - Math.pow(1 - progress, 3);
        
        wheelRotation = startRotation + (finalRotation - startRotation) * eased;
        canvas.style.transform = `rotate(${wheelRotation}deg)`;
        
        if (progress < 1) {
            requestAnimationFrame(animateWheel);
        } else {
            // Spin complete
            showPrizeResult(selectedPrize);
        }
    }
    
    animateWheel();
    
    // Update spin count display
    document.getElementById('spinCount').textContent = totalSpins.toLocaleString();
}
var spinPrizeWheel = window.spinPrizeWheel;

window.showPrizeResult = function(prize) {
    wheelSpinning = false;
    
    // Hide wheel section, show result
    document.getElementById('wheelRevealSection').style.display = 'none';
    const result = document.getElementById('prizeResult');
    result.style.display = 'block';
    
    // Update winners count if won something (not spin again)
    if (!prize.text.includes('SPIN AGAIN')) {
        totalWinners++;
        localStorage.setItem('apex_totalWinners', totalWinners);
        document.getElementById('winnerCount').textContent = totalWinners.toLocaleString();
    }
    
    const isGrandPrize = prize.isGrandPrize;
    
    // Set result content
    document.getElementById('prizeResultIcon').textContent = isGrandPrize ? 'üèÜüí∞üéâ' : 'üéâ';
    document.getElementById('prizeResultTitle').textContent = isGrandPrize ? 'JACKPOT!!!' : 'YOU WON!';
    document.getElementById('prizeResultTitle').style.color = isGrandPrize ? '#FFD700' : '#37c938';
    document.getElementById('prizeResultText').innerHTML = prize.text;
    
    // Show guide info if applicable
    const guideInfo = document.getElementById('prizeGuideInfo');
    if (prize.guide && prize.guideTitle) {
        guideInfo.innerHTML = `<div style="margin-top:15px; padding:15px; background:rgba(55,201,56,0.1); border-radius:12px; border:1px solid rgba(55,201,56,0.3);">
            <p style="color:#37c938; font-weight:600; margin-bottom:5px;">üìö Your Prize Guide:</p>
            <p style="color:#fff; font-size:16px;">${prize.guideTitle}</p>
            <p style="color:#94a3b8; font-size:12px; margin-top:8px;">Check your email (${currentUserPrizeEmail}) for the download link!</p>
        </div>`;
    } else if (isGrandPrize) {
        guideInfo.innerHTML = `<div style="margin-top:15px; padding:15px; background:rgba(255,215,0,0.1); border-radius:12px; border:1px solid rgba(255,215,0,0.3);">
            <p style="color:#FFD700; font-weight:600; margin-bottom:5px;">üéÅ $25 Gift Card Winner!</p>
            <p style="color:#fff; font-size:14px;">Congratulations! You're spin #${totalSpins.toLocaleString()}!</p>
            <p style="color:#94a3b8; font-size:12px; margin-top:8px;">Our team has been notified and will send your gift card to ${currentUserPrizeEmail} within 24-48 hours!</p>
        </div>`;
        
        // Send notification for grand prize winner
        sendGrandPrizeNotification(currentUserPrizeEmail, totalSpins);
    } else {
        guideInfo.innerHTML = '';
    }
    
    // Launch confetti
    launchConfetti();
    
    // Log activity with prize details
    logActivity('Prize Wheel Win', `${prize.text} - Email: ${currentUserPrizeEmail}`);
    
    // Track wheel spin
    if (typeof trackUserAction === 'function') {
        trackUserAction('wheel_spin', {
            prize: prize.text,
            isGrandPrize: prize.isGrandPrize || false,
            spinNumber: totalSpins
        });
    }
    
    // Store prize win in leads data
    storePrizeWin(currentUserPrizeEmail, prize);
}
var showPrizeResult = window.showPrizeResult;

function sendGrandPrizeNotification(winnerEmail, spinNumber) {
    // Store grand prize winner for admin notification
    const grandPrizeWin = {
        email: winnerEmail,
        spinNumber: spinNumber,
        timestamp: new Date().toISOString(),
        claimed: false
    };
    
    // Store in localStorage for admin view
    let grandPrizeWinners = JSON.parse(localStorage.getItem('apex_grandPrizeWinners')) || [];
    grandPrizeWinners.push(grandPrizeWin);
    localStorage.setItem('apex_grandPrizeWinners', JSON.stringify(grandPrizeWinners));
    
    // Also save to Firebase if available
    if (window.saveToFirebase) {
        window.saveToFirebase('grandPrizeWinners', grandPrizeWin);
    }
    
    // Log for immediate visibility
    console.log('üèÜ GRAND PRIZE WINNER!', grandPrizeWin);
    
    // Store notification for admin panel
    if (window.data && window.data.activity) {
        window.data.activity.unshift({
            type: 'üèÜ GRAND PRIZE WINNER',
            detail: `${winnerEmail} won $25 Gift Card on spin #${spinNumber}`,
            time: new Date().toLocaleString()
        });
        window.saveData('activity');
    }
}

function storePrizeWin(email, prize) {
    // Add to leads with prize info
    if (window.data && window.data.leads) {
        const existingLead = window.data.leads.find(l => l.email === email);
        if (existingLead) {
            existingLead.prizes = existingLead.prizes || [];
            existingLead.prizes.push({
                prize: prize.text,
                guide: prize.guide || null,
                timestamp: new Date().toISOString()
            });
        } else {
            window.data.leads.push({
                email: email,
                source: 'Prize Wheel',
                prizes: [{
                    prize: prize.text,
                    guide: prize.guide || null,
                    timestamp: new Date().toISOString()
                }],
                time: new Date().toLocaleString()
            });
        }
        window.saveData('leads');
    }
}

function launchConfetti() {
    const colors = ['#ed7023', '#37c938', '#ffde59', '#8b5cf6', '#ec4899', '#06b6d4'];
    
    for (let i = 0; i < 50; i++) {
        setTimeout(() => {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            confetti.style.left = Math.random() * 100 + 'vw';
            confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
            confetti.style.width = (Math.random() * 10 + 5) + 'px';
            confetti.style.height = (Math.random() * 10 + 5) + 'px';
            confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
            document.body.appendChild(confetti);
            
            setTimeout(() => confetti.remove(), 3000);
        }, i * 30);
    }
}

window.claimPrize = function() {
    // SAVE pending action BEFORE closing (closePrizeWheel resets them)
    var savedAction = window.pendingAction;
    var savedActionType = window.pendingActionType;
    var savedMode = window.pendingMode;
    
    closePrizeWheel();
    
    // Handle pending action based on type
    if (savedActionType === 'modal' && savedAction) {
        openModal(savedAction);
    } else if (savedActionType === 'mode' && savedAction) {
        setMode(savedAction);
    } else if (savedMode) {
        // Fallback for old pendingMode
        setMode(savedMode);
    }
}
var claimPrize = window.claimPrize;

function lightenColor(color, percent) {
    const num = parseInt(color.replace('#', ''), 16);
    const amt = Math.round(2.55 * percent);
    const R = (num >> 16) + amt;
    const G = (num >> 8 & 0x00FF) + amt;
    const B = (num & 0x0000FF) + amt;
    return '#' + (
        0x1000000 +
        (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
        (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
        (B < 255 ? B < 1 ? 0 : B : 255)
    ).toString(16).slice(1);
}

// Add shake animation
const shakeStyle = document.createElement('style');
shakeStyle.textContent = `
    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-10px); }
        75% { transform: translateX(10px); }
    }
`;
document.head.appendChild(shakeStyle);
</script>

<script>
// ============================================
// WINDOW MANAGER SYSTEM
// ============================================
let openScreens = JSON.parse(localStorage.getItem('apex_openScreens')) || { admin: false, edit: false };
let currentScreen = 'main';
window.editScreenData = { index: null, photoData: '' };
var editScreenData = window.editScreenData;

function updateWindowButtons() {
    document.getElementById('winBtn-main').style.display = (currentScreen !== 'main') ? 'flex' : 'none';
    document.getElementById('winBtn-admin').style.display = openScreens.admin ? 'flex' : 'none';
    document.getElementById('winBtn-edit').style.display = openScreens.edit ? 'flex' : 'none';
    
    // Highlight active screen
    document.querySelectorAll('.window-btn-group .window-btn:first-child').forEach(btn => btn.classList.remove('active'));
    if (currentScreen === 'admin' && openScreens.admin) {
        document.querySelector('#winBtn-admin .window-btn:first-child').classList.add('active');
    } else if (currentScreen === 'edit' && openScreens.edit) {
        document.querySelector('#winBtn-edit .window-btn:first-child').classList.add('active');
    } else if (currentScreen === 'main') {
        const mainBtn = document.querySelector('#winBtn-main .window-btn:first-child');
        if (mainBtn) mainBtn.classList.add('active');
    }
    
    localStorage.setItem('apex_openScreens', JSON.stringify(openScreens));
}

window.showScreen = function(screen) {
    currentScreen = screen;
    
    // Hide all screens first
    document.getElementById('editDirectorScreen').classList.remove('active');
    document.querySelector('.main-content-wrapper').style.display = 'none';
    document.getElementById('adminModal').classList.remove('active');
    document.getElementById('adminModal').style.display = 'none';
    
    if (screen === 'main') {
        document.querySelector('.main-content-wrapper').style.display = 'block';
    } else if (screen === 'admin') {
        document.getElementById('adminModal').style.display = 'flex';
        document.getElementById('adminModal').classList.add('active');
    } else if (screen === 'edit') {
        document.getElementById('editDirectorScreen').classList.add('active');
    }
    
    updateWindowButtons();
}
var showScreen = window.showScreen;

window.closeScreen = function(screen) {
    if (screen === 'admin') {
        openScreens.admin = false;
        document.getElementById('adminModal').classList.remove('active');
        document.getElementById('adminModal').style.display = 'none';
        if (currentScreen === 'admin') {
            showScreen('main');
        }
    } else if (screen === 'edit') {
        openScreens.edit = false;
        if (currentScreen === 'edit') {
            showScreen(openScreens.admin ? 'admin' : 'main');
        }
    }
    updateWindowButtons();
}
var closeScreen = window.closeScreen;

function openAdminScreen() {
    openScreens.admin = true;
    showScreen('admin');
}

function openEditDirectorScreen(index) {
    const d = data.directors[index];
    if (!d) return;
    
    const name = typeof d === 'object' ? d.name : d;
    const title = typeof d === 'object' ? d.title : 'Director';
    const photo = typeof d === 'object' && d.photo ? d.photo : 'https://ui-avatars.com/api/?name=' + encodeURIComponent(name) + '&background=16345f&color=fff&size=180';
    
    document.getElementById('editScreenIndex').value = index;
    document.getElementById('editScreenName').value = name;
    document.getElementById('editScreenTitle').value = title;
    document.getElementById('editScreenPhoto').src = photo;
    editScreenData.index = index;
    editScreenData.photoData = typeof d === 'object' ? d.photo : '';
    
    openScreens.edit = true;
    showScreen('edit');
}

function handleScreenPhotoUpload(e) {
    const file = e.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = function(event) {
        const img = new Image();
        img.onload = function() {
            const canvas = document.createElement('canvas');
            canvas.width = 180;
            canvas.height = 180;
            const ctx = canvas.getContext('2d');
            const size = Math.min(img.width, img.height);
            const x = (img.width - size) / 2;
            const y = (img.height - size) / 2;
            ctx.drawImage(img, x, y, size, size, 0, 0, 180, 180);
            const dataUrl = canvas.toDataURL('image/jpeg', 0.85);
            document.getElementById('editScreenPhoto').src = dataUrl;
            editScreenData.photoData = dataUrl;
        };
        img.src = event.target.result;
    };
    reader.readAsDataURL(file);
}

function searchScreenDirectorPhoto() {
    const name = document.getElementById('editScreenName').value.trim();
    if (!name) {
        alert('Please enter the director name first');
        return;
    }
    window.open('https://www.google.com/search?tbm=isch&q=' + encodeURIComponent(name + ' athlete coach headshot'), '_blank');
}

function searchScreenDirectorBio() {
    const name = document.getElementById('editScreenName').value.trim();
    if (!name) {
        alert('Please enter the director name first');
        return;
    }
    window.open('https://www.google.com/search?q=' + encodeURIComponent(name + ' athlete coach bio'), '_blank');
}

async function generateScreenTitleAI() {
    const name = document.getElementById('editScreenName').value.trim();
    if (!name) {
        alert('Please enter the director name first');
        return;
    }
    
    const btn = event.target;
    const originalText = btn.textContent;
    btn.textContent = '‚è≥ Generating...';
    btn.disabled = true;
    
    try {
        const response = await fetch('https://apex-api.lancebaldwin.workers.dev', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                action: 'chat',
                data: {
                    model: 'gpt-4o-mini',
                    messages: [
                        { role: 'system', content: 'Generate a professional sports title/bio for this person. Keep it under 50 words. If they are a known athlete/coach, use their real credentials. Format: "Title, Achievement, Organization"' },
                        { role: 'user', content: 'Generate a professional sports title for: ' + name }
                    ],
                    max_tokens: 60,
                    temperature: 0.7
                }
            })
        });
        
        const result = await response.json();
        if (result.choices && result.choices[0]) {
            document.getElementById('editScreenTitle').value = result.choices[0].message.content.trim();
        }
    } catch (error) {
        alert('Error generating title: ' + error.message);
    }
    
    btn.textContent = originalText;
    btn.disabled = false;
}

function saveScreenDirectorEdit() {
    const index = parseInt(document.getElementById('editScreenIndex').value);
    const name = document.getElementById('editScreenName').value.trim();
    const title = document.getElementById('editScreenTitle').value.trim();
    
    if (!name) {
        alert('Please enter a name');
        return;
    }
    
    // Use window.data to access global data object
    window.data.directors[index] = {
        name: name,
        title: title || 'Director',
        photo: window.editScreenData.photoData || ''
    };
    
    // Use window.saveData to access global function
    window.saveData('directors');
    
    // Refresh UI - use try/catch in case functions don't exist
    try {
        if (typeof loadAdminDirectors === 'function') loadAdminDirectors();
        if (typeof loadDirectors === 'function') loadDirectors();
    } catch(e) {
        console.log('UI refresh error:', e);
    }
    
    alert('‚úÖ Director saved successfully!');
}

// Override the old edit function to use new screen system
function openEditDirectorModal(index) {
    openEditDirectorScreen(index);
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    // Restore open screens from memory
    if (openScreens.admin) {
        document.getElementById('winBtn-admin').style.display = 'flex';
    }
    if (openScreens.edit) {
        document.getElementById('winBtn-edit').style.display = 'flex';
    }
    updateWindowButtons();
});

// ============================================
// CRITICAL: FINAL BUTTON INITIALIZATION
// This runs after ALL other scripts to ensure buttons work
// ============================================
document.addEventListener('DOMContentLoaded', function() {
    console.log('üîß Final button initialization starting...');
    
    // Prize wheel close button
    var closeBtn = document.getElementById('prizeWheelCloseBtn');
    if (closeBtn) {
        closeBtn.onclick = function(e) {
            e.preventDefault();
            e.stopPropagation();
            var modal = document.getElementById('prizeWheelModal');
            if (modal) {
                modal.classList.remove('active');
                modal.style.display = 'none';
                modal.style.pointerEvents = 'none';
            }
            // Reset pending actions so buttons work again
            window.pendingAction = null;
            window.pendingActionType = null;
            window.pendingMode = null;
            
            // Reset the modal state for next time
            var emailSection = document.getElementById('emailEntrySection');
            var wheelSection = document.getElementById('wheelRevealSection');
            var resultSection = document.getElementById('prizeResult');
            if (emailSection) emailSection.style.display = 'block';
            if (wheelSection) wheelSection.style.display = 'none';
            if (resultSection) resultSection.style.display = 'none';
            
            console.log('Prize wheel closed, state reset');
        };
        console.log('‚úÖ Close button ready');
    }
    
    // Prize wheel submit button
    var submitBtn = document.getElementById('prizeWheelSubmitBtn');
    if (submitBtn) {
        submitBtn.onclick = function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var emailInput = document.getElementById('prizeWheelEmail');
            var email = emailInput ? emailInput.value.trim() : '';
            
            if (!email || email.indexOf('@') === -1 || email.indexOf('.') === -1) {
                alert('Please enter a valid email address');
                if (emailInput) emailInput.style.borderColor = '#dc3545';
                return;
            }
            
            // Set email in ALL places
            window.currentUserEmail = email;
            window.currentUserPrizeEmail = email;
            localStorage.setItem('apex_userEmail', email);
            
            // Call captureUserEmail to update the local variable used by chat
            if (typeof window.captureUserEmail === 'function') {
                window.captureUserEmail(email);
            }
            
            var emailSection = document.getElementById('emailEntrySection');
            var wheelSection = document.getElementById('wheelRevealSection');
            if (emailSection) emailSection.style.display = 'none';
            if (wheelSection) wheelSection.style.display = 'block';
            
            if (typeof window.initPrizeWheel === 'function') {
                window.initPrizeWheel();
            }
            console.log('Email submitted:', email);
        };
        console.log('‚úÖ Submit button ready');
    }
    
    // Spin wheel button
    var spinBtn = document.getElementById('spinWheelBtn');
    if (spinBtn) {
        spinBtn.onclick = function(e) {
            e.preventDefault();
            e.stopPropagation();
            if (typeof window.spinPrizeWheel === 'function') {
                window.spinPrizeWheel();
            }
            console.log('Spin clicked');
        };
        console.log('‚úÖ Spin button ready');
    }
    
    // Claim prize button
    var claimBtn = document.getElementById('claimPrizeBtn');
    if (claimBtn) {
        claimBtn.onclick = function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('Claim button clicked - calling claimPrize');
            
            // Use the main claimPrize function which handles saving pending action
            if (typeof window.claimPrize === 'function') {
                window.claimPrize();
            } else {
                // Fallback - save pending action BEFORE closing
                var savedAction = window.pendingAction;
                var savedActionType = window.pendingActionType;
                
                var modal = document.getElementById('prizeWheelModal');
                if (modal) {
                    modal.classList.remove('active');
                    modal.style.display = 'none';
                }
                
                if (savedActionType === 'modal' && savedAction) {
                    var targetModal = document.getElementById(savedAction);
                    if (targetModal) {
                        targetModal.classList.add('active');
                        targetModal.style.display = 'flex';
                    }
                } else if (savedActionType === 'mode' && savedAction) {
                    if (typeof window.setMode === 'function') {
                        window.setMode(savedAction);
                    }
                }
            }
            console.log('Prize claimed, pending action handled');
        };
        console.log('‚úÖ Claim button ready');
    }
    
    // Close wheel when clicking overlay
    var wheelModal = document.getElementById('prizeWheelModal');
    if (wheelModal) {
        wheelModal.onclick = function(e) {
            if (e.target === wheelModal) {
                wheelModal.classList.remove('active');
                wheelModal.style.display = 'none';
                wheelModal.style.pointerEvents = 'none';
                
                // Reset pending actions so buttons work again
                window.pendingAction = null;
                window.pendingActionType = null;
                window.pendingMode = null;
                
                // Reset modal state
                var emailSection = document.getElementById('emailEntrySection');
                var wheelSection = document.getElementById('wheelRevealSection');
                var resultSection = document.getElementById('prizeResult');
                if (emailSection) emailSection.style.display = 'block';
                if (wheelSection) wheelSection.style.display = 'none';
                if (resultSection) resultSection.style.display = 'none';
                
                console.log('Prize wheel closed via overlay, state reset');
            }
        };
    }
    
    console.log('üéØ All prize wheel buttons initialized');
});
</script>

<!-- CRITICAL: Force all hidden overlays to not block clicks -->
<style>
#prizeWheelModal:not(.active),
.modal-overlay:not(.active),
.screen-panel:not(.active) {
    pointer-events: none !important;
    display: none !important;
}
</style>

</body>
</html>